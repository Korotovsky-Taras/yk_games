var ee=(f,v)=>()=>(v||f((v={exports:{}}).exports,v),v.exports);var ae=ee((le,Ft)=>{(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))k(w);new MutationObserver(w=>{for(const _ of w)if(_.type==="childList")for(const y of _.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&k(y)}).observe(document,{childList:!0,subtree:!0});function x(w){const _={};return w.integrity&&(_.integrity=w.integrity),w.referrerPolicy&&(_.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?_.credentials="include":w.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function k(w){if(w.ep)return;w.ep=!0;const _=x(w);fetch(w.href,_)}})();/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   3.2.2+39aa2571
 */(function(){function f(t){return typeof t=="function"||typeof t=="object"&&t!==null}function v(t){return typeof t=="function"}var x;Array.isArray?x=Array.isArray:x=function(t){return Object.prototype.toString.call(t)==="[object Array]"};var k=x,w=0,_,y,S=function(n,a){u[w]=n,u[w+1]=a,w+=2,w===2&&(y?y(h):P())};function I(t){y=t}function q(t){S=t}var M=typeof window<"u"?window:void 0,R=M||{},O=R.MutationObserver||R.WebKitMutationObserver,C=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",V=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function Z(){return function(){process.nextTick(h)}}function $(){return function(){_(h)}}function b(){var t=0,n=new O(h),a=document.createTextNode("");return n.observe(a,{characterData:!0}),function(){a.data=t=++t%2}}function l(){var t=new MessageChannel;return t.port1.onmessage=h,function(){t.port2.postMessage(0)}}function r(){return function(){setTimeout(h,1)}}var u=new Array(1e3);function h(){for(var t=0;t<w;t+=2){var n=u[t],a=u[t+1];n(a),u[t]=void 0,u[t+1]=void 0}w=0}function d(){try{var t=require,n=t("vertx");return _=n.runOnLoop||n.runOnContext,$()}catch{return r()}}var P;C?P=Z():O?P=b():V?P=l():M===void 0&&typeof require=="function"?P=d():P=r();function L(t,n){var a=this,p=new this.constructor(lt);p[F]===void 0&&c(p);var m=a._state;if(m){var g=arguments[m-1];S(function(){J(m,p,g,a._result)})}else Pt(a,p,t,n);return p}var z=L;function tt(t){var n=this;if(t&&typeof t=="object"&&t.constructor===n)return t;var a=new n(lt);return Q(a,t),a}var U=tt,F=Math.random().toString(36).substring(16);function lt(){}var ut=void 0,N=1,D=2,rt=new $t;function Y(){return new TypeError("You cannot resolve a promise with itself")}function ot(){return new TypeError("A promises callback cannot return that same promise.")}function yt(t){try{return t.then}catch(n){return rt.error=n,rt}}function ct(t,n,a,p){try{t.call(n,a,p)}catch(m){return m}}function Rt(t,n,a){S(function(p){var m=!1,g=ct(a,n,function(T){m||(m=!0,n!==T?Q(p,T):K(p,T))},function(T){m||(m=!0,B(p,T))},"Settle: "+(p._label||" unknown promise"));!m&&g&&(m=!0,B(p,g))},t)}function Ct(t,n){n._state===N?K(t,n._result):n._state===D?B(t,n._result):Pt(n,void 0,function(a){Q(t,a)},function(a){B(t,a)})}function wt(t,n,a){n.constructor===t.constructor&&a===z&&constructor.resolve===U?Ct(t,n):a===rt?B(t,rt.error):a===void 0?K(t,n):v(a)?Rt(t,n,a):K(t,n)}function Q(t,n){t===n?B(t,Y()):f(n)?wt(t,n,yt(n)):K(t,n)}function et(t){t._onerror&&t._onerror(t._result),xt(t)}function K(t,n){t._state===ut&&(t._result=n,t._state=N,t._subscribers.length!==0&&S(xt,t))}function B(t,n){t._state===ut&&(t._state=D,t._result=n,S(et,t))}function Pt(t,n,a,p){var m=t._subscribers,g=m.length;t._onerror=null,m[g]=n,m[g+N]=a,m[g+D]=p,g===0&&t._state&&S(xt,t)}function xt(t){var n=t._subscribers,a=t._state;if(n.length!==0){for(var p,m,g=t._result,T=0;T<n.length;T+=3)p=n[T],m=n[T+a],p?J(a,p,m,g):m(g);t._subscribers.length=0}}function $t(){this.error=null}var vt=new $t;function Et(t,n){try{return t(n)}catch(a){return vt.error=a,vt}}function J(t,n,a,p){var m=v(a),g,T,G,j;if(m){if(g=Et(a,p),g===vt?(j=!0,T=g.error,g=null):G=!0,n===g){B(n,ot());return}}else g=p,G=!0;n._state!==ut||(m&&G?Q(n,g):j?B(n,T):t===N?K(n,g):t===D&&B(n,g))}function zt(t,n){try{n(function(p){Q(t,p)},function(p){B(t,p)})}catch(a){B(t,a)}}var i=0;function o(){return i++}function c(t){t[F]=i++,t._state=void 0,t._result=void 0,t._subscribers=[]}function E(t){return new _t(this,t).promise}var A=E;function W(t){var n=this;return k(t)?new n(function(a,p){for(var m=t.length,g=0;g<m;g++)n.resolve(t[g]).then(a,p)}):new n(function(a,p){p(new TypeError("You must pass an array to race."))})}var it=W;function bt(t){var n=this,a=new n(lt);return B(a,t),a}var dt=bt;function pt(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function mt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ft=H;function H(t){this[F]=o(),this._result=this._state=void 0,this._subscribers=[],lt!==t&&(typeof t!="function"&&pt(),this instanceof H?zt(this,t):mt())}H.all=A,H.race=it,H.resolve=U,H.reject=dt,H._setScheduler=I,H._setAsap=q,H._asap=S,H.prototype={constructor:H,then:z,catch:function(t){return this.then(null,t)}};var _t=kt;function kt(t,n){this._instanceConstructor=t,this.promise=new t(lt),this.promise[F]||c(this.promise),k(n)?(this._input=n,this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),this.length===0?K(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&K(this.promise,this._result))):B(this.promise,Ut())}function Ut(){return new Error("Array Methods must be provided an Array")}kt.prototype._enumerate=function(){for(var t=this.length,n=this._input,a=0;this._state===ut&&a<t;a++)this._eachEntry(n[a],a)},kt.prototype._eachEntry=function(t,n){var a=this._instanceConstructor,p=a.resolve;if(p===U){var m=yt(t);if(m===z&&t._state!==ut)this._settledAt(t._state,n,t._result);else if(typeof m!="function")this._remaining--,this._result[n]=t;else if(a===ft){var g=new a(lt);wt(g,t,m),this._willSettleAt(g,n)}else this._willSettleAt(new a(function(T){T(t)}),n)}else this._willSettleAt(p(t),n)},kt.prototype._settledAt=function(t,n,a){var p=this.promise;p._state===ut&&(this._remaining--,t===D?B(p,a):this._result[n]=a),this._remaining===0&&K(p,this._result)},kt.prototype._willSettleAt=function(t,n){var a=this;Pt(t,void 0,function(p){a._settledAt(N,n,p)},function(p){a._settledAt(D,n,p)})};function e(){var t;if(typeof global<"u")t=global;else if(typeof self<"u")t=self;else try{t=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;n&&Object.prototype.toString.call(n.resolve())==="[object Promise]"&&!n.cast||(t.Promise=ft)}var s=e;ft.Promise=ft,ft.polyfill=s,typeof define=="function"&&define.amd?define(function(){return ft}):typeof Ft<"u"&&Ft.exports?Ft.exports=ft:typeof this<"u"&&(this.Promise=ft),s()}).call(void 0);let Bt=!1;function Gt(){}Gt.extend=function(f){const v=this.prototype;let x;Bt=!0,x=new this,Bt=!1;for(let w in f)typeof f[w]=="function"&&typeof v[w]=="function"?x[w]=function(_,y){return function(){const S=this._super;this._super=v[_];const I=y.apply(this,arguments);return this._super=S,I}}(w,f[w]):x[w]=f[w];function k(){if(this instanceof k)!Bt&&this.init&&this.init.apply(this,arguments);else return new k(...arguments)}return k.prototype=x,k.prototype.constructor=k,k.extend=this.extend,k};function ie(f){let v=Math,x=v.PI,k=2*x,w=x/180,_=v.sqrt,y=v.pow,S=v.cos,I=v.sin,q=v.round,M=v.abs,R=v.acos,O,C=Object.prototype.hasOwnProperty,V=Array.prototype.slice,Z={tx:0,ty:0,scaleX:1,scaleY:1,skewX:0,skewY:0,fill:"#000",stroke:"",lineWidth:1,lineJoin:"miter",lineCap:"butt",alpha:1,rotation:0,composite:"source-over",shadowColor:"rgba(0, 0, 0, 0.0)",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,fontStyle:"normal",fontWeight:"normal",fontSize:10,fontFamily:"Arial"},$=document.createElement("canvas"),b=$.getContext&&$.getContext("2d"),l=function(e,s){return _(y(e.x-s.x,2)+y(e.y-s.y,2))},r=function(e,s,t,n,a){let p=t-e,m=n-s,g={},T;if(!(p===0&&m===0))return T=((a.x-e)*p+(a.y-s)*m)/(p*p+m*m),T<0?g={x:e,y:s}:T>1?g={x:t,y:t}:g={x:e+T*p,y:s+T*m},l(g,a)},u=function(e,s,t){return t=w*t,{x:e*S(t)-s*I(t),y:e*I(t)+s*S(t)}},h=function(e,s){let t;for(t in s)C.call(s,t)&&(e[t]=s[t])},d=Gt.extend({init:function(e,s){this.x=e||0,this.y=s||0,h(this,Z)},position:function(){let e=u(this.x*this.scaleX,this.y*this.scaleY,this.rotation);return{x:e.x+this.tx,y:e.y+this.ty}},rmove:function(e,s){this.tx+=e,this.ty+=s},attr:function(e,s){let t;if(typeof e=="string")this[e]=s;else for(t in e)this[t]=e[t];return this},applyStyle:function(e){let s=this.shadowBlur,t=this.shadowOffsetX,n=this.shadowOffsetY;e.fillStyle=this.fill,e.globalAlpha=this.alpha,e.globalCompositeOperation=this.composite,this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.lineWidth),(t||n||s)&&(e.shadowColor=this.shadowColor,e.shadowOffsetX=t,e.shadowOffsetY=n,e.shadowBlur=s)},setTransform:function(e){let s=f.__zoom,t=this.scaleX*s,n=this.scaleY*s,a=this.skewX*s,p=this.skewY*s,m=this.rotation*w,g=I(m),T=S(m),G=this.tx*s,j=this.ty*s,at=T*t-g*p,ht=T*a-g*n,Tt=g*t+T*p,At=g*a+T*n;e.setTransform(at,Tt,ht,At,G,j)},draw:function(e){throw new Error("El método draw no se ha implementado")},fill_or_stroke:function(e){this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(b&&b.isPointInPath)return this.draw(b),b.setTransform(1,0,0,1,0,0),b.isPointInPath(e.x,e.y);throw Error("Método isPointInPath no soportado: Necesita FlashCanvasPro")}}),P=d.extend({init:function(e,s,t,n,a){this.r=a||0,this.w=t||5,this.h=n||t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y,n=this.w,a=this.h;this.applyStyle(e),this.setTransform(e),e.beginPath(),this.r?f.setContext(e).polygon(s,t,s+n,t,s+n,t+a,s,t+a,this.r):e.rect(s,t,q(n),q(a)),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.r)return this._super(e);let s=this.position(),t=u(e.x-s.x,e.y-s.y,-this.rotation);return t.x>=0&&t.x<=this.w*this.scaleX&&t.y>=0&&t.y<=this.h*this.scaleY}}),L=P.extend({init:function(e,s,t){this.setText(t),this._super(e,s,this.w,this.h)},applyStyle:function(e){e.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.h=this.fontSize,this.w=e.measureText(this.text).width,this._super(e)},setText:function(e){this.text=e+""},draw:function(e){this.applyStyle(e),this.setTransform(e),this.fill&&e.fillText(this.text,this.x,this.y+this.h),this.stroke&&e.strokeText(this.text,this.x,this.y+this.h)},hitTest:function(e){return this.skewX||this.skewY&&b&&b.isPointInPath?(this.setTransform(b),b.beginPath(),b.rect(this.x,this.y,this.w,this.h),b.closePath(),b.isPointInPath(e.x,e.y)):this._super(e)}}),z={},tt=P.extend({init:function(e,s,t){this.setImg(t),this._super(e,s,this.img.width,this.img.height)},setImg:function(e){if(z[e]){this.img=z[e],this.src=this.img.src;return}e.nodeName=="IMG"?this.img=e:(e+="",this.img=z[e]=new Image,this.img.src=e),this.img.onload=function(){f.forse_redraw()},this.src=this.img.src},draw:function(e){let s=this.x,t=this.y;this.w=this.img.width,this.h=this.img.height,this.applyStyle(e),this.setTransform(e),e===b?(e.beginPath(),e.rect(s,t,q(this.w),q(this.h)),e.closePath()):e.drawImage(this.img,s,t)}}),U=P.extend({draw:function(e){let s=this.x,t=this.y,n=this.w,a=this.h,p=.5522847498307933,m=p*n,g=p*a;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(s+n,t),e.bezierCurveTo(s+n,t-g,s+m,t-a,s,t-a),e.bezierCurveTo(s-m,t-a,s-n,t-g,s-n,t),e.bezierCurveTo(s-n,t+g,s-m,t+a,s,t+a),e.bezierCurveTo(s+m,t+a,s+n,t+g,s+n,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:d.prototype.hitTest}),F=d.extend({init:function(e,s,t,n,a,p){this.clockwise=p,this.endAngle=a,this.startAngle=n,this.r=t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,q(this.r),this.startAngle||x*2,this.endAngle||0,!!this.clockwise),e.lineTo(s,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()}}),lt=d.extend({init:function(e,s,t){this.r=t||5,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,q(this.r),0,x*2,!0),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.scaleX!==this.scaleY)return this._super(e);let s=!!this.stroke&&this.lineWidth,t=this.position();return l(e,t)<=(this.r+s)*this.scaleX}}),ut=d.extend({init:function(e,s,t,n){this.x2=t,this.y2=n,this._super(e,s),this.stroke="#000"},rmove:function(e,s){this.x+=e,this.y+=s,this.x2+=e,this.y2+=s},applyStyle:function(e){e.lineJoin=this.lineJoin,e.lineCap=this.lineCap,this._super(e)},draw:function(e){this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.x2,this.y2),e.stroke()},hitTest:function(e){return r(this.x,this.y,this.x2,this.y2,e)<=this.lineWidth+2}}),N,D,rt,Y=null,ot=null,yt=!1,ct=/[MmLlZzHhVvCcQqSsTtAa]\s*([\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?[,\s]*)*/g,Rt=/[\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?/g,Ct=function(e,s,t,n){let a=e*t+s*n,p=_(e*e+s*s),m=_(t*t+n*n),g=a/(p*m),T,G;return g>1?g=1:g<-1&&(g=-1),T=M(R(g)),G=e*n-s*t,G===M(G)?T:-T},wt=function(e,s,t){return[e*S(t)-s*I(t),s*S(t)+e*I(t)]},Q=function(e,s,t){yt&&e.ctx.moveTo(s,t)},et=function(e,s){N=e,D=s,Y=null,ot=null,yt=!1},K=function(){if(N===O)throw new Error("No current point; can't use relative coordinates")},B=function(e,s,t,n){if(s!==(t?e.length%t:e.length)||e.length<n)throw new Error("wrong number of arguments")},Pt=function(e,s){return this.ctx.moveTo(e,s),et(e,s),rt=e,arguments.length>2&&$t.apply(this,V.call(arguments,2)),this},xt=function(e,s){return yt&&(N=D=0),K(),e+=N,s+=D,this.ctx.moveTo(e,s),et(e,s),rt=e,arguments.length>2&&vt.apply(this,V.call(arguments,2)),this},$t=function(e,s){let t,n=arguments.length;for(B(arguments,0,2,2),Q(this,e,s),this.ctx.lineTo(e,s),t=2;t<n;t+=2)this.ctx.lineTo(e=arguments[t],s=arguments[t+1]);return et(e,s),this},vt=function(e,s){let t,n=N,a=D,p=arguments.length;for(B(arguments,0,2,2),K(),t=0;t<p;t+=2)this.ctx.lineTo(n+=arguments[t],a+=arguments[t+1]);return et(n,a),this},Et=function(){return this.ctx.closePath(),et(this,rt),this},J=function(e){let s,t=arguments.length;for(K(),s=0;s<t;s++)$t.call(this,arguments[s],D);return this},zt=function(e){let s,t=arguments.length;for(s=0;s<t;s++)vt.call(this,arguments[s],0);return this},i=function(e){let s,t=arguments.length;for(K(),s=0;s<t;s++)$t.call(this,N,arguments[s]);return this},o=function(e){let s,t=arguments.length;for(s=0;s<t;s++)vt.call(this,0,arguments[s]);return this},c=function(e,s,t,n,a,p){let m,g=arguments,T=arguments.length;for(B(g,0,6,6),Q(this,e,t),this.ctx.bezierCurveTo(e,s,t,n,a,p),m=6;m<T;m+=6)this.ctx.bezierCurveTo(g[m],g[m+1],t=g[m+2],n=g[m+3],a=g[m+4],p=g[m+5]);return et(a,p),Y=[t,n],this},E=function(e,s,t,n,a,p){let m,g=arguments,T=g.length,G=N,j=D;for(B(g,0,6,6),K(),m=0;m<T;m+=6)this.ctx.bezierCurveTo(G+g[m],j+g[m+1],t=G+g[m+2],n=j+g[m+3],G+=g[m+4],j+=g[m+5]);return et(G,j),Y=[t,n],this},A=function(e,s,t,n){let a,p=arguments,m=p.length;for(B(arguments,0,4,4),Q(this,e,s),this.ctx.quadraticCurveTo(e,s,t,n),a=4;a<m;a+=4)this.ctx.quadraticCurveTo(e=p[a],s=p[a+1],t=p[a+2],n=p[a+3]);return et(t,n),ot=[e,s],this},W=function(e,s,t,n){let a,p=arguments,m=p.length,g=N,T=D;for(B(arguments,0,4,4),K(),a=0;a<m;a+=4)this.ctx.quadraticCurveTo(e=g+p[a],s=T+p[a+1],g+=p[a+2],T+=p[a+3]);return et(g,T),ot=[e,s],this},it=function(){if(!Y)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=N,a=D,p=Y[0],m=Y[1],g,T,G,j,at,ht;for(B(arguments,0,4,4),K(),e=0;e<t;e+=4)g=n+(n-p),G=a+(a-m),T=s[e],j=s[e+1],at=s[e+2],ht=s[e+3],this.ctx.bezierCurveTo(g,G,T,j,at,ht),n=at,a=ht,p=T,m=j;return et(n,a),Y=[p,m],this},bt=function(){if(!Y)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=N,a=D,p=Y[0],m=Y[1],g,T,G,j,at,ht;for(B(arguments,0,4,4),K(),e=0;e<t;e+=4)g=n+(n-p),G=a+(a-m),T=n+s[e],j=a+s[e+1],at=n+s[e+2],ht=a+s[e+3],this.ctx.bezierCurveTo(g,G,T,j,at,ht),n=at,a=ht,p=T,m=j;return et(n,a),Y=[p,m],this},dt=function(){if(!ot)throw new Error("Last command was not a cubic bezier");let e,s=arguments.length,t=N,n=D,a=ot[0],p=ot[1],m,g,T,G;for(B(arguments,0,2,2),K(),e=0;e<s;e+=2)m=t+(t-a),g=n+(n-p),T=arguments[e],G=arguments[e+1],this.ctx.quadraticCurveTo(m,g,T,G),t=T,n=G,a=m,p=g;return et(t,n),ot=[a,p],this},pt=function(){if(!ot)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=N,a=D,p=ot[0],m=ot[1],g,T,G,j;for(B(arguments,0,2,2),K(),e=0;e<t;e+=2)g=n+(n-p),T=a+(a-m),G=n+arguments[e],j=a+arguments[e+1],this.ctx.quadraticCurveTo(g,T,G,j),n=G,a=j,p=g,m=T;return et(n,a),ot=[p,m],this},mt=function(e,s,t,n,a,p,m){if(!e||!s)return $t.call(this,p,m);n=!!n,a=!!a,K();let g=N,T=D,G=p,j=m,at=t*w,ht=I(at),Tt=S(at),At=(g-G)/2,Dt=(T-j)/2,St=Tt*At+ht*Dt,Lt=-ht*At+Tt*Dt,Xt,Ot,It,Jt,jt,qt,Vt,Mt;if(e=M(e),s=M(s),Xt=St*St/(e*e)+Lt*Lt/(s*s),Xt>1)e*=_(Xt),s*=_(Xt),Ot=It=0;else{let Kt=e*e,Qt=s*s,Zt=St*St,te=Lt*Lt,Nt=Kt*te+Qt*Zt;Nt=_(Kt*Qt/Nt-1),n===a&&(Nt=-Nt),Ot=Nt*e*Lt/s,It=-Nt*s*St/e}return Jt=Tt*(Ot-ht)*(It+(g+G)/2),jt=ht*(Ot+Tt)*(It+(T+j)/2),At=(St-Ot)/e,Dt=(Lt-It)/s,qt=Ct(1,0,At,Dt),Mt=Ct(At,Dt,(-St-Ot)/e,(-Lt-It)/s),a&&Mt<0?Mt+=k:!a&&Mt>0&&(Mt-=k),Vt=qt+Mt,this.ellipse(Jt,jt,e,s,at,qt,Vt,!a),this},ft=function(e,s,t,n,a,p,m){return K(),mt.call(this,e,s,t,n,a,p+N,m+D),this},H=function(e,s,t,n,a,p,m,g){a=a||0,p=p||0,m=m===O?k:m;let T=wt(t*S(p),n*I(p),a),G=e+T[0],j=s+T[1],at=wt(t*S(m),n*I(m),a),ht=e+at[0],Tt=s+at[1];return Q(this,G,j),this.ctx.translate(e,s),this.ctx.rotate(a),this.ctx.scale(t/n,1),this.ctx.arc(0,0,n,p,m,!!g),this.ctx.scale(n/t,1),this.ctx.rotate(-a),this.ctx.translate(-e,-s),et(ht,Tt),this},_t=function(){let e,s=arguments,t=s.length;if(t<6)throw new Error("not enough arguments");if(t%2===0)for(this.ctx.moveTo(s[0],s[1]),e=2;e<t;e+=2)this.ctx.lineTo(s[e],s[e+1]);else{let n=s[t-1],a=(t-1)/2,p=(s[a*2-2]+s[0])/2,m=(s[a*2-1]+s[1])/2,g,T;for(this.ctx.moveTo(p,m),e=0;e<a-1;e++)this.ctx.arcTo(g=s[e*2],T=s[e*2+1],s[e*2+2],s[e*2+3],n,p,m),p=g,m=T;this.ctx.arcTo(s[a*2-2],s[a*2-1],s[0],s[1],n,p,m)}return this},kt=function(e){let s=e.match(ct),t,n,a,p,m,g=[];if(!s)throw new Error("Bad path: "+e);for(p=0;t=s[p];p++){for(a=[],a.cmd=t.charAt(0),n=t.match(Rt)||[],m=0;m<n.length;m++)a[m]=+n[m];g.push(a)}return g},Ut=d.extend({init:function(e){this.svgpath=kt(e),this._super(0,0),this.svgpath[0].cmd.toLowerCase()=="m"&&(this.x=this.svgpath[0][0],this.y=this.svgpath[0][1])},draw:function(e){let s=this.svgpath,t,n;for(this.applyStyle(e),this.setTransform(e),e.beginPath(),f.setContext(e),t=0,n=s.length;t<n;t++)f[s[t].cmd].apply(f,s[t]);this.fill&&e.fill(),this.stroke&&e.stroke()}});return h(f,{distance:l,__zoom:1,Shape:d,setContext:function(e){return this.ctx=e,et(0,0),e.beginPath(),this},polygon:_t,ellipse:H,M:Pt,m:xt,L:$t,l:vt,H:J,h:zt,V:i,v:o,C:c,c:E,S:it,s:bt,Q:A,q:W,T:dt,t:pt,A:mt,a:ft,Z:Et,z:Et}),f.register("image",tt),f.register("circle",lt),f.register("arc",F),f.register("ellipse",U),f.register("rect",P),f.register("text",L),f.register("line",ut),f.register("path",Ut),f}function se(f,v,x){let k=Object.prototype.toString,w="function",_="string",y="array",S="object",I=!1,q=[],M=!1,R,O=f.G_vmlCanvasManager,C=/webkit|msie/i.exec(f.navigator.userAgent),V=navigator.userAgent,Z=V.match(/android/i),$=V.match(/iphone|ipad|ipod/i),b=V.match(/Windows Phone/i)||V.match(/iemobile/i),l=/^([#]?)([a-z][\w\-]*)$/,r=["","LEFT","CENTER","RIGHT"],u=[],h=null,d=null,P=!1,L="Cevent"+new Date().getTime(),z=0,tt={},U=function(i,o){return k.call(i).slice(8,-1).toLowerCase()===o},F=function(i,o){let c,E=0;if(U(i,y))for(;(c=i[E++])&&o(c,E)!==!1;);},lt=function(i,o){let c=ot(i,o);return c>=0?(i.splice(c,1),o):null},ut={click:"touchstart",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},N=function(i){return i=i||f.event,i.preventDefault||(i.preventDefault=function(){this.returnValue=!1}),i.stopPropagation||(i.stopPropagation=function(){this.cancelBubble=!0}),i},D=function(i,o){let c=ut[o];return c?function(E){let A=E.type===c;R=J.isTouchDevice=A,!(!A&&(Z||$||b))&&i.call(this,E)}:i},rt=function(i){return document.getElementById(i)},Y=function(){return document.addEventListener?function(o,c,E){o&&(o=typeof o=="string"?rt(o):o,E=D(E,c),ut[c]&&o.addEventListener(ut[c],E,!0),o.addEventListener(c,E,!0))}:function(o,c,E){o&&(o=typeof o=="string"?rt(o):o,o.attachEvent("on"+c,function(A){return A=N(A),E.call(A.target||A.srcElement,A)}))}}(),ot=function(){return[].indexOf?function(i,o){return i.indexOf(o)}:function(i,o){for(let c=0,E=i.length;c<E;c++)if(o===i[c])return c;return-1}}(),yt=function(i){let o=0,c=0;if(i.offsetParent)do o+=i.offsetLeft,c+=i.offsetTop;while(i=i.offsetParent);return{x:o,y:c}},ct=function(i,o,c){let E=i[L],A;return E||(E=i[L]=++z),A=tt[E],A||(A=tt[E]={}),o&&c!==x&&(A[o]=c),o?A[o]:A},Rt=function(i,o){if(!i)return;let c=i[L];c&&tt[c]&&delete tt[c]},Ct=function(i,o,c){let E=ct(i),A;F(o.split(" "),function(W){A=E[W]=E[W]||[],A.push(c)})},wt=function(i,o,c,E){let A,W=0,it=!0;for(c.ctx.save(),c.ctx.scale(c.__zoom,c.__zoom);A=o[W++];)A.call(i,c,E)===!1&&(it=!1);return c.ctx.restore(),it||E.preventDefault(),it},Q=function(i,o,c,E){let A=ct(i,o),W=ct(E.cv,o);A&&A.length&&u.push(i,A),W&&W.length&&u.push(i,W)},et=function(i,o){let c,E;for(i.clear(),c=0,E=u.length;c<E;c+=2)wt(u[c],u[c+1],i,o);u=[],i.redraw()},K=function(i,o){i.preventDefault(),i=i.touches?i.touches[0]:i;let c,E=o._shapes,A=E.length;for(o.x=((i&&i.pageX-o._pos.x+1||f.event.offsetX+1)-1)/o.__zoom||0,o.y=((i&&i.pageY-o._pos.y+1||f.event.offsetY+1)-1)/o.__zoom||0;c=E[--A];)if(c.hitTest(o))return c},B=function(i,o){return function(c){c.preventDefault(),c=c.touches?c.touches[0]:c,i.lastX=i.x,i.lastY=i.y,o=i._curHover;let E=((c&&c.pageX-i._pos.x+1||f.event.offsetX+1)-1)/i.__zoom||0,A=((c&&c.pageY-i._pos.y+1||f.event.offsetY+1)-1)/i.__zoom||0;if(!(!M&&Math.abs(E-i.x)<2&&Math.abs(A-i.y)<2)){if(i.x=E,i.y=A,M=!0,!i._clicked&&I){let W=K(c,i);W?(o!==W&&(Q(W,"mouseover",c,i),o&&Q(o,"mouseout",c,i)),i._curHover=o=W):o&&(Q(o,"mouseout",c,i),i._curHover=o=null)}o&&Q(o,"mousemove",c,i),u.length&&et(i,c)}}},Pt=function(i){return function(o){(o.type==="mousedown"||o.type==="touchstart")&&i.calcCanvasPosition(),I||(i._curHover=K(o,i)),i._curHover;let c=i._curHover,E=r[o.which||o.button];i._clicked=!0,h=i.cv,i[E]=!0,c?(Q(c,"mousedown",o,i),c!==i.focused&&(Q(c,"focus",o,i),i.focused&&Q(i.focused,"blur",o,i))):i.focused&&(Q(i.focused,"blur",o,i),i.focused=null),i.focused=c||null,u.length&&et(i,o),i[E]=!1}},xt=function(i){return function(o){i._clicked=!1,i._curHover&&(Q(i._curHover,"mouseup",o,i),!M&&R&&(Q(i._curHover,"tap",o,i),i.lastClick&&o.timeStamp-i.lastClick<300&&Q(i._curHover,"dblclick",o,i),i.lastClick=o.timeStamp)),M=!1,u.length&&et(i,o)}},$t=function(i){return function(o){i._curHover&&Q(i._curHover,"click",o,i),u.length&&et(i,o)}},vt=function(i){return function(o){i._curHover&&Q(i._curHover,"dblclick",o,i),u.length&&et(i,o)}},Et=function(){let i={specialKeys:{27:"esc",9:"tab",32:"space",13:"return",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",109:"-",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",191:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",110:".",111:"/",187:"+",189:"-"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"}},o;return function(c,E){let A=ct(E.cv,c,{}),W=ct(A);return function(it){if(h!==E.cv&&!E.__globalkeyevents)return;o=c=="keydown"?it.keyCode:o;let bt=i.specialKeys[o],dt=bt||String.fromCharCode(o||it.charCode).toLowerCase(),pt="",mt;if(it.altKey&&(pt+="alt+"),(it.ctrlKey||it.metaKey)&&(pt+="ctrl+"),it.shiftKey&&(pt+="shift+"),mt=W[pt+dt]||W[pt+i.shiftNums[dt]]||pt==="shift+"&&W[i.shiftNums[dt]]||W.any,mt){let ft=wt(E,mt,E,it);return E.play||E.redraw(),ft}}}}(),J=function(i,o){if(i=U(i,_)?v.getElementById(i):i,i.getContext||f.G_vmlCanvasManager)return new J.fn.init(i,o);throw Error("Your browser sucks")};J.forse_redraw=function(){let i,o=q.length;for(i=0;i<o;i++)q[i].redraw()},J.fn=J.prototype={init:function(i,o){this.cv=i,f.getComputedStyle?this.background=getComputedStyle(this.cv.parentElement).backgroundColor:this.background="#152937",!i.getContext&&f.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(i),this.ctx=i.getContext("2d"),this.width=i.width,this.height=i.height,this.__zoom=1,this.x=0,this.y=0,this.cv[L]?(this._shapes=ct(i,"shapes"),this._last=o):(q.push(this),this._shapes=ct(i,"shapes",[]),this.__cache=ct(i,"cache",document.createElement("canvas")),this._last=null,f.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.__cache),this.__cachectx=this.__cache&&this.__cache.getContext("2d"),this.calcCanvasPosition(),Y(i,"mousemove",B(this),!1),Y(i,"dblclick",vt(this),!1),Y(i,"click",$t(this),!1),Y(i,"mouseup",xt(this),!1),Y(i,"mousedown",Pt(this),!1),Y(v,"keydown",Et("keydown",this),!1),Y(v,"keyup",Et("keyup",this),!1),C||Y(v,"keypress",Et("keypress",this),!1),"onselectstart"in i&&(i.onselectstart=function(){return!1},i.onmousedown=function(){return!1}))},updateCache:function(){this.__cache&&(this.__cache.width=this.cv.width,this.__cache.height=this.cv.height,lt(this._shapes,d),this.draw(),this._shapes.push(d),this.__cachectx.drawImage(this.cv,0,0))},calcCanvasPosition:function(){return this._pos=yt(this.cv),this},get:function(i){return i=i<0?this._shapes.length+i:i,this._shapes[i]||this._shapes},getAll:function(i){let o=[],c=l.exec(i),E,A;return i==="*"?o=this._shapes.slice(0):c&&(E=c[1],A=c[2],F(this._shapes,function(W){W[E]===A&&o.push(W)})),o},remove:function(i){return Rt(lt(this._shapes,i)),this.redraw()},addId:function(i){let o=l.exec(i),c=this._last;return o&&!o[1]&&c&&(c.length?F(c,function(E){E["#"]=i}):c["#"]=i),this},removeId:function(){let i=this._last;return i&&!i.length?i["#"]="":F(i,function(o){o["#"]=""}),this},find:function(i){let o=this.getAll(i);return J(this.cv,o.length===1?o[0]:o)},attr:function(i,o){let c=this._last;return c&&c.attr?c.attr(i,o):F(c,function(E){E.attr(i,o)}),this},rotate:function(i){return this.attr({rotation:i})},translate:function(i,o){return this.attr({tx:i,ty:o})},scale:function(i,o){return this.attr({scaleX:i,scaleY:o})},skewX:function(i){return this.attr({skewX:i})},skewY:function(i){return this.attr({skewY:i})},zoomTo:function(i){return U(i,"number")&&(this.__zoom=i),this},zoomIn:function(){return this.zoomTo(this.__zoom+.1)},zoomOut:function(){return this.zoomTo(this.__zoom-.1)},setGlobalKeyEvents:function(i){return this.__globalkeyevents=!!i,this},bind:function(i,o,c){let E=c||this._last,A;if(!I&&"mouseover mouseout".indexOf(i)!==-1&&(I=!0),U(i,_)&&U(o,S))for(A in o)this[A](i,o[A]);else if(U(i,S))for(A in i)this[A](i[A]);else E&&!E.length?Ct(E,i,o):F(E,function(W){Ct(W,i,o)});return this},beforeDraw:function(i){return U(i,w)&&(this.__beforeDraw=i),this},afterDraw:function(i){return U(i,w)&&(this.__afterDraw=i),this},clear:function(i,o,c,E){return i=i||0,o=o||0,c=c||this.cv.width,E=E||this.cv.height,this.ctx.fillStyle=this.background,this.ctx.fillRect(i,o,c,E),this},draw:function(){let i,o=0,c=this._shapes;if(this.ctx.save(),J.__zoom=this.__zoom,this.__beforeDraw&&this.__beforeDraw.call(this,this),!O&&this.__cache&&P&&!this.play&&d)this.ctx.drawImage(this.__cache,0,0),d.draw(this.ctx);else for(;i=c[o++];)i.draw(this.ctx);return this.__afterDraw&&this.__afterDraw.call(this,this),J.__zoom=1,this.ctx.restore(),this},redraw:function(){return this.clear().draw()},frameCount:0,stop:function(){return delete this.play,this}},J.fn.init.prototype=J.prototype,J.addEventListener=Y;function zt(i,o){let c=l.exec(i);return function(E,A){(c&&this[c[1]]===c[2]||i==="*")&&o.call(this,E,A)}}return F("mousemove mouseover mouseout mousedown mouseup click dblclick focus blur tap".split(" "),function(i){J.fn[i]=function(o,c){let E;return U(c,w)&&(o=zt(o,c),E=this.cv),this.bind(i,o,E)}}),F("keydown keypress keyup".split(" "),function(i){J.fn[i]=function(o,c){return!c&&U(o,w)&&(c=o,o="any"),o=(o+"").toLowerCase(),this.bind(o,c,ct(this.cv,i))}}),C&&(J.fn.keypress=J.fn.keydown),J.fn.drag=function(i){let o,c,E,A,W=[],it,bt="Cevent-drag"+L,dt=this._last;if(U(i,_)&&(it=i,i=arguments[1]),i&&(o=i.start,c=i.move,E=i.end,A=i.afterMove),it)return this.mousedown(it,pt).mouseup(it,ft).mousemove(it,mt);dt&&!dt.length&&(dt=[dt]),F(dt,function(H){ct(H,bt)||(ct(H,bt,!0),W.push(H))}),J(this.cv,W).mousedown(pt).mouseup(ft).mousemove(mt);function pt(H,_t){(H.LEFT||R)&&(d=this,!H.play&&!O&&!P&&H.updateCache())}function mt(H,_t){if(this===d){if(!P){if(o&&o.call(this,H,_t)===!1)return d=P=null;P=!0}c&&c.call(this,H,_t),this.rmove(H.x-H.lastX,H.y-H.lastY),A&&A.call(this,H,_t)}}function ft(H,_t){this===d&&(d=P=null,E&&E.call(this,H,_t))}return this},J.registre=J.register=function(i,o){i=i.toLowerCase();let c=i.charAt(0).toUpperCase()+i.substring(1);this[c]=o,this.prototype[i]=function(){let E=o.apply(this,arguments);return E[""]=i,this._shapes.push(E),this._last=E,this}},Y(v,"mousedown",function(i){let o=i.target||i.srcElement;o=o.nodeName==="OBJECT"?o.parentNode:o,o[L]||(h=o)},!1),J.isTouchDevice=R,f.Cevent=J,J}const gt=ie(se(window,document)),X=function(f){const v={randint:function(_){return~~(Math.random()*_)}};"bind"in Function||(Function.prototype.bind=function(_){let y=this;return function(){return y.apply(_,arguments)}});let x=Gt.extend({init:function(_){this.elem=document.getElementById(_)}}),k=function(_,y,S){return document.addEventListener?function(I,q,M){I.addEventListener(q,M,!1)}:function(I,q,M){I.attachEvent("on"+q,function(R){return R=R||y,R.preventDefault=R.preventDefault||function(){this.returnValue=!1},R.stopPropagation=R.stopPropagation||function(){this.cancelBubble=!0},M.call(R.target||R.srcElement,R)})}}(),w="mousemove mouseover mouseout mousedown mouseup click touchstart dblclick focus blur submit change".split(" ");for(let _=0;_<w.length;_++){let y=w[_];x.prototype[y]=function(S){return function(I,q){typeof I=="function"?k(this.elem,S,I):k(this.elem,S,function(M){let R=M.target||M.srcElement;R.tagName.toLowerCase()===I&&(M.stopPropagation(),q.call(R,M))},!1)}}(y)}return v.fullScreen=function(){document.documentElement.scrollHeight<f.outerHeight/f.devicePixelRatio?(document.body.style.height=f.outerHeight/f.devicePixelRatio+1+"px",setTimeout(function(){f.scrollTo(1,1)},0)):f.scrollTo(1,1)},v.getContext=function(_){return!_.getContext&&f.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(_),_.getContext("2d")},v.extend=function(_,y){let S;for(S in y)y.hasOwnProperty(S)&&!(S in _)&&(_[S]=y[S]);return _},v.calcPieces=function(_,y){let S=_.image.width,I=_.image.height,q=document.getElementById("set-parts"),M,R;q.innerHTML="";for(let O=0;O<_.options.length;O+=1){let C=~~Math.sqrt(S*I/_.options[O]),V=~~(S/C),Z=~~(I/C);for(;V*Z<_.options[O];)C--,V=~~(S/C),Z=~~(I/C);R!==V*Z&&(R=V*Z,M=document.createElement("option"),M.value=_.options[O],M.innerHTML=y(O),q.appendChild(M),_.options[O]===_.selected&&(M.selected=!0))}},v.addEvent=k,v.$=function(){let _=x();return function(y){return _.elem=document.getElementById(y),console.log(_),_}}(),v.getElement=function(_){return document.getElementById(_)},v.ajax=function(_){let y=new XMLHttpRequest;y.onreadystatechange=function(){y.readyState===XMLHttpRequest.DONE&&(y.status===200?_.success&&_.success(y.responseText):_.error&&_.error())},y.open("GET",_.url,!0),y.send()},f.Util=f.Util||v,v}(window),nt=function(){};nt.prototype.setMaxListeners=function(f){this._events||(this._events={}),this._events.maxListeners=f};Array.isArray=Array.isArray||function(f){return f.sort&&f.length&&f.slice};nt.prototype.emit=function(f){if(f==="error"&&(!this._events||!this._events.error||Array.isArray(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;let v=this._events[f];if(!v)return!1;if(typeof v=="function"){switch(arguments.length){case 1:v.call(this);break;case 2:v.call(this,arguments[1]);break;case 3:v.call(this,arguments[1],arguments[2]);break;default:let x=Array.prototype.slice.call(arguments,1);v.apply(this,x)}return!0}if(Array.isArray(v)){let x=Array.prototype.slice.call(arguments,1),k=v.slice();for(let w=0,_=k.length;w<_;w++)k[w].apply(this,x);return!0}return!1};nt.prototype.publish=nt.prototype.emit,nt.prototype.addListener=function(f,v){if(typeof v!="function")throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",f,v),!this._events[f])this._events[f]=v;else if(Array.isArray(this._events[f])){if(this._events[f].push(v),!this._events[f].warned){let x;this._events.maxListeners!==void 0?x=this._events.maxListeners:x=10,x&&x>0&&this._events[f].length>x&&(this._events[f].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[f].length),console.trace())}}else this._events[f]=[this._events[f],v];return this};nt.prototype.on=nt.prototype.subscribe=nt.prototype.addListener,nt.prototype.once=function(f,v){function x(){k.removeListener(f,x),v.apply(this,arguments)}if(typeof v!="function")throw new Error(".once only takes instances of Function");let k=this;return x.listener=v,k.on(f,x),this};nt.prototype.removeListener=function(f,v){if(typeof v!="function")throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[f])return this;let x=this._events[f];if(Array.isArray(x)){let k=-1;for(let w=0,_=x.length;w<_;w++)if(x[w]===v||x[w].listener&&x[w].listener===v){k=w;break}if(k<0)return this;x.splice(k,1),x.length==0&&delete this._events[f]}else(x===v||x.listener&&x.listener===v)&&delete this._events[f];return this};nt.prototype.unsubscribe=nt.prototype.removeListener,nt.prototype.removeAllListeners=function(f){return arguments.length===0?(this._events={},this):(f&&this._events&&this._events[f]&&(this._events[f]=null),this)};nt.prototype.listeners=function(f){return this._events||(this._events={}),this._events[f]||(this._events[f]=[]),Array.isArray(this._events[f])||(this._events[f]=[this._events[f]]),this._events[f]};nt.mixin=function(f){for(let v in nt.prototype)f.prototype[v]||(f.prototype[v]=nt.prototype[v])};const ne=[4,20,50,75,100],re=["очень легко","легко","сложно","очень сложно","эксперт"];function oe(f){return re[f]}function st(){return window.devicePixelRatio||1}(function(f,v,x){let k=X.getContext(f.createElement("canvas")),w=Math.abs,_=Math.PI/180,y=X.getContext(f.createElement("canvas")),S=navigator.userAgent,I=S.match(/android/i),q=S.match(/iphone|ipad|ipod/i),M=S.match(/Windows Phone/i)||S.match(/iemobile/i),R=!I&&!q&&!M,O=20;function C(l,r){if(l.rotation%360||r.rotation%360||r.hide||l.hide||l.row!=r.row&&l.col!=r.col)return;let u=l.tx-r.tx,h=l.ty-r.ty,d=l.col-r.col,P=l.row-r.row,L=l.width,z=l.height;if(l.size,(d==-1&&u<0&&w(u+L)<O||d==1&&u>=0&&w(u-L)<O)&&h<=O&&h>=-20)return[l.col>r.col?-w(u)+L:w(u)-L,r.ty-l.ty];if((P==-1&&h<0&&w(h+z)<O||P==1&&h>=0&&w(h-z)<O)&&u<=O&&u>=-20)return[r.tx-l.tx,l.row>r.row?-w(h)+z:w(h)-z]}let V=gt.Shape.extend({type:"piece",init:function(l,r,u,h,d,P,L){this.flat=L,this._super(l,r),this.img=u,this.originalImg=u,this.size=Math.max(h,d),this.width=h,this.height=d,this.diagonal=~~Math.sqrt(h*h+d*d),this.edges=P,this.lastRotation=0,this.size/2,this.tx=this.x+this.width/2,this.ty=this.y+this.height/2,this.x=-this.width/2,this.y=-this.height/2},draw_path:function(l){let r=this.size,u,h=0;for(l.beginPath(),l.moveTo(this.x,this.y);h<4;h++){u=this.edges[h],r=h%2?this.height:this.width;let d=h%2?this.height:this.width,P=h%2?this.width:this.height,L=h%2?this.y:this.x,z=h%2?this.x:this.y;u?this[u](l,d,P,L,z):l.lineTo(L+r,z),l.rotate(Math.PI/2)}l.closePath()},render:function(l,r){l=l||this.ox||0,r=r||this.oy||0,this.originalTX=this.originalTX||this.tx,this.originalTY=this.originalTY||this.ty;let u=this.ctx||X.getContext(f.createElement("canvas")),h=this.size+.5;y.canvas.width=u.canvas.width=h*2,y.canvas.height=u.canvas.height=h*2,y.save(),u.save(),this.applyStyle(u),y.lineWidth=.5,u.lineWidth=.5,u.translate(this.width,this.height),u.rotate(this.rotation*_),y.translate(this.width,this.height),y.rotate(this.rotation*_),this.draw_path(u),this.draw_path(y),u.fill(),y.drawImage(this.originalImg,-this.originalTX-l,-this.originalTY-r),this.stroke&&(y.globalCompositeOperation="lighter",y.shadowOffsetY=1.5,y.shadowOffsetX=1.5,y.shadowBlur=0,y.shadowColor="rgba(255, 255, 255, .4)",y.lineWidth=1.5,y.strokeStyle="rgba(0, 0, 0, .4)",y.stroke(),y.globalCompositeOperation="darken",y.shadowBlur=1,y.shadowOffsetY=-1,y.shadowOffsetX=-1,y.shadowBlur=2,y.shadowColor="rgba(0, 0, 0, .2)",y.lineWidth=2,y.strokeStyle="rgba(0, 0, 0, .4)",y.stroke(),y.clip()),y.restore(),u.restore(),u.globalCompositeOperation="source-in",u.globalCompositeOperation!=="source-in"&&(u.globalCompositeOperation="source-atop"),u.drawImage(y.canvas,0,0),this.ctx||(this.tx+=this.offset),this.img=u.canvas,this.ctx=u,this.ox=l,this.oy=r},outside:function(l,r,u,h,d){if(this.flat)return l.lineTo(h+r,d);l.lineTo(h+r*.34,d),l.bezierCurveTo(h+r*.5,d,h+r*.4,d+u*-.15,h+r*.4,d+u*-.15),l.bezierCurveTo(h+r*.3,d+u*-.3,h+r*.5,d+u*-.3,h+r*.5,d+u*-.3),l.bezierCurveTo(h+r*.7,d+u*-.3,h+r*.6,d+u*-.15,h+r*.6,d+u*-.15),l.bezierCurveTo(h+r*.5,d,h+r*.65,d,h+r*.65,d),l.lineTo(h+r,d)},inside:function(l,r,u,h,d){if(this.flat)return l.lineTo(h+r,d);l.lineTo(h+r*.35,d),l.bezierCurveTo(h+r*.505,d+.05,h+r*.405,d+u*.155,h+r*.405,d+u*.1505),l.bezierCurveTo(h+r*.3,d+u*.3,h+r*.5,d+u*.3,h+r*.5,d+u*.3),l.bezierCurveTo(h+r*.7,d+u*.29,h+r*.6,d+u*.15,h+r*.6,d+u*.15),l.bezierCurveTo(h+r*.5,d,h+r*.65,d,h+r*.65,d),l.lineTo(h+r,d)},draw:function(l){let r=this.x-this.width/2-.5,u=this.y-this.height/2-.5;if(R){this.setTransform(l),l.drawImage(this.img,r,u);return}this.rotation!==this.lastRotation&&(this.render(),this.lastRotation=this.rotation),l.drawImage(this.img,r+this.tx,u+this.ty)},check:function(l){let r;if(l.type==="piece")r=C(this,l);else{let u,h=l.pieces.length;for(u=0;u<h&&!(r=C(this,l.pieces[u]));u++);}return r&&this.rmove(r[0],r[1]),r},hitTest:function(l){if(!this.hide)return this.setTransform(k),this.draw_path(k),k.isPointInPath(l.x*st(),l.y*st())}}),Z=gt.Shape.extend({type:"group",init:function(){this.pieces=[],this._super(0,0)},draw:function(l){if(this.hide)return;let r,u=this.pieces.length;for(r=0;r<u;r++)this.pieces[r].draw(l)},hitTest:function(l){let r,u=this.pieces.length;for(r=0;r<u;r++)if(this.pieces[r].hitTest(l))return!0},check:function(l){let r,u=this.pieces.length,h;if(l.type==="piece"){for(r=0;r<u;r++)if(h=C(this.pieces[r],l))return this.rmove(h[0],h[1]),!0}else{let d,P=l.pieces.length;for(r=0;r<u;r++)for(d=0;d<P;d++)if(h=C(this.pieces[r],l.pieces[d]))return this.rmove(h[0],h[1]),!0}},rmove:function(l,r){let u,h=this.pieces.length;for(u=0;u<h;u++)this.pieces[u].rmove(l,r);this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty},add:function(){this.pieces=this.pieces.concat.apply(this.pieces,arguments),this.minPieceX=b(this.pieces,"tx"),this.minPieceY=b(this.pieces,"ty"),this.width=$(this.pieces,"tx").tx-this.minPieceX.tx,this.height=$(this.pieces,"ty").ty-this.minPieceY.ty,this.width+=this.pieces[0].width,this.height+=this.pieces[0].height,this.x=this.pieces[0].x,this.y=this.pieces[0].y,this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty}});function $(l,r){let u=l[0][r],h=0;for(let d=1;d<l.length;d++)l[d][r]>u&&(u=l[d][r],h=d);return l[h]}function b(l,r){let u=l[0][r],h=0;for(let d=1;d<l.length;d++)l[d][r]<u&&(u=l[d][r],h=d);return l[h]}gt.register("group",Z),gt.register("piece",V)})(document);const Yt=function(f,v,x){let k="inside",w="outside",_=null,y,S=[k,w],I=0,q={spread:.7,offsetTop:v.innerHeight*.2,maxWidth:v.innerWidth*.8,maxHeight:v.innerHeight*.6,defaultImage:"images/default-puzzle.png",piecesNumberTmpl:"%d Pieces",redirect:"",border:!0,defaultPieces:3,shuffled:!1,rotatePieces:!0,numberOfPieces:ne,squarePieces:!1},M=45,R=st();function O(){return S[X.randint(2)]}let C={};C.Jigsaw=Gt.extend({init:function($){let b=new nt,l=this;this.container=f.body,this.opts=$=X.extend($||{},q),this.max_width=$.maxWidth,this.max_height=$.maxHeight,X.$("redirect-form").action=$.redirect,y=$.defaultImage,this.eventBus=b,this.ce=new gt("canvas"),this.ui=new C.UI(b,$.defaultPieces||10),this.tmp_img=f.createElement("img"),this.img=f.getElementById("image"),this.ctx=X.getContext(this.img),this.preview=f.getElementById("image-preview"),this.previewCtx=X.getContext(this.preview),this.parts=$.defaultPieces||10,this.tmp_img.onload=function(){l.original=this,l.draw_image(this),X.calcPieces({image:l.img,template:l.opts.piecesNumberTmpl,selected:l.parts,options:l.opts.numberOfPieces},oe),l.render()},this.tmp_img.onerror=function(){y&&l.set_image(y)},V(this.ce,b,this.opts.rotatePieces),b.on(C.Events.JIGSAW_COMPLETE,function(){l.ui.stop_clock(),$.redirect?l.redirect():l.ui.show_time()}),$.shuffled&&b.on(C.Events.RENDER_FINISH,this.start_game.bind(this)),b.on(C.Events.PARTS_NUMBER_CHANGED,this.set_parts.bind(this)),b.on(C.Events.RENDER_REQUEST,this.render.bind(this)),b.on(C.Events.START_GAME,this.start_game.bind(this)),b.on(C.Events.JIGSAW_SET_IMAGE,this.set_image.bind(this)),X.addEvent(v,"resize",this.resize.bind(this)),this.resize(),this.set_image()},resize:function(){console.log(1);let b=this.ce.cv,l=this.width(),r=this.height()-M;b.width=l*st(),b.height=r*st(),b.style.width=l+"px",b.style.height=r+"px",this.ce.redraw(),gt.isTouchDevice&&X.fullScreen()},redirect:function(){X.$("t").value=this.ui.time(),X.$("p").value=this.parts,X.$("redirect-form").submit()},set_parts:function($){this.parts=$},set_image:function($){this.ce.cv.className="loading",this.tmp_img.src=$||y},width:function(){return this.container.offsetWidth},height:function(){return this.container.offsetHeight},draw_image:function($,b,l){let r=b||this.max_width*st(),u=l||this.max_height*st(),h,d,P=this.ctx;if(r>this.width()||u>this.height()-M){let L=Math.min(this.width()/r,(this.height()-M)/u);r*=L,u*=L}if($.width>r||$.height>u){let L=Math.min(r/$.width,u/$.height);h=~~($.width*L)*st(),d=~~($.height*L)*st(),P.canvas.width=h,P.canvas.height=d,P.drawImage($,0,0,$.width,$.height,0,0,h,d)}else P.canvas.width=$.width*st(),P.canvas.height=$.height*st(),P.drawImage($,0,0,$.width,$.height,0,0,P.canvas.width,P.canvas.height)},clear:function(){this.ce._shapes=[]},start_game:function(){let $=this.ce.getAll("piece");if(this.__pieces)this.ce._shapes=$=this.__pieces.slice(0);else return;this.ce.clear();let b,l=$.length,r;$[0].size;let u=this.opts.spread,h=this.width()*st(),d=(this.height()-M)*st(),P=h*u,L=d*u,z=~~((h-P)/2),tt=~~((d-L)/2);for(b=0;b<l;b++)r=$[b],r.tx=X.randint(P)+r.tx%1+z,r.ty=X.randint(L)+r.tx%1+tt,this.opts.rotatePieces&&(r.rotation=X.randint(4)*90);this.opts.shuffled&&(this.ce.cv.className="",this.ui.init_clock()),X.getElement("START_GAME").style.display="none",this.ce.find("*").attr({hide:!1}),this.ce.shuffled=!0,this.ce.redraw()},render:function(){this.opts.shuffled?(this.ce.cv.className="loading",this.ce.clear(),this.ui.stop_clock()):this.ce.cv.className="",X.getElement("START_GAME").style.display=null,this.ce.shuffled=!1;let $,b,l,r,u=[],h=[],d=this.img.width,P=this.img.height,L=~~Math.sqrt(d*P/this.parts),z=~~(d/L),tt=~~(P/L),U=0,F=0,lt=++I,ut;for(this.flag=lt;z*tt<this.parts;)L--,z=~~(d/L),tt=~~(P/L);let N=~~(d/z),D=~~(P/tt);N=N%2?N:N-1,D=D%2?D:D-1,ut=~~(this.width()/2*st()-N*z/2),this.clear();let rt=~~((d-z*N)/2),Y=~~((P-tt*D)/2);rt=rt>=0?rt:0,Y=Y>=0?Y:0,this.preview.style.marginTop=this.opts.offsetTop+"px",this.preview.width=N*z,this.preview.height=D*tt,this.preview.style.width=this.preview.width/st()+"px",this.preview.style.height=this.preview.height/st()+"px",this.previewCtx.globalAlpha=.3,this.previewCtx.drawImage(this.img,rt,Y,N*z,D*tt,0,0,N*z,D*tt),(function ot(){U<z&&lt===this.flag?(F<tt?($=F===0?_:l===k?w:k,b=U===z-1?_:O(),l=F===tt-1?_:O(),r=U===0?0:h[F]===k?w:k,this.ce.piece(N*U,D*F+this.opts.offsetTop,v.G_vmlCanvasManager?this.tmp_img:this.img,N,D,[$,b,l,r],this.opts.squarePieces).attr({col:U,row:F,offset:ut,stroke:this.opts.border?"black":""}).get(-1).render(rt,Y-this.opts.offsetTop),this.opts.shuffled||this.ce.redraw(),u.push(b),F++):(U++,F=0,h=u,u=[]),setTimeout(ot.bind(this),20)):this.flag===lt&&(this.__pieces=this.ce.get().slice(0),this.ce.redraw(),this.eventBus.emit(C.Events.RENDER_FINISH))}).bind(this)()}}),C.Events={PARTS_NUMBER_CHANGED:"PartsNumberChanged",RENDER_REQUEST:"RenderRequestEvent",RENDER_FINISH:"RenderFinishEvent",JIGSAW_RENDERED:"JigsawRenderedEvent",JIGSAW_SET_IMAGE:"JigsawSetImageEvent",START_GAME:"JigsawGameStartEvent",SHOW_PREVIEW:"JigsawShowPreview",JIGSAW_COMPLETE:"JigsawCompleteEvent",PIECES_CONNECTED:"PieceConnectedEvent",ZOOM_IN:"JigsawZoomIn",ZOOM_OUT:"JigsawZoomOut"},C.GET=function(){if(location.query)return;let $=location.search.replace(/^[?]/,"").split("&"),b=0,l=$.length,r={};for(;b<l;b++){if(!$[b])continue;let u=$[b].split("=");r[unescape(u[0])]=unescape(u[1])}return r},C.UI=Gt.extend({init:function($,b){this.eventBus=$,this.clock=X.getElement("clock"),Z(this,$),$.on(C.Events.START_GAME,this.init_clock.bind(this)),$.on(C.Events.SHOW_PREVIEW,this.show_preview.bind(this))},stop_clock:function(){I++},init_clock:function(){let $=this;this.ini=new Date().getTime(),this.uuid=I,function b(){console.log($.uuid,I,$.time()),$.uuid===I&&($.clock.innerHTML=$.time(),setTimeout(b,1e3))}()},show_preview:function(){let $=X.getElement("image-preview");$.className=$.className==="show"?"hide":"show",$.style.marginLeft=-($.width/2/R)+"px"},show_time:function(){this.show_modal("congrat"),X.getElement("START_GAME").style.display=null,X.getElement("time").innerHTML=this.clock.innerHTML,X.getElement("time-input").value=this.clock.innerHTML},time:function(){let $=~~((new Date().getTime()-this.ini)/1e3),b=$%60,l=~~($/60),r=~~(l/60);return l%=60,(r>9?r:"0"+r)+":"+(l>9?l:"0"+l%60)+":"+(b>9?b:"0"+b)},show_modal:function($){Ht.Modal.open($)}});function V($,b,l){$.drag("*",{start:function(r,u){r.cv.style.cursor="move",r.lastX*=st(),r.lastY*=st(),this.handleX=r.lastX-this.tx,this.handleY=r.lastY-this.ty},move:function(r,u){r.x*=st(),r.y*=st(),r.x+=r.lastX-this.tx-this.handleX,r.y+=r.lastY-this.ty-this.handleY},afterMove:function(r,u){let h=~~(this.width/2),d=~~(this.height/2),P=this.x+this.tx+h,L=this.y+this.ty+d,z=r.cv.width,tt=r.cv.height;this.rotation/45%2&&(h=this.diagonal/2,d=this.diagonal/2);let U=0,F=0;P-h<0?U=P-h:P+h>z&&(U=P+h-z),L-d<0?F=L-d:L+d>tt&&(F=L+d-tt),this.rmove(-U,-F)},end:function(r,u){if(r.cv.style.cursor="default",!r.shuffled)return;let h=r.getAll("piece").concat(r.getAll("group")),d=0,P=h.length,L=this;for(;d<P;d++)h[d]!==this&&L.check(h[d])&&(r.remove(L),r.remove(h[d]),r._curHover=r.group().get(-1),r._curHover.add(L.pieces||L,h[d].pieces||h[d]),L=r._curHover,r.focused=null);this!==L&&b.emit(C.Events.PIECES_CONNECTED),!$.getAll("piece").length&&$.getAll("group").length===1&&$.shuffled&&($.shuffled=!1,b.emit(C.Events.JIGSAW_COMPLETE)),L.type==="group"&&(r.remove(L),r._shapes.unshift(L))}}).focus("*",function(r,u){r.remove(this),r._shapes.push(this)}),X.addEvent($.cv,"contextmenu",function(r){l&&$.focused&&($.focused.rotation=($.focused.rotation+45)%360,$.redraw()),r.preventDefault()}),l&&($.keydown("right",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation+45)%360),!1}).keydown("left",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation-45)%360),!1}),$.tap("*",function(r,u){gt.isTouchDevice&&$.focused&&($.focused.rotation=($.focused.rotation+45)%360,$.redraw())}))}function Z($,b){function l(h){let d=h[0];if(!d.type.match(/image.*/)){X.getElement("image-error").style.display="block";return}let P=new FileReader;P.onloadend=function(L){b.emit(C.Events.JIGSAW_SET_IMAGE,this.result),r()},P.readAsDataURL(d)}v.FileReader&&new FileReader().onload===null&&(X.getElement("create-puzzle").classList.remove("hide"),X.$("image-input").change(function(){l(this.files)}),"ondragenter"in v&&"ondrop"in v&&(X.getElement("dnd").style.display="block",f.addEventListener("dragenter",function(h){return h.stopPropagation(),h.preventDefault(),!1},!1),f.addEventListener("dragover",function(h){return h.stopPropagation(),h.preventDefault(),!1},!1),f.addEventListener("drop",function(h){h.stopPropagation(),h.preventDefault();let d=h.dataTransfer;l(d.files)},!1)));function r(){return Ht.Modal.close(),!1}function u(h){return console.log(h),h}X.$("set-parts").change(function(){b.emit(C.Events.PARTS_NUMBER_CHANGED,u(this.value)),b.emit(C.Events.RENDER_REQUEST)}),X.$("set-preview").change(function(){b.emit(C.Events.SHOW_PREVIEW)}),gt.addEventListener("game-options","mousedown",function(h){let d=h.target||h.srcElement;C.Events[d.id]&&(h.preventDefault(),b.emit(C.Events[d.id]))})}return nt.mixin(C.Jigsaw),C}(document,window),Ht=function(){let f=0,v=window.Audio&&new Audio().canPlayType,x=0,k=function(O){return document.getElementById(O)},w,_,y,S;function I(){w=k("modal-window"),_=k("modal-window-msg"),y=k("modal-window-close"),S=k("overlay");let O=gt.isTouchDevice?"touchstart":"click";gt.addEventListener(S,O,M),gt.addEventListener(y,O,M)}function q(O,C){w||I();let V=w.style,Z=k(O);Z.className="",Ht.Modal.currentContent=Z,_.appendChild(Z);let $=w.offsetWidth;V.marginLeft=-$/2+"px",w.className="modal",S.className=""}function M(O){O&&O.preventDefault(),w.className="modal hide",S.className="hide";let C=Ht.Modal.currentContent;return setTimeout(function(){C&&(C.className="hide",document.body.appendChild(C))},600),!1}function R(O,C){if(!v)return;let V;for(this.file=O,x=C,this.audio=[],V=0;V<C;V++)this.audio[V]=new Audio;const Z=(function(){document.removeEventListener("touchstart",Z),document.removeEventListener("mousedown",Z),this.load()}).bind(this);document.addEventListener("touchstart",Z),document.addEventListener("mousedown",Z)}return R.prototype.load=function(){if(!v||this._loaded)return;this._loaded=!0;const O=this.audio[0].canPlayType("audio/mp3")?".mp3":".wav";for(let C=0;C<x;C++)this.audio[C].src=this.file+O,this.audio[C].volume=0,this.audio[C].load()},R.prototype.play=function(){v&&(this.audio[f].volume=1,this.audio[f].play(),f=(f+1)%x)},{Sound:R,Modal:{open:q,close:M}}}(),Wt=(()=>{const f="app-slider-panel__animation-init",v="app-slider-panel__expanded",x="app-slider-ov",k="expanded";let w=null,_=[];return{isReadyToUse(){return w!=null},init:function(){if(_=Array.from(document.querySelectorAll(".js-sidebar-open")),w=document.querySelector(".app-slider-panel"),!Wt.isReadyToUse())throw new Error("SliderPanel: elements to init not found");setTimeout(()=>{w.classList.add(f)},0),_.forEach(y=>{y.addEventListener("click",()=>Wt.toggle())}),document.addEventListener("click",y=>{!w.contains(y.target)&&_.every(S=>!S.contains(y.target))&&w.classList.contains(k)&&Wt.toggle()})},toggle:function(){const y=!w.classList.contains(k);w.classList.toggle(k,y),_.forEach(S=>S.classList.toggle("active",y)),document.body.classList.toggle(v,y),matchMedia&&matchMedia("(max-width: 767px)").matches&&document.documentElement.classList.toggle(x,y)}}})();window.addEventListener("DOMContentLoaded",function(){new Wt.init("#sidebar-panel");const f=new Ht.Sound("click",10),v=new Yt.Jigsaw({defaultImage:"./default-puzzle.png",piecesNumberTmpl:"%d Pieces",defaultPieces:3});v.eventBus.on(Yt.Events.PIECES_CONNECTED,function(){f.play()}),Yt.GET.image&&v.set_image(Yt.GET.image)});document.addEventListener("ontouchmove",function(v){v.preventDefault()})});export default ae();
