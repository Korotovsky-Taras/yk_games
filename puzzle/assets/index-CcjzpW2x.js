var ee=(d,$)=>()=>($||d(($={exports:{}}).exports,$),$.exports);var ae=ee((le,Wt)=>{(function(){const $=document.createElement("link").relList;if($&&$.supports&&$.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))A(y);new MutationObserver(y=>{for(const _ of y)if(_.type==="childList")for(const E of _.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&A(E)}).observe(document,{childList:!0,subtree:!0});function P(y){const _={};return y.integrity&&(_.integrity=y.integrity),y.referrerPolicy&&(_.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?_.credentials="include":y.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function A(y){if(y.ep)return;y.ep=!0;const _=P(y);fetch(y.href,_)}})();/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   3.2.2+39aa2571
 */(function(){function d(t){return typeof t=="function"||typeof t=="object"&&t!==null}function $(t){return typeof t=="function"}var P;Array.isArray?P=Array.isArray:P=function(t){return Object.prototype.toString.call(t)==="[object Array]"};var A=P,y=0,_,E,x=function(n,a){u[y]=n,u[y+1]=a,y+=2,y===2&&(E?E(l):C())};function I(t){E=t}function U(t){x=t}var O=typeof window<"u"?window:void 0,z=O||{},H=z.MutationObserver||z.WebKitMutationObserver,L=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",et=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function G(){return function(){process.nextTick(l)}}function g(){return function(){_(l)}}function b(){var t=0,n=new H(l),a=document.createTextNode("");return n.observe(a,{characterData:!0}),function(){a.data=t=++t%2}}function h(){var t=new MessageChannel;return t.port1.onmessage=l,function(){t.port2.postMessage(0)}}function r(){return function(){setTimeout(l,1)}}var u=new Array(1e3);function l(){for(var t=0;t<y;t+=2){var n=u[t],a=u[t+1];n(a),u[t]=void 0,u[t+1]=void 0}y=0}function f(){try{var t=require,n=t("vertx");return _=n.runOnLoop||n.runOnContext,g()}catch{return r()}}var C;L?C=G():H?C=b():et?C=h():O===void 0&&typeof require=="function"?C=f():C=r();function k(t,n){var a=this,p=new this.constructor(lt);p[B]===void 0&&c(p);var m=a._state;if(m){var v=arguments[m-1];x(function(){J(m,p,v,a._result)})}else Pt(a,p,t,n);return p}var R=k;function Z(t){var n=this;if(t&&typeof t=="object"&&t.constructor===n)return t;var a=new n(lt);return Q(a,t),a}var q=Z,B=Math.random().toString(36).substring(16);function lt(){}var ut=void 0,M=1,D=2,rt=new vt;function W(){return new TypeError("You cannot resolve a promise with itself")}function ot(){return new TypeError("A promises callback cannot return that same promise.")}function yt(t){try{return t.then}catch(n){return rt.error=n,rt}}function ct(t,n,a,p){try{t.call(n,a,p)}catch(m){return m}}function zt(t,n,a){x(function(p){var m=!1,v=ct(a,n,function(T){m||(m=!0,n!==T?Q(p,T):K(p,T))},function(T){m||(m=!0,j(p,T))},"Settle: "+(p._label||" unknown promise"));!m&&v&&(m=!0,j(p,v))},t)}function Ct(t,n){n._state===M?K(t,n._result):n._state===D?j(t,n._result):Pt(n,void 0,function(a){Q(t,a)},function(a){j(t,a)})}function wt(t,n,a){n.constructor===t.constructor&&a===R&&constructor.resolve===q?Ct(t,n):a===rt?j(t,rt.error):a===void 0?K(t,n):$(a)?zt(t,n,a):K(t,n)}function Q(t,n){t===n?j(t,W()):d(n)?wt(t,n,yt(n)):K(t,n)}function tt(t){t._onerror&&t._onerror(t._result),xt(t)}function K(t,n){t._state===ut&&(t._result=n,t._state=M,t._subscribers.length!==0&&x(xt,t))}function j(t,n){t._state===ut&&(t._state=D,t._result=n,x(tt,t))}function Pt(t,n,a,p){var m=t._subscribers,v=m.length;t._onerror=null,m[v]=n,m[v+M]=a,m[v+D]=p,v===0&&t._state&&x(xt,t)}function xt(t){var n=t._subscribers,a=t._state;if(n.length!==0){for(var p,m,v=t._result,T=0;T<n.length;T+=3)p=n[T],m=n[T+a],p?J(a,p,m,v):m(v);t._subscribers.length=0}}function vt(){this.error=null}var $t=new vt;function Et(t,n){try{return t(n)}catch(a){return $t.error=a,$t}}function J(t,n,a,p){var m=$(a),v,T,N,V;if(m){if(v=Et(a,p),v===$t?(V=!0,T=v.error,v=null):N=!0,n===v){j(n,ot());return}}else v=p,N=!0;n._state!==ut||(m&&N?Q(n,v):V?j(n,T):t===M?K(n,v):t===D&&j(n,v))}function Ht(t,n){try{n(function(p){Q(t,p)},function(p){j(t,p)})}catch(a){j(t,a)}}var i=0;function o(){return i++}function c(t){t[B]=i++,t._state=void 0,t._result=void 0,t._subscribers=[]}function w(t){return new _t(this,t).promise}var S=w;function F(t){var n=this;return A(t)?new n(function(a,p){for(var m=t.length,v=0;v<m;v++)n.resolve(t[v]).then(a,p)}):new n(function(a,p){p(new TypeError("You must pass an array to race."))})}var it=F;function bt(t){var n=this,a=new n(lt);return j(a,t),a}var dt=bt;function pt(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function gt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ft=X;function X(t){this[B]=o(),this._result=this._state=void 0,this._subscribers=[],lt!==t&&(typeof t!="function"&&pt(),this instanceof X?Ht(this,t):gt())}X.all=S,X.race=it,X.resolve=q,X.reject=dt,X._setScheduler=I,X._setAsap=U,X._asap=x,X.prototype={constructor:X,then:R,catch:function(t){return this.then(null,t)}};var _t=At;function At(t,n){this._instanceConstructor=t,this.promise=new t(lt),this.promise[B]||c(this.promise),A(n)?(this._input=n,this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),this.length===0?K(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&K(this.promise,this._result))):j(this.promise,Ft())}function Ft(){return new Error("Array Methods must be provided an Array")}At.prototype._enumerate=function(){for(var t=this.length,n=this._input,a=0;this._state===ut&&a<t;a++)this._eachEntry(n[a],a)},At.prototype._eachEntry=function(t,n){var a=this._instanceConstructor,p=a.resolve;if(p===q){var m=yt(t);if(m===R&&t._state!==ut)this._settledAt(t._state,n,t._result);else if(typeof m!="function")this._remaining--,this._result[n]=t;else if(a===ft){var v=new a(lt);wt(v,t,m),this._willSettleAt(v,n)}else this._willSettleAt(new a(function(T){T(t)}),n)}else this._willSettleAt(p(t),n)},At.prototype._settledAt=function(t,n,a){var p=this.promise;p._state===ut&&(this._remaining--,t===D?j(p,a):this._result[n]=a),this._remaining===0&&K(p,this._result)},At.prototype._willSettleAt=function(t,n){var a=this;Pt(t,void 0,function(p){a._settledAt(M,n,p)},function(p){a._settledAt(D,n,p)})};function e(){var t;if(typeof global<"u")t=global;else if(typeof self<"u")t=self;else try{t=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;n&&Object.prototype.toString.call(n.resolve())==="[object Promise]"&&!n.cast||(t.Promise=ft)}var s=e;ft.Promise=ft,ft.polyfill=s,typeof define=="function"&&define.amd?define(function(){return ft}):typeof Wt<"u"&&Wt.exports?Wt.exports=ft:typeof this<"u"&&(this.Promise=ft),s()}).call(void 0);let Bt=!1;function Xt(){}Xt.extend=function(d){const $=this.prototype;let P;Bt=!0,P=new this,Bt=!1;for(let y in d)typeof d[y]=="function"&&typeof $[y]=="function"?P[y]=function(_,E){return function(){const x=this._super;this._super=$[_];const I=E.apply(this,arguments);return this._super=x,I}}(y,d[y]):P[y]=d[y];function A(){if(this instanceof A)!Bt&&this.init&&this.init.apply(this,arguments);else return new A(...arguments)}return A.prototype=P,A.prototype.constructor=A,A.extend=this.extend,A};function ie(d){let $=Math,P=$.PI,A=2*P,y=P/180,_=$.sqrt,E=$.pow,x=$.cos,I=$.sin,U=$.round,O=$.abs,z=$.acos,H,L=Object.prototype.hasOwnProperty,et=Array.prototype.slice,G={tx:0,ty:0,scaleX:1,scaleY:1,skewX:0,skewY:0,fill:"#000",stroke:"",lineWidth:1,lineJoin:"miter",lineCap:"butt",alpha:1,rotation:0,composite:"source-over",shadowColor:"rgba(0, 0, 0, 0.0)",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,fontStyle:"normal",fontWeight:"normal",fontSize:10,fontFamily:"Arial"},g=document.createElement("canvas"),b=g.getContext&&g.getContext("2d"),h=function(e,s){return _(E(e.x-s.x,2)+E(e.y-s.y,2))},r=function(e,s,t,n,a){let p=t-e,m=n-s,v={},T;if(!(p===0&&m===0))return T=((a.x-e)*p+(a.y-s)*m)/(p*p+m*m),T<0?v={x:e,y:s}:T>1?v={x:t,y:t}:v={x:e+T*p,y:s+T*m},h(v,a)},u=function(e,s,t){return t=y*t,{x:e*x(t)-s*I(t),y:e*I(t)+s*x(t)}},l=function(e,s){let t;for(t in s)L.call(s,t)&&(e[t]=s[t])},f=Xt.extend({init:function(e,s){this.x=e||0,this.y=s||0,l(this,G)},position:function(){let e=u(this.x*this.scaleX,this.y*this.scaleY,this.rotation);return{x:e.x+this.tx,y:e.y+this.ty}},rmove:function(e,s){this.tx+=e,this.ty+=s},attr:function(e,s){let t;if(typeof e=="string")this[e]=s;else for(t in e)this[t]=e[t];return this},applyStyle:function(e){let s=this.shadowBlur,t=this.shadowOffsetX,n=this.shadowOffsetY;e.fillStyle=this.fill,e.globalAlpha=this.alpha,e.globalCompositeOperation=this.composite,this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.lineWidth),(t||n||s)&&(e.shadowColor=this.shadowColor,e.shadowOffsetX=t,e.shadowOffsetY=n,e.shadowBlur=s)},setTransform:function(e){let s=d.__zoom,t=this.scaleX*s,n=this.scaleY*s,a=this.skewX*s,p=this.skewY*s,m=this.rotation*y,v=I(m),T=x(m),N=this.tx*s,V=this.ty*s,at=T*t-v*p,ht=T*a-v*n,Tt=v*t+T*p,St=v*a+T*n;e.setTransform(at,Tt,ht,St,N,V)},draw:function(e){throw new Error("El método draw no se ha implementado")},fill_or_stroke:function(e){this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(b&&b.isPointInPath)return this.draw(b),b.setTransform(1,0,0,1,0,0),b.isPointInPath(e.x,e.y);throw Error("Método isPointInPath no soportado: Necesita FlashCanvasPro")}}),C=f.extend({init:function(e,s,t,n,a){this.r=a||0,this.w=t||5,this.h=n||t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y,n=this.w,a=this.h;this.applyStyle(e),this.setTransform(e),e.beginPath(),this.r?d.setContext(e).polygon(s,t,s+n,t,s+n,t+a,s,t+a,this.r):e.rect(s,t,U(n),U(a)),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.r)return this._super(e);let s=this.position(),t=u(e.x-s.x,e.y-s.y,-this.rotation);return t.x>=0&&t.x<=this.w*this.scaleX&&t.y>=0&&t.y<=this.h*this.scaleY}}),k=C.extend({init:function(e,s,t){this.setText(t),this._super(e,s,this.w,this.h)},applyStyle:function(e){e.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.h=this.fontSize,this.w=e.measureText(this.text).width,this._super(e)},setText:function(e){this.text=e+""},draw:function(e){this.applyStyle(e),this.setTransform(e),this.fill&&e.fillText(this.text,this.x,this.y+this.h),this.stroke&&e.strokeText(this.text,this.x,this.y+this.h)},hitTest:function(e){return this.skewX||this.skewY&&b&&b.isPointInPath?(this.setTransform(b),b.beginPath(),b.rect(this.x,this.y,this.w,this.h),b.closePath(),b.isPointInPath(e.x,e.y)):this._super(e)}}),R={},Z=C.extend({init:function(e,s,t){this.setImg(t),this._super(e,s,this.img.width,this.img.height)},setImg:function(e){if(R[e]){this.img=R[e],this.src=this.img.src;return}e.nodeName=="IMG"?this.img=e:(e+="",this.img=R[e]=new Image,this.img.src=e),this.img.onload=function(){d.forse_redraw()},this.src=this.img.src},draw:function(e){let s=this.x,t=this.y;this.w=this.img.width,this.h=this.img.height,this.applyStyle(e),this.setTransform(e),e===b?(e.beginPath(),e.rect(s,t,U(this.w),U(this.h)),e.closePath()):e.drawImage(this.img,s,t)}}),q=C.extend({draw:function(e){let s=this.x,t=this.y,n=this.w,a=this.h,p=.5522847498307933,m=p*n,v=p*a;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(s+n,t),e.bezierCurveTo(s+n,t-v,s+m,t-a,s,t-a),e.bezierCurveTo(s-m,t-a,s-n,t-v,s-n,t),e.bezierCurveTo(s-n,t+v,s-m,t+a,s,t+a),e.bezierCurveTo(s+m,t+a,s+n,t+v,s+n,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:f.prototype.hitTest}),B=f.extend({init:function(e,s,t,n,a,p){this.clockwise=p,this.endAngle=a,this.startAngle=n,this.r=t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,U(this.r),this.startAngle||P*2,this.endAngle||0,!!this.clockwise),e.lineTo(s,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()}}),lt=f.extend({init:function(e,s,t){this.r=t||5,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,U(this.r),0,P*2,!0),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.scaleX!==this.scaleY)return this._super(e);let s=!!this.stroke&&this.lineWidth,t=this.position();return h(e,t)<=(this.r+s)*this.scaleX}}),ut=f.extend({init:function(e,s,t,n){this.x2=t,this.y2=n,this._super(e,s),this.stroke="#000"},rmove:function(e,s){this.x+=e,this.y+=s,this.x2+=e,this.y2+=s},applyStyle:function(e){e.lineJoin=this.lineJoin,e.lineCap=this.lineCap,this._super(e)},draw:function(e){this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.x2,this.y2),e.stroke()},hitTest:function(e){return r(this.x,this.y,this.x2,this.y2,e)<=this.lineWidth+2}}),M,D,rt,W=null,ot=null,yt=!1,ct=/[MmLlZzHhVvCcQqSsTtAa]\s*([\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?[,\s]*)*/g,zt=/[\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?/g,Ct=function(e,s,t,n){let a=e*t+s*n,p=_(e*e+s*s),m=_(t*t+n*n),v=a/(p*m),T,N;return v>1?v=1:v<-1&&(v=-1),T=O(z(v)),N=e*n-s*t,N===O(N)?T:-T},wt=function(e,s,t){return[e*x(t)-s*I(t),s*x(t)+e*I(t)]},Q=function(e,s,t){yt&&e.ctx.moveTo(s,t)},tt=function(e,s){M=e,D=s,W=null,ot=null,yt=!1},K=function(){if(M===H)throw new Error("No current point; can't use relative coordinates")},j=function(e,s,t,n){if(s!==(t?e.length%t:e.length)||e.length<n)throw new Error("wrong number of arguments")},Pt=function(e,s){return this.ctx.moveTo(e,s),tt(e,s),rt=e,arguments.length>2&&vt.apply(this,et.call(arguments,2)),this},xt=function(e,s){return yt&&(M=D=0),K(),e+=M,s+=D,this.ctx.moveTo(e,s),tt(e,s),rt=e,arguments.length>2&&$t.apply(this,et.call(arguments,2)),this},vt=function(e,s){let t,n=arguments.length;for(j(arguments,0,2,2),Q(this,e,s),this.ctx.lineTo(e,s),t=2;t<n;t+=2)this.ctx.lineTo(e=arguments[t],s=arguments[t+1]);return tt(e,s),this},$t=function(e,s){let t,n=M,a=D,p=arguments.length;for(j(arguments,0,2,2),K(),t=0;t<p;t+=2)this.ctx.lineTo(n+=arguments[t],a+=arguments[t+1]);return tt(n,a),this},Et=function(){return this.ctx.closePath(),tt(this,rt),this},J=function(e){let s,t=arguments.length;for(K(),s=0;s<t;s++)vt.call(this,arguments[s],D);return this},Ht=function(e){let s,t=arguments.length;for(s=0;s<t;s++)$t.call(this,arguments[s],0);return this},i=function(e){let s,t=arguments.length;for(K(),s=0;s<t;s++)vt.call(this,M,arguments[s]);return this},o=function(e){let s,t=arguments.length;for(s=0;s<t;s++)$t.call(this,0,arguments[s]);return this},c=function(e,s,t,n,a,p){let m,v=arguments,T=arguments.length;for(j(v,0,6,6),Q(this,e,t),this.ctx.bezierCurveTo(e,s,t,n,a,p),m=6;m<T;m+=6)this.ctx.bezierCurveTo(v[m],v[m+1],t=v[m+2],n=v[m+3],a=v[m+4],p=v[m+5]);return tt(a,p),W=[t,n],this},w=function(e,s,t,n,a,p){let m,v=arguments,T=v.length,N=M,V=D;for(j(v,0,6,6),K(),m=0;m<T;m+=6)this.ctx.bezierCurveTo(N+v[m],V+v[m+1],t=N+v[m+2],n=V+v[m+3],N+=v[m+4],V+=v[m+5]);return tt(N,V),W=[t,n],this},S=function(e,s,t,n){let a,p=arguments,m=p.length;for(j(arguments,0,4,4),Q(this,e,s),this.ctx.quadraticCurveTo(e,s,t,n),a=4;a<m;a+=4)this.ctx.quadraticCurveTo(e=p[a],s=p[a+1],t=p[a+2],n=p[a+3]);return tt(t,n),ot=[e,s],this},F=function(e,s,t,n){let a,p=arguments,m=p.length,v=M,T=D;for(j(arguments,0,4,4),K(),a=0;a<m;a+=4)this.ctx.quadraticCurveTo(e=v+p[a],s=T+p[a+1],v+=p[a+2],T+=p[a+3]);return tt(v,T),ot=[e,s],this},it=function(){if(!W)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=M,a=D,p=W[0],m=W[1],v,T,N,V,at,ht;for(j(arguments,0,4,4),K(),e=0;e<t;e+=4)v=n+(n-p),N=a+(a-m),T=s[e],V=s[e+1],at=s[e+2],ht=s[e+3],this.ctx.bezierCurveTo(v,N,T,V,at,ht),n=at,a=ht,p=T,m=V;return tt(n,a),W=[p,m],this},bt=function(){if(!W)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=M,a=D,p=W[0],m=W[1],v,T,N,V,at,ht;for(j(arguments,0,4,4),K(),e=0;e<t;e+=4)v=n+(n-p),N=a+(a-m),T=n+s[e],V=a+s[e+1],at=n+s[e+2],ht=a+s[e+3],this.ctx.bezierCurveTo(v,N,T,V,at,ht),n=at,a=ht,p=T,m=V;return tt(n,a),W=[p,m],this},dt=function(){if(!ot)throw new Error("Last command was not a cubic bezier");let e,s=arguments.length,t=M,n=D,a=ot[0],p=ot[1],m,v,T,N;for(j(arguments,0,2,2),K(),e=0;e<s;e+=2)m=t+(t-a),v=n+(n-p),T=arguments[e],N=arguments[e+1],this.ctx.quadraticCurveTo(m,v,T,N),t=T,n=N,a=m,p=v;return tt(t,n),ot=[a,p],this},pt=function(){if(!ot)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=M,a=D,p=ot[0],m=ot[1],v,T,N,V;for(j(arguments,0,2,2),K(),e=0;e<t;e+=2)v=n+(n-p),T=a+(a-m),N=n+arguments[e],V=a+arguments[e+1],this.ctx.quadraticCurveTo(v,T,N,V),n=N,a=V,p=v,m=T;return tt(n,a),ot=[p,m],this},gt=function(e,s,t,n,a,p,m){if(!e||!s)return vt.call(this,p,m);n=!!n,a=!!a,K();let v=M,T=D,N=p,V=m,at=t*y,ht=I(at),Tt=x(at),St=(v-N)/2,Gt=(T-V)/2,kt=Tt*St+ht*Gt,It=-ht*St+Tt*Gt,Yt,Mt,Rt,jt,Jt,Ut,Vt,Dt;if(e=O(e),s=O(s),Yt=kt*kt/(e*e)+It*It/(s*s),Yt>1)e*=_(Yt),s*=_(Yt),Mt=Rt=0;else{let Kt=e*e,Qt=s*s,Zt=kt*kt,te=It*It,Nt=Kt*te+Qt*Zt;Nt=_(Kt*Qt/Nt-1),n===a&&(Nt=-Nt),Mt=Nt*e*It/s,Rt=-Nt*s*kt/e}return jt=Tt*(Mt-ht)*(Rt+(v+N)/2),Jt=ht*(Mt+Tt)*(Rt+(T+V)/2),St=(kt-Mt)/e,Gt=(It-Rt)/s,Ut=Ct(1,0,St,Gt),Dt=Ct(St,Gt,(-kt-Mt)/e,(-It-Rt)/s),a&&Dt<0?Dt+=A:!a&&Dt>0&&(Dt-=A),Vt=Ut+Dt,this.ellipse(jt,Jt,e,s,at,Ut,Vt,!a),this},ft=function(e,s,t,n,a,p,m){return K(),gt.call(this,e,s,t,n,a,p+M,m+D),this},X=function(e,s,t,n,a,p,m,v){a=a||0,p=p||0,m=m===H?A:m;let T=wt(t*x(p),n*I(p),a),N=e+T[0],V=s+T[1],at=wt(t*x(m),n*I(m),a),ht=e+at[0],Tt=s+at[1];return Q(this,N,V),this.ctx.translate(e,s),this.ctx.rotate(a),this.ctx.scale(t/n,1),this.ctx.arc(0,0,n,p,m,!!v),this.ctx.scale(n/t,1),this.ctx.rotate(-a),this.ctx.translate(-e,-s),tt(ht,Tt),this},_t=function(){let e,s=arguments,t=s.length;if(t<6)throw new Error("not enough arguments");if(t%2===0)for(this.ctx.moveTo(s[0],s[1]),e=2;e<t;e+=2)this.ctx.lineTo(s[e],s[e+1]);else{let n=s[t-1],a=(t-1)/2,p=(s[a*2-2]+s[0])/2,m=(s[a*2-1]+s[1])/2,v,T;for(this.ctx.moveTo(p,m),e=0;e<a-1;e++)this.ctx.arcTo(v=s[e*2],T=s[e*2+1],s[e*2+2],s[e*2+3],n,p,m),p=v,m=T;this.ctx.arcTo(s[a*2-2],s[a*2-1],s[0],s[1],n,p,m)}return this},At=function(e){let s=e.match(ct),t,n,a,p,m,v=[];if(!s)throw new Error("Bad path: "+e);for(p=0;t=s[p];p++){for(a=[],a.cmd=t.charAt(0),n=t.match(zt)||[],m=0;m<n.length;m++)a[m]=+n[m];v.push(a)}return v},Ft=f.extend({init:function(e){this.svgpath=At(e),this._super(0,0),this.svgpath[0].cmd.toLowerCase()=="m"&&(this.x=this.svgpath[0][0],this.y=this.svgpath[0][1])},draw:function(e){let s=this.svgpath,t,n;for(this.applyStyle(e),this.setTransform(e),e.beginPath(),d.setContext(e),t=0,n=s.length;t<n;t++)d[s[t].cmd].apply(d,s[t]);this.fill&&e.fill(),this.stroke&&e.stroke()}});return l(d,{distance:h,__zoom:1,Shape:f,setContext:function(e){return this.ctx=e,tt(0,0),e.beginPath(),this},polygon:_t,ellipse:X,M:Pt,m:xt,L:vt,l:$t,H:J,h:Ht,V:i,v:o,C:c,c:w,S:it,s:bt,Q:S,q:F,T:dt,t:pt,A:gt,a:ft,Z:Et,z:Et}),d.register("image",Z),d.register("circle",lt),d.register("arc",B),d.register("ellipse",q),d.register("rect",C),d.register("text",k),d.register("line",ut),d.register("path",Ft),d}function se(d,$,P){let A=Object.prototype.toString,y="function",_="string",E="array",x="object",I=!1,U=[],O=!1,z,H=d.G_vmlCanvasManager,L=/webkit|msie/i.exec(d.navigator.userAgent),et=navigator.userAgent,G=et.match(/android/i),g=et.match(/iphone|ipad|ipod/i),b=et.match(/Windows Phone/i)||et.match(/iemobile/i),h=/^([#]?)([a-z][\w\-]*)$/,r=["","LEFT","CENTER","RIGHT"],u=[],l=null,f=null,C=!1,k="Cevent"+new Date().getTime(),R=0,Z={},q=function(i,o){return A.call(i).slice(8,-1).toLowerCase()===o},B=function(i,o){let c,w=0;if(q(i,E))for(;(c=i[w++])&&o(c,w)!==!1;);},lt=function(i,o){let c=ot(i,o);return c>=0?(i.splice(c,1),o):null},ut={click:"touchstart",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},M=function(i){return i=i||d.event,i.preventDefault||(i.preventDefault=function(){this.returnValue=!1}),i.stopPropagation||(i.stopPropagation=function(){this.cancelBubble=!0}),i},D=function(i,o){let c=ut[o];return c?function(w){let S=w.type===c;z=J.isTouchDevice=S,!(!S&&(G||g||b))&&i.call(this,w)}:i},rt=function(i){return document.getElementById(i)},W=function(){return document.addEventListener?function(o,c,w){o&&(o=typeof o=="string"?rt(o):o,w=D(w,c),ut[c]&&o.addEventListener(ut[c],w,!0),o.addEventListener(c,w,!0))}:function(o,c,w){o&&(o=typeof o=="string"?rt(o):o,o.attachEvent("on"+c,function(S){return S=M(S),w.call(S.target||S.srcElement,S)}))}}(),ot=function(){return[].indexOf?function(i,o){return i.indexOf(o)}:function(i,o){for(let c=0,w=i.length;c<w;c++)if(o===i[c])return c;return-1}}(),yt=function(i){let o=0,c=0;if(i.offsetParent)do o+=i.offsetLeft,c+=i.offsetTop;while(i=i.offsetParent);return{x:o,y:c}},ct=function(i,o,c){let w=i[k],S;return w||(w=i[k]=++R),S=Z[w],S||(S=Z[w]={}),o&&c!==P&&(S[o]=c),o?S[o]:S},zt=function(i,o){if(!i)return;let c=i[k];c&&Z[c]&&delete Z[c]},Ct=function(i,o,c){let w=ct(i),S;B(o.split(" "),function(F){S=w[F]=w[F]||[],S.push(c)})},wt=function(i,o,c,w){let S,F=0,it=!0;for(c.ctx.save(),c.ctx.scale(c.__zoom,c.__zoom);S=o[F++];)S.call(i,c,w)===!1&&(it=!1);return c.ctx.restore(),it||w.preventDefault(),it},Q=function(i,o,c,w){let S=ct(i,o),F=ct(w.cv,o);S&&S.length&&u.push(i,S),F&&F.length&&u.push(i,F)},tt=function(i,o){let c,w;for(i.clear(),c=0,w=u.length;c<w;c+=2)wt(u[c],u[c+1],i,o);u=[],i.redraw()},K=function(i,o){i.preventDefault(),i=i.touches?i.touches[0]:i;let c,w=o._shapes,S=w.length;for(o.x=((i&&i.pageX-o._pos.x+1||d.event.offsetX+1)-1)/o.__zoom||0,o.y=((i&&i.pageY-o._pos.y+1||d.event.offsetY+1)-1)/o.__zoom||0;c=w[--S];)if(c.hitTest(o))return c},j=function(i,o){return function(c){c.preventDefault(),c=c.touches?c.touches[0]:c,i.lastX=i.x,i.lastY=i.y,o=i._curHover;let w=((c&&c.pageX-i._pos.x+1||d.event.offsetX+1)-1)/i.__zoom||0,S=((c&&c.pageY-i._pos.y+1||d.event.offsetY+1)-1)/i.__zoom||0;if(!(!O&&Math.abs(w-i.x)<2&&Math.abs(S-i.y)<2)){if(i.x=w,i.y=S,O=!0,!i._clicked&&I){let F=K(c,i);F?(o!==F&&(Q(F,"mouseover",c,i),o&&Q(o,"mouseout",c,i)),i._curHover=o=F):o&&(Q(o,"mouseout",c,i),i._curHover=o=null)}o&&Q(o,"mousemove",c,i),u.length&&tt(i,c)}}},Pt=function(i){return function(o){(o.type==="mousedown"||o.type==="touchstart")&&i.calcCanvasPosition(),I||(i._curHover=K(o,i)),i._curHover;let c=i._curHover,w=r[o.which||o.button];i._clicked=!0,l=i.cv,i[w]=!0,c?(Q(c,"mousedown",o,i),c!==i.focused&&(Q(c,"focus",o,i),i.focused&&Q(i.focused,"blur",o,i))):i.focused&&(Q(i.focused,"blur",o,i),i.focused=null),i.focused=c||null,u.length&&tt(i,o),i[w]=!1}},xt=function(i){return function(o){i._clicked=!1,i._curHover&&(Q(i._curHover,"mouseup",o,i),!O&&z&&(Q(i._curHover,"tap",o,i),i.lastClick&&o.timeStamp-i.lastClick<300&&Q(i._curHover,"dblclick",o,i),i.lastClick=o.timeStamp)),O=!1,u.length&&tt(i,o)}},vt=function(i){return function(o){i._curHover&&Q(i._curHover,"click",o,i),u.length&&tt(i,o)}},$t=function(i){return function(o){i._curHover&&Q(i._curHover,"dblclick",o,i),u.length&&tt(i,o)}},Et=function(){let i={specialKeys:{27:"esc",9:"tab",32:"space",13:"return",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",109:"-",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",191:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",110:".",111:"/",187:"+",189:"-"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"}},o;return function(c,w){let S=ct(w.cv,c,{}),F=ct(S);return function(it){if(l!==w.cv&&!w.__globalkeyevents)return;o=c=="keydown"?it.keyCode:o;let bt=i.specialKeys[o],dt=bt||String.fromCharCode(o||it.charCode).toLowerCase(),pt="",gt;if(it.altKey&&(pt+="alt+"),(it.ctrlKey||it.metaKey)&&(pt+="ctrl+"),it.shiftKey&&(pt+="shift+"),gt=F[pt+dt]||F[pt+i.shiftNums[dt]]||pt==="shift+"&&F[i.shiftNums[dt]]||F.any,gt){let ft=wt(w,gt,w,it);return w.play||w.redraw(),ft}}}}(),J=function(i,o){if(i=q(i,_)?$.getElementById(i):i,i.getContext||d.G_vmlCanvasManager)return new J.fn.init(i,o);throw Error("Your browser sucks")};J.forse_redraw=function(){let i,o=U.length;for(i=0;i<o;i++)U[i].redraw()},J.fn=J.prototype={init:function(i,o){this.cv=i,d.getComputedStyle?this.background=getComputedStyle(this.cv.parentElement).backgroundColor:this.background="#152937",!i.getContext&&d.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(i),this.ctx=i.getContext("2d"),this.width=i.width,this.height=i.height,this.__zoom=1,this.x=0,this.y=0,this.cv[k]?(this._shapes=ct(i,"shapes"),this._last=o):(U.push(this),this._shapes=ct(i,"shapes",[]),this.__cache=ct(i,"cache",document.createElement("canvas")),this._last=null,d.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.__cache),this.__cachectx=this.__cache&&this.__cache.getContext("2d"),this.calcCanvasPosition(),W(i,"mousemove",j(this),!1),W(i,"dblclick",$t(this),!1),W(i,"click",vt(this),!1),W(i,"mouseup",xt(this),!1),W(i,"mousedown",Pt(this),!1),W($,"keydown",Et("keydown",this),!1),W($,"keyup",Et("keyup",this),!1),L||W($,"keypress",Et("keypress",this),!1),"onselectstart"in i&&(i.onselectstart=function(){return!1},i.onmousedown=function(){return!1}))},updateCache:function(){this.__cache&&(this.__cache.width=this.cv.width,this.__cache.height=this.cv.height,lt(this._shapes,f),this.draw(),this._shapes.push(f),this.__cachectx.drawImage(this.cv,0,0))},calcCanvasPosition:function(){return this._pos=yt(this.cv),this},get:function(i){return i=i<0?this._shapes.length+i:i,this._shapes[i]||this._shapes},getAll:function(i){let o=[],c=h.exec(i),w,S;return i==="*"?o=this._shapes.slice(0):c&&(w=c[1],S=c[2],B(this._shapes,function(F){F[w]===S&&o.push(F)})),o},remove:function(i){return zt(lt(this._shapes,i)),this.redraw()},addId:function(i){let o=h.exec(i),c=this._last;return o&&!o[1]&&c&&(c.length?B(c,function(w){w["#"]=i}):c["#"]=i),this},removeId:function(){let i=this._last;return i&&!i.length?i["#"]="":B(i,function(o){o["#"]=""}),this},find:function(i){let o=this.getAll(i);return J(this.cv,o.length===1?o[0]:o)},attr:function(i,o){let c=this._last;return c&&c.attr?c.attr(i,o):B(c,function(w){w.attr(i,o)}),this},rotate:function(i){return this.attr({rotation:i})},translate:function(i,o){return this.attr({tx:i,ty:o})},scale:function(i,o){return this.attr({scaleX:i,scaleY:o})},skewX:function(i){return this.attr({skewX:i})},skewY:function(i){return this.attr({skewY:i})},zoomTo:function(i){return q(i,"number")&&(this.__zoom=i),this},zoomIn:function(){return this.zoomTo(this.__zoom+.1)},zoomOut:function(){return this.zoomTo(this.__zoom-.1)},setGlobalKeyEvents:function(i){return this.__globalkeyevents=!!i,this},bind:function(i,o,c){let w=c||this._last,S;if(!I&&"mouseover mouseout".indexOf(i)!==-1&&(I=!0),q(i,_)&&q(o,x))for(S in o)this[S](i,o[S]);else if(q(i,x))for(S in i)this[S](i[S]);else w&&!w.length?Ct(w,i,o):B(w,function(F){Ct(F,i,o)});return this},beforeDraw:function(i){return q(i,y)&&(this.__beforeDraw=i),this},afterDraw:function(i){return q(i,y)&&(this.__afterDraw=i),this},clear:function(i,o,c,w){return i=i||0,o=o||0,c=c||this.cv.width,w=w||this.cv.height,this.ctx.fillStyle=this.background,this.ctx.fillRect(i,o,c,w),this},draw:function(){let i,o=0,c=this._shapes;if(this.ctx.save(),J.__zoom=this.__zoom,this.__beforeDraw&&this.__beforeDraw.call(this,this),!H&&this.__cache&&C&&!this.play&&f)this.ctx.drawImage(this.__cache,0,0),f.draw(this.ctx);else for(;i=c[o++];)i.draw(this.ctx);return this.__afterDraw&&this.__afterDraw.call(this,this),J.__zoom=1,this.ctx.restore(),this},redraw:function(){return this.clear().draw()},frameCount:0,stop:function(){return delete this.play,this}},J.fn.init.prototype=J.prototype,J.addEventListener=W;function Ht(i,o){let c=h.exec(i);return function(w,S){(c&&this[c[1]]===c[2]||i==="*")&&o.call(this,w,S)}}return B("mousemove mouseover mouseout mousedown mouseup click dblclick focus blur tap".split(" "),function(i){J.fn[i]=function(o,c){let w;return q(c,y)&&(o=Ht(o,c),w=this.cv),this.bind(i,o,w)}}),B("keydown keypress keyup".split(" "),function(i){J.fn[i]=function(o,c){return!c&&q(o,y)&&(c=o,o="any"),o=(o+"").toLowerCase(),this.bind(o,c,ct(this.cv,i))}}),L&&(J.fn.keypress=J.fn.keydown),J.fn.drag=function(i){let o,c,w,S,F=[],it,bt="Cevent-drag"+k,dt=this._last;if(q(i,_)&&(it=i,i=arguments[1]),i&&(o=i.start,c=i.move,w=i.end,S=i.afterMove),it)return this.mousedown(it,pt).mouseup(it,ft).mousemove(it,gt);dt&&!dt.length&&(dt=[dt]),B(dt,function(X){ct(X,bt)||(ct(X,bt,!0),F.push(X))}),J(this.cv,F).mousedown(pt).mouseup(ft).mousemove(gt);function pt(X,_t){(X.LEFT||z)&&(f=this,!X.play&&!H&&!C&&X.updateCache())}function gt(X,_t){if(this===f){if(!C){if(o&&o.call(this,X,_t)===!1)return f=C=null;C=!0}c&&c.call(this,X,_t),this.rmove(X.x-X.lastX,X.y-X.lastY),S&&S.call(this,X,_t)}}function ft(X,_t){this===f&&(f=C=null,w&&w.call(this,X,_t))}return this},J.registre=J.register=function(i,o){i=i.toLowerCase();let c=i.charAt(0).toUpperCase()+i.substring(1);this[c]=o,this.prototype[i]=function(){let w=o.apply(this,arguments);return w[""]=i,this._shapes.push(w),this._last=w,this}},W($,"mousedown",function(i){let o=i.target||i.srcElement;o=o.nodeName==="OBJECT"?o.parentNode:o,o[k]||(l=o)},!1),J.isTouchDevice=z,d.Cevent=J,J}const mt=ie(se(window,document)),Y=function(d){const $={randint:function(_){return~~(Math.random()*_)}};"bind"in Function||(Function.prototype.bind=function(_){let E=this;return function(){return E.apply(_,arguments)}});let P=Xt.extend({init:function(_){this.elem=document.getElementById(_)}}),A=function(_,E,x){return document.addEventListener?function(I,U,O){I.addEventListener(U,O,!1)}:function(I,U,O){I.attachEvent("on"+U,function(z){return z=z||E,z.preventDefault=z.preventDefault||function(){this.returnValue=!1},z.stopPropagation=z.stopPropagation||function(){this.cancelBubble=!0},O.call(z.target||z.srcElement,z)})}}(),y="mousemove mouseover mouseout mousedown mouseup click touchstart dblclick focus blur submit change".split(" ");for(let _=0;_<y.length;_++){let E=y[_];P.prototype[E]=function(x){return function(I,U){typeof I=="function"?A(this.elem,x,I):A(this.elem,x,function(O){let z=O.target||O.srcElement;z.tagName.toLowerCase()===I&&(O.stopPropagation(),U.call(z,O))},!1)}}(E)}return $.fullScreen=function(){document.documentElement.scrollHeight<d.outerHeight/d.devicePixelRatio?(document.body.style.height=d.outerHeight/d.devicePixelRatio+1+"px",setTimeout(function(){d.scrollTo(1,1)},0)):d.scrollTo(1,1)},$.getContext=function(_){return!_.getContext&&d.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(_),_.getContext("2d")},$.extend=function(_,E){let x;for(x in E)E.hasOwnProperty(x)&&!(x in _)&&(_[x]=E[x]);return _},$.calcPieces=function(_,E){let x=_.image.width,I=_.image.height,U=document.getElementById("set-parts"),O,z;U.innerHTML="";for(let H=0;H<_.options.length;H+=1){let L=~~Math.sqrt(x*I/_.options[H]),et=~~(x/L),G=~~(I/L);for(;et*G<_.options[H];)L--,et=~~(x/L),G=~~(I/L);z!==et*G&&(z=et*G,O=document.createElement("option"),O.value=_.options[H],O.innerHTML=E(H),U.appendChild(O),_.options[H]===_.selected&&(O.selected=!0))}},$.addEvent=A,$.$=function(){let _=P();return function(E){return _.elem=document.getElementById(E),_}}(),$.getElement=function(_){return document.getElementById(_)},$.ajax=function(_){let E=new XMLHttpRequest;E.onreadystatechange=function(){E.readyState===XMLHttpRequest.DONE&&(E.status===200?_.success&&_.success(E.responseText):_.error&&_.error())},E.open("GET",_.url,!0),E.send()},d.Util=d.Util||$,$}(window),nt=function(){};nt.prototype.setMaxListeners=function(d){this._events||(this._events={}),this._events.maxListeners=d};Array.isArray=Array.isArray||function(d){return d.sort&&d.length&&d.slice};nt.prototype.emit=function(d){if(d==="error"&&(!this._events||!this._events.error||Array.isArray(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;let $=this._events[d];if(!$)return!1;if(typeof $=="function"){switch(arguments.length){case 1:$.call(this);break;case 2:$.call(this,arguments[1]);break;case 3:$.call(this,arguments[1],arguments[2]);break;default:let P=Array.prototype.slice.call(arguments,1);$.apply(this,P)}return!0}if(Array.isArray($)){let P=Array.prototype.slice.call(arguments,1),A=$.slice();for(let y=0,_=A.length;y<_;y++)A[y].apply(this,P);return!0}return!1};nt.prototype.publish=nt.prototype.emit,nt.prototype.addListener=function(d,$){if(typeof $!="function")throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",d,$),!this._events[d])this._events[d]=$;else if(Array.isArray(this._events[d])){if(this._events[d].push($),!this._events[d].warned){let P;this._events.maxListeners!==void 0?P=this._events.maxListeners:P=10,P&&P>0&&this._events[d].length>P&&(this._events[d].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[d].length),console.trace())}}else this._events[d]=[this._events[d],$];return this};nt.prototype.on=nt.prototype.subscribe=nt.prototype.addListener,nt.prototype.once=function(d,$){function P(){A.removeListener(d,P),$.apply(this,arguments)}if(typeof $!="function")throw new Error(".once only takes instances of Function");let A=this;return P.listener=$,A.on(d,P),this};nt.prototype.removeListener=function(d,$){if(typeof $!="function")throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[d])return this;let P=this._events[d];if(Array.isArray(P)){let A=-1;for(let y=0,_=P.length;y<_;y++)if(P[y]===$||P[y].listener&&P[y].listener===$){A=y;break}if(A<0)return this;P.splice(A,1),P.length==0&&delete this._events[d]}else(P===$||P.listener&&P.listener===$)&&delete this._events[d];return this};nt.prototype.unsubscribe=nt.prototype.removeListener,nt.prototype.removeAllListeners=function(d){return arguments.length===0?(this._events={},this):(d&&this._events&&this._events[d]&&(this._events[d]=null),this)};nt.prototype.listeners=function(d){return this._events||(this._events={}),this._events[d]||(this._events[d]=[]),Array.isArray(this._events[d])||(this._events[d]=[this._events[d]]),this._events[d]};nt.mixin=function(d){for(let $ in nt.prototype)d.prototype[$]||(d.prototype[$]=nt.prototype[$])};const ne=[3,20,50,75,100],re=["очень легко","легко","сложно","очень сложно","эксперт"];function oe(d){return re[d]}function st(){return window.devicePixelRatio||1}(function(d,$,P){let A=Y.getContext(d.createElement("canvas")),y=Math.abs,_=Math.PI/180,E=Y.getContext(d.createElement("canvas")),x=navigator.userAgent,I=x.match(/android/i),U=x.match(/iphone|ipad|ipod/i),O=x.match(/Windows Phone/i)||x.match(/iemobile/i),z=!I&&!U&&!O,H=20;function L(h,r){if(h.rotation%360||r.rotation%360||r.hide||h.hide||h.row!=r.row&&h.col!=r.col)return;let u=h.tx-r.tx,l=h.ty-r.ty,f=h.col-r.col,C=h.row-r.row,k=h.width,R=h.height;if(h.size,(f==-1&&u<0&&y(u+k)<H||f==1&&u>=0&&y(u-k)<H)&&l<=H&&l>=-20)return[h.col>r.col?-y(u)+k:y(u)-k,r.ty-h.ty];if((C==-1&&l<0&&y(l+R)<H||C==1&&l>=0&&y(l-R)<H)&&u<=H&&u>=-20)return[r.tx-h.tx,h.row>r.row?-y(l)+R:y(l)-R]}let et=mt.Shape.extend({type:"piece",init:function(h,r,u,l,f,C,k){this.flat=k,this._super(h,r),this.img=u,this.originalImg=u,this.size=Math.max(l,f),this.width=l,this.height=f,this.diagonal=~~Math.sqrt(l*l+f*f),this.edges=C,this.lastRotation=0,this.size/2,this.tx=this.x+this.width/2,this.ty=this.y+this.height/2,this.x=-this.width/2,this.y=-this.height/2},draw_path:function(h){let r=this.size,u,l=0;for(h.beginPath(),h.moveTo(this.x,this.y);l<4;l++){u=this.edges[l],r=l%2?this.height:this.width;let f=l%2?this.height:this.width,C=l%2?this.width:this.height,k=l%2?this.y:this.x,R=l%2?this.x:this.y;u?this[u](h,f,C,k,R):h.lineTo(k+r,R),h.rotate(Math.PI/2)}h.closePath()},render:function(h,r){h=h||this.ox||0,r=r||this.oy||0,this.originalTX=this.originalTX||this.tx,this.originalTY=this.originalTY||this.ty;let u=this.ctx||Y.getContext(d.createElement("canvas")),l=this.size+.5;E.canvas.width=u.canvas.width=l*2,E.canvas.height=u.canvas.height=l*2,E.save(),u.save(),this.applyStyle(u),E.lineWidth=.5,u.lineWidth=.5,u.translate(this.width,this.height),u.rotate(this.rotation*_),E.translate(this.width,this.height),E.rotate(this.rotation*_),this.draw_path(u),this.draw_path(E),u.fill(),E.drawImage(this.originalImg,-this.originalTX-h,-this.originalTY-r),this.stroke&&(E.globalCompositeOperation="lighter",E.shadowOffsetY=1.5,E.shadowOffsetX=1.5,E.shadowBlur=0,E.shadowColor="rgba(255, 255, 255, .4)",E.lineWidth=1.5,E.strokeStyle="rgba(0, 0, 0, .4)",E.stroke(),E.globalCompositeOperation="darken",E.shadowBlur=1,E.shadowOffsetY=-1,E.shadowOffsetX=-1,E.shadowBlur=2,E.shadowColor="rgba(0, 0, 0, .2)",E.lineWidth=2,E.strokeStyle="rgba(0, 0, 0, .4)",E.stroke(),E.clip()),E.restore(),u.restore(),u.globalCompositeOperation="source-in",u.globalCompositeOperation!=="source-in"&&(u.globalCompositeOperation="source-atop"),u.drawImage(E.canvas,0,0),this.ctx||(this.tx+=this.offset),this.img=u.canvas,this.ctx=u,this.ox=h,this.oy=r},outside:function(h,r,u,l,f){if(this.flat)return h.lineTo(l+r,f);h.lineTo(l+r*.34,f),h.bezierCurveTo(l+r*.5,f,l+r*.4,f+u*-.15,l+r*.4,f+u*-.15),h.bezierCurveTo(l+r*.3,f+u*-.3,l+r*.5,f+u*-.3,l+r*.5,f+u*-.3),h.bezierCurveTo(l+r*.7,f+u*-.3,l+r*.6,f+u*-.15,l+r*.6,f+u*-.15),h.bezierCurveTo(l+r*.5,f,l+r*.65,f,l+r*.65,f),h.lineTo(l+r,f)},inside:function(h,r,u,l,f){if(this.flat)return h.lineTo(l+r,f);h.lineTo(l+r*.35,f),h.bezierCurveTo(l+r*.505,f+.05,l+r*.405,f+u*.155,l+r*.405,f+u*.1505),h.bezierCurveTo(l+r*.3,f+u*.3,l+r*.5,f+u*.3,l+r*.5,f+u*.3),h.bezierCurveTo(l+r*.7,f+u*.29,l+r*.6,f+u*.15,l+r*.6,f+u*.15),h.bezierCurveTo(l+r*.5,f,l+r*.65,f,l+r*.65,f),h.lineTo(l+r,f)},draw:function(h){let r=this.x-this.width/2-.5,u=this.y-this.height/2-.5;if(z){this.setTransform(h),h.drawImage(this.img,r,u);return}this.rotation!==this.lastRotation&&(this.render(),this.lastRotation=this.rotation),h.drawImage(this.img,r+this.tx,u+this.ty)},check:function(h){let r;if(h.type==="piece")r=L(this,h);else{let u,l=h.pieces.length;for(u=0;u<l&&!(r=L(this,h.pieces[u]));u++);}return r&&this.rmove(r[0],r[1]),r},hitTest:function(h){if(!this.hide)return this.setTransform(A),this.draw_path(A),A.isPointInPath(h.x*st(),h.y*st())}}),G=mt.Shape.extend({type:"group",init:function(){this.pieces=[],this._super(0,0)},draw:function(h){if(this.hide)return;let r,u=this.pieces.length;for(r=0;r<u;r++)this.pieces[r].draw(h)},hitTest:function(h){let r,u=this.pieces.length;for(r=0;r<u;r++)if(this.pieces[r].hitTest(h))return!0},check:function(h){let r,u=this.pieces.length,l;if(h.type==="piece"){for(r=0;r<u;r++)if(l=L(this.pieces[r],h))return this.rmove(l[0],l[1]),!0}else{let f,C=h.pieces.length;for(r=0;r<u;r++)for(f=0;f<C;f++)if(l=L(this.pieces[r],h.pieces[f]))return this.rmove(l[0],l[1]),!0}},rmove:function(h,r){let u,l=this.pieces.length;for(u=0;u<l;u++)this.pieces[u].rmove(h,r);this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty},add:function(){this.pieces=this.pieces.concat.apply(this.pieces,arguments),this.minPieceX=b(this.pieces,"tx"),this.minPieceY=b(this.pieces,"ty"),this.width=g(this.pieces,"tx").tx-this.minPieceX.tx,this.height=g(this.pieces,"ty").ty-this.minPieceY.ty,this.width+=this.pieces[0].width,this.height+=this.pieces[0].height,this.x=this.pieces[0].x,this.y=this.pieces[0].y,this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty}});function g(h,r){let u=h[0][r],l=0;for(let f=1;f<h.length;f++)h[f][r]>u&&(u=h[f][r],l=f);return h[l]}function b(h,r){let u=h[0][r],l=0;for(let f=1;f<h.length;f++)h[f][r]<u&&(u=h[f][r],l=f);return h[l]}mt.register("group",G),mt.register("piece",et)})(document);const Ot=function(d,$,P){let A="inside",y="outside",_=null,E,x=[A,y],I=0,U={spread:.7,offsetTop:$.innerHeight*.2,maxWidth:$.innerWidth*.8,maxHeight:$.innerHeight*.6,defaultImage:"images/0.jpg",piecesNumberTmpl:"%d Pieces",redirect:"",border:!0,defaultPieces:3,shuffled:!1,rotatePieces:!0,numberOfPieces:ne,squarePieces:!1},O=45,z=st();function H(){return x[Y.randint(2)]}let L={};L.Jigsaw=Xt.extend({init:function(g){let b=new nt,h=this;this.container=d.body,this.opts=g=Y.extend(g||{},U),this.max_width=g.maxWidth,this.max_height=g.maxHeight,Y.$("redirect-form").action=g.redirect,E=g.defaultImage,this.eventBus=b,this.ce=new mt("canvas"),this.ui=new L.UI(b,g.defaultPieces||10),this.tmp_img=d.createElement("img"),this.img=d.getElementById("image"),this.ctx=Y.getContext(this.img),this.preview=d.getElementById("image-preview"),this.previewCtx=Y.getContext(this.preview),this.parts=g.defaultPieces||10,this.tmp_img.onload=function(){h.original=this,h.draw_image(this),Y.calcPieces({image:h.img,template:h.opts.piecesNumberTmpl,selected:h.parts,options:h.opts.numberOfPieces},oe),h.render()},this.tmp_img.onerror=function(){E&&h.set_image(E)},et(this.ce,b,this.opts.rotatePieces),b.on(L.Events.JIGSAW_COMPLETE,function(){h.ui.stop_clock(),g.redirect?h.redirect():h.ui.show_time()}),g.shuffled&&b.on(L.Events.RENDER_FINISH,this.start_game.bind(this)),b.on(L.Events.PARTS_NUMBER_CHANGED,this.set_parts.bind(this)),b.on(L.Events.RENDER_REQUEST,this.render.bind(this)),b.on(L.Events.START_GAME,this.start_game.bind(this)),b.on(L.Events.JIGSAW_SET_IMAGE,this.set_image.bind(this)),Y.addEvent($,"resize",this.resize.bind(this)),this.resize(),this.set_image()},resize:function(){let b=this.ce.cv,h=this.width(),r=this.height()-O;b.width=h*st(),b.height=r*st(),b.style.width=h+"px",b.style.height=r+"px",this.ce.redraw(),mt.isTouchDevice&&Y.fullScreen()},redirect:function(){Y.$("t").value=this.ui.time(),Y.$("p").value=this.parts,Y.$("redirect-form").submit()},set_parts:function(g){this.parts=g},set_image:function(g){this.ce.cv.className="loading",this.tmp_img.src=g||E},width:function(){return this.container.offsetWidth},height:function(){return this.container.offsetHeight},draw_image:function(g,b,h){let r=b||this.max_width*st(),u=h||this.max_height*st(),l,f,C=this.ctx;if(r>this.width()||u>this.height()-O){let k=Math.min(this.width()/r,(this.height()-O)/u);r*=k,u*=k}if(g.width>r||g.height>u){let k=Math.min(r/g.width,u/g.height);l=~~(g.width*k)*st(),f=~~(g.height*k)*st(),C.canvas.width=l,C.canvas.height=f,C.drawImage(g,0,0,g.width,g.height,0,0,l,f)}else C.canvas.width=g.width*st(),C.canvas.height=g.height*st(),C.drawImage(g,0,0,g.width,g.height,0,0,C.canvas.width,C.canvas.height)},clear:function(){this.ce._shapes=[]},start_game:function(){let g=this.ce.getAll("piece");if(this.__pieces)this.ce._shapes=g=this.__pieces.slice(0);else return;this.ce.clear();let b,h=g.length,r;g[0].size;let u=this.opts.spread,l=this.width()*st(),f=(this.height()-O)*st(),C=l*u,k=f*u,R=~~((l-C)/2),Z=~~((f-k)/2);for(b=0;b<h;b++)r=g[b],r.tx=Y.randint(C)+r.tx%1+R,r.ty=Y.randint(k)+r.tx%1+Z,this.opts.rotatePieces&&(r.rotation=Y.randint(4)*90);this.opts.shuffled&&(this.ce.cv.className="",this.ui.init_clock()),Y.getElement("START_GAME").style.display="none",this.ce.find("*").attr({hide:!1}),this.ce.shuffled=!0,this.ce.redraw()},render:function(){this.opts.shuffled?(this.ce.cv.className="loading",this.ce.clear(),this.ui.stop_clock()):this.ce.cv.className="",Y.getElement("START_GAME").style.display=null,this.ce.shuffled=!1;let g,b,h,r,u=[],l=[],f=this.img.width,C=this.img.height,k=~~Math.sqrt(f*C/this.parts),R=~~(f/k),Z=~~(C/k),q=0,B=0,lt=++I,ut;for(this.flag=lt;R*Z<this.parts;)k--,R=~~(f/k),Z=~~(C/k);let M=~~(f/R),D=~~(C/Z);M=M%2?M:M-1,D=D%2?D:D-1,ut=~~(this.width()/2*st()-M*R/2),this.clear();let rt=~~((f-R*M)/2),W=~~((C-Z*D)/2);rt=rt>=0?rt:0,W=W>=0?W:0,this.preview.style.marginTop=this.opts.offsetTop+"px",this.preview.width=M*R,this.preview.height=D*Z,this.preview.style.width=this.preview.width/st()+"px",this.preview.style.height=this.preview.height/st()+"px",this.previewCtx.globalAlpha=.3,this.previewCtx.drawImage(this.img,rt,W,M*R,D*Z,0,0,M*R,D*Z),(function ot(){q<R&&lt===this.flag?(B<Z?(g=B===0?_:h===A?y:A,b=q===R-1?_:H(),h=B===Z-1?_:H(),r=q===0?0:l[B]===A?y:A,this.ce.piece(M*q,D*B+this.opts.offsetTop,$.G_vmlCanvasManager?this.tmp_img:this.img,M,D,[g,b,h,r],this.opts.squarePieces).attr({col:q,row:B,offset:ut,stroke:this.opts.border?"black":""}).get(-1).render(rt,W-this.opts.offsetTop),this.opts.shuffled||this.ce.redraw(),u.push(b),B++):(q++,B=0,l=u,u=[]),setTimeout(ot.bind(this),20)):this.flag===lt&&(this.__pieces=this.ce.get().slice(0),this.ce.redraw(),this.eventBus.emit(L.Events.RENDER_FINISH))}).bind(this)()}}),L.Events={PARTS_NUMBER_CHANGED:"PartsNumberChanged",RENDER_REQUEST:"RenderRequestEvent",RENDER_FINISH:"RenderFinishEvent",JIGSAW_RENDERED:"JigsawRenderedEvent",JIGSAW_SET_IMAGE:"JigsawSetImageEvent",START_GAME:"JigsawGameStartEvent",SHOW_PREVIEW:"JigsawShowPreview",JIGSAW_COMPLETE:"JigsawCompleteEvent",PIECES_CONNECTED:"PieceConnectedEvent",SHOW_SIDEBAR:"ShowSidebarEvent",HIDE_SIDEBAR:"HideSidebarEvent",ZOOM_IN:"JigsawZoomIn",ZOOM_OUT:"JigsawZoomOut"},L.GET=function(){if(location.query)return;let g=location.search.replace(/^[?]/,"").split("&"),b=0,h=g.length,r={};for(;b<h;b++){if(!g[b])continue;let u=g[b].split("=");r[unescape(u[0])]=unescape(u[1])}return r},L.UI=Xt.extend({init:function(g,b){this.eventBus=g,this.clock=Y.getElement("clock"),G(this,g),g.on(L.Events.START_GAME,this.init_clock.bind(this)),g.on(L.Events.SHOW_PREVIEW,this.show_preview.bind(this))},stop_clock:function(){I++},init_clock:function(){let g=this;this.ini=new Date().getTime(),this.uuid=I,function b(){g.uuid===I&&(g.clock.innerHTML=g.time(),setTimeout(b,1e3))}()},show_preview:function(){let g=Y.getElement("image-preview");g.className=g.className==="show"?"hide":"show",g.style.marginLeft=-(g.width/2/z)+"px"},show_time:function(){this.show_modal("congrat"),Y.getElement("START_GAME").style.display=null,Y.getElement("time").innerHTML=this.clock.innerHTML},time:function(){let g=~~((new Date().getTime()-this.ini)/1e3),b=g%60,h=~~(g/60),r=~~(h/60);return h%=60,(r>9?r:"0"+r)+":"+(h>9?h:"0"+h%60)+":"+(b>9?b:"0"+b)},show_modal:function(g){qt.Modal.open(g)}});function et(g,b,h){g.drag("*",{start:function(r,u){r.cv.style.cursor="move",r.lastX*=st(),r.lastY*=st(),this.handleX=r.lastX-this.tx,this.handleY=r.lastY-this.ty},move:function(r,u){r.x*=st(),r.y*=st(),r.x+=r.lastX-this.tx-this.handleX,r.y+=r.lastY-this.ty-this.handleY},afterMove:function(r,u){let l=~~(this.width/2),f=~~(this.height/2),C=this.x+this.tx+l,k=this.y+this.ty+f,R=r.cv.width,Z=r.cv.height;this.rotation/45%2&&(l=this.diagonal/2,f=this.diagonal/2);let q=0,B=0;C-l<0?q=C-l:C+l>R&&(q=C+l-R),k-f<0?B=k-f:k+f>Z&&(B=k+f-Z),this.rmove(-q,-B)},end:function(r,u){if(r.cv.style.cursor="default",!r.shuffled)return;let l=r.getAll("piece").concat(r.getAll("group")),f=0,C=l.length,k=this;for(;f<C;f++)l[f]!==this&&k.check(l[f])&&(r.remove(k),r.remove(l[f]),r._curHover=r.group().get(-1),r._curHover.add(k.pieces||k,l[f].pieces||l[f]),k=r._curHover,r.focused=null);this!==k&&b.emit(L.Events.PIECES_CONNECTED),!g.getAll("piece").length&&g.getAll("group").length===1&&g.shuffled&&(g.shuffled=!1,b.emit(L.Events.JIGSAW_COMPLETE)),k.type==="group"&&(r.remove(k),r._shapes.unshift(k))}}).focus("*",function(r,u){r.remove(this),r._shapes.push(this)}),Y.addEvent(g.cv,"contextmenu",function(r){h&&g.focused&&(g.focused.rotation=(g.focused.rotation+45)%360,g.redraw()),r.preventDefault()}),h&&(g.keydown("right",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation+45)%360),!1}).keydown("left",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation-45)%360),!1}),g.tap("*",function(r,u){mt.isTouchDevice&&g.focused&&(g.focused.rotation=(g.focused.rotation+45)%360,g.redraw())}))}function G(g,b){function h(l){let f=l[0];if(!f.type.match(/image.*/)){Y.getElement("image-error").style.display="block";return}let C=new FileReader;C.onloadend=function(k){b.emit(L.Events.JIGSAW_SET_IMAGE,this.result),r()},C.readAsDataURL(f)}$.FileReader&&new FileReader().onload===null&&(Y.getElement("create-puzzle").classList.remove("hide"),Y.$("image-input").change(function(){h(this.files)}),"ondragenter"in $&&"ondrop"in $&&(Y.getElement("dnd").style.display="block",d.addEventListener("dragenter",function(l){return l.stopPropagation(),l.preventDefault(),!1},!1),d.addEventListener("dragover",function(l){return l.stopPropagation(),l.preventDefault(),!1},!1),d.addEventListener("drop",function(l){l.stopPropagation(),l.preventDefault();let f=l.dataTransfer;h(f.files)},!1)));function r(){return qt.Modal.close(),!1}function u(l){return l}Array.from(d.querySelectorAll(".app-slider-selector")).forEach(function(l){Y.addEvent(l,"click",function(f){b.emit(L.Events.JIGSAW_SET_IMAGE,f.target.src),b.emit(L.Events.HIDE_SIDEBAR)})}),Y.$("set-parts").change(function(){b.emit(L.Events.PARTS_NUMBER_CHANGED,this.value),b.emit(L.Events.RENDER_REQUEST)}),Y.$("set-preview").change(function(){b.emit(L.Events.SHOW_PREVIEW)}),mt.addEventListener("game-options","mousedown",function(l){let f=l.target||l.srcElement;L.Events[f.id]&&(l.preventDefault(),b.emit(L.Events[f.id]))})}return nt.mixin(L.Jigsaw),L}(document,window),Lt=(()=>{const d="app-slider-panel__animation-init",$="app-slider-panel__expanded",P="app-slider-ov",A="expanded";let y=null,_=[],E=[];return{isReadyToUse(){return y!=null},init:function(x){if(x.on(Ot.Events.SHOW_SIDEBAR,function(){Lt.show(!0)}),x.on(Ot.Events.HIDE_SIDEBAR,function(){Lt.show(!1)}),_=Array.from(document.querySelectorAll(".js-sidebar-open")),y=document.querySelector(".app-slider-panel"),!Lt.isReadyToUse())throw new Error("SliderPanel: elements to init not found");setTimeout(()=>{y.classList.add(d)},0),_.forEach(I=>{I.addEventListener("click",()=>Lt.toggle())}),E=[..._,Array.from(document.querySelectorAll(".js-sidebar-skip--event"))],document.addEventListener("click",I=>{!y.contains(I.target)&&E.every(U=>!U.contains(I.target))&&y.classList.contains(A)&&Lt.toggle()})},toggle:function(){Lt.show(!y.classList.contains(A))},show:function(x){console.log({panel:y}),y.classList.toggle(A,x),_.forEach(I=>I.classList.toggle("active",x)),document.body.classList.toggle($,x),matchMedia&&matchMedia("(max-width: 767px)").matches&&document.documentElement.classList.toggle(P,x)}}})(),qt=function(){let d=0,$=window.Audio&&new Audio().canPlayType,P=0,A=function(G){return document.getElementById(G)},y,_,E,x,I;function U(G){y=new Ot.Jigsaw(G);const g=new et("click",10);new Lt.init(y.eventBus),y.eventBus.on(Ot.Events.PIECES_CONNECTED,function(){g.play()}),Ot.GET.image&&y.set_image(Ot.GET.image)}function O(){_=A("modal-window"),E=A("modal-window-close"),x=A("modal-window-choice"),I=A("overlay");let G=mt.isTouchDevice?"touchstart":"click";mt.addEventListener(I,G,H),mt.addEventListener(E,G,H),mt.addEventListener(x,G,L)}function z(){_||O(),_.className="modal",I.className=""}function H(G){return G&&G.preventDefault(),_.className="modal hide",I.className="hide",!1}function L(G){return H(G),console.log(111),y.eventBus.emit(Ot.Events.SHOW_SIDEBAR),!1}function et(G,g){if(!$)return;let b;for(this.file=G,P=g,this.audio=[],b=0;b<g;b++)this.audio[b]=new Audio;const h=(function(){document.removeEventListener("touchstart",h),document.removeEventListener("mousedown",h),this.load()}).bind(this);document.addEventListener("touchstart",h),document.addEventListener("mousedown",h)}return et.prototype.load=function(){if(!$||this._loaded)return;this._loaded=!0;const G=this.audio[0].canPlayType("audio/mp3")?".mp3":".wav";for(let g=0;g<P;g++)this.audio[g].src=this.file+G,this.audio[g].volume=0,this.audio[g].load()},et.prototype.play=function(){$&&(this.audio[d].volume=1,this.audio[d].play(),d=(d+1)%P)},{configure:U,Modal:{open:z,close:H}}}();window.addEventListener("DOMContentLoaded",function(){qt.configure({defaultImage:"./images/0.jpg",piecesNumberTmpl:"%d Pieces",defaultPieces:3})});document.addEventListener("ontouchmove",function($){$.preventDefault()})});export default ae();
