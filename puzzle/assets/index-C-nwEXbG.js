var ee=(c,$)=>()=>($||c(($={exports:{}}).exports,$),$.exports);var ae=ee((le,Ft)=>{(function(){const $=document.createElement("link").relList;if($&&$.supports&&$.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))x(w);new MutationObserver(w=>{for(const _ of w)if(_.type==="childList")for(const y of _.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&x(y)}).observe(document,{childList:!0,subtree:!0});function T(w){const _={};return w.integrity&&(_.integrity=w.integrity),w.referrerPolicy&&(_.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?_.credentials="include":w.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function x(w){if(w.ep)return;w.ep=!0;const _=T(w);fetch(w.href,_)}})();/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   3.2.2+39aa2571
 */(function(){function c(t){return typeof t=="function"||typeof t=="object"&&t!==null}function $(t){return typeof t=="function"}var T;Array.isArray?T=Array.isArray:T=function(t){return Object.prototype.toString.call(t)==="[object Array]"};var x=T,w=0,_,y,S=function(n,a){u[w]=n,u[w+1]=a,w+=2,w===2&&(y?y(h):k())};function O(t){y=t}function q(t){S=t}var I=typeof window<"u"?window:void 0,N=I||{},M=N.MutationObserver||N.WebKitMutationObserver,P=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",V=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function Z(){return function(){process.nextTick(h)}}function v(){return function(){_(h)}}function b(){var t=0,n=new M(h),a=document.createTextNode("");return n.observe(a,{characterData:!0}),function(){a.data=t=++t%2}}function l(){var t=new MessageChannel;return t.port1.onmessage=h,function(){t.port2.postMessage(0)}}function r(){return function(){setTimeout(h,1)}}var u=new Array(1e3);function h(){for(var t=0;t<w;t+=2){var n=u[t],a=u[t+1];n(a),u[t]=void 0,u[t+1]=void 0}w=0}function d(){try{var t=require,n=t("vertx");return _=n.runOnLoop||n.runOnContext,v()}catch{return r()}}var k;P?k=Z():M?k=b():V?k=l():I===void 0&&typeof require=="function"?k=d():k=r();function L(t,n){var a=this,p=new this.constructor(lt);p[F]===void 0&&f(p);var m=a._state;if(m){var g=arguments[m-1];S(function(){J(m,p,g,a._result)})}else Pt(a,p,t,n);return p}var z=L;function tt(t){var n=this;if(t&&typeof t=="object"&&t.constructor===n)return t;var a=new n(lt);return Q(a,t),a}var U=tt,F=Math.random().toString(36).substring(16);function lt(){}var ut=void 0,R=1,D=2,rt=new $t;function Y(){return new TypeError("You cannot resolve a promise with itself")}function ot(){return new TypeError("A promises callback cannot return that same promise.")}function yt(t){try{return t.then}catch(n){return rt.error=n,rt}}function ct(t,n,a,p){try{t.call(n,a,p)}catch(m){return m}}function Nt(t,n,a){S(function(p){var m=!1,g=ct(a,n,function(C){m||(m=!0,n!==C?Q(p,C):K(p,C))},function(C){m||(m=!0,B(p,C))},"Settle: "+(p._label||" unknown promise"));!m&&g&&(m=!0,B(p,g))},t)}function Ct(t,n){n._state===R?K(t,n._result):n._state===D?B(t,n._result):Pt(n,void 0,function(a){Q(t,a)},function(a){B(t,a)})}function wt(t,n,a){n.constructor===t.constructor&&a===z&&constructor.resolve===U?Ct(t,n):a===rt?B(t,rt.error):a===void 0?K(t,n):$(a)?Nt(t,n,a):K(t,n)}function Q(t,n){t===n?B(t,Y()):c(n)?wt(t,n,yt(n)):K(t,n)}function et(t){t._onerror&&t._onerror(t._result),xt(t)}function K(t,n){t._state===ut&&(t._result=n,t._state=R,t._subscribers.length!==0&&S(xt,t))}function B(t,n){t._state===ut&&(t._state=D,t._result=n,S(et,t))}function Pt(t,n,a,p){var m=t._subscribers,g=m.length;t._onerror=null,m[g]=n,m[g+R]=a,m[g+D]=p,g===0&&t._state&&S(xt,t)}function xt(t){var n=t._subscribers,a=t._state;if(n.length!==0){for(var p,m,g=t._result,C=0;C<n.length;C+=3)p=n[C],m=n[C+a],p?J(a,p,m,g):m(g);t._subscribers.length=0}}function $t(){this.error=null}var vt=new $t;function Et(t,n){try{return t(n)}catch(a){return vt.error=a,vt}}function J(t,n,a,p){var m=$(a),g,C,G,j;if(m){if(g=Et(a,p),g===vt?(j=!0,C=g.error,g=null):G=!0,n===g){B(n,ot());return}}else g=p,G=!0;n._state!==ut||(m&&G?Q(n,g):j?B(n,C):t===R?K(n,g):t===D&&B(n,g))}function zt(t,n){try{n(function(p){Q(t,p)},function(p){B(t,p)})}catch(a){B(t,a)}}var i=0;function o(){return i++}function f(t){t[F]=i++,t._state=void 0,t._result=void 0,t._subscribers=[]}function E(t){return new _t(this,t).promise}var A=E;function W(t){var n=this;return x(t)?new n(function(a,p){for(var m=t.length,g=0;g<m;g++)n.resolve(t[g]).then(a,p)}):new n(function(a,p){p(new TypeError("You must pass an array to race."))})}var it=W;function bt(t){var n=this,a=new n(lt);return B(a,t),a}var dt=bt;function pt(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function mt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ft=H;function H(t){this[F]=o(),this._result=this._state=void 0,this._subscribers=[],lt!==t&&(typeof t!="function"&&pt(),this instanceof H?zt(this,t):mt())}H.all=A,H.race=it,H.resolve=U,H.reject=dt,H._setScheduler=O,H._setAsap=q,H._asap=S,H.prototype={constructor:H,then:z,catch:function(t){return this.then(null,t)}};var _t=kt;function kt(t,n){this._instanceConstructor=t,this.promise=new t(lt),this.promise[F]||f(this.promise),x(n)?(this._input=n,this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),this.length===0?K(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&K(this.promise,this._result))):B(this.promise,Ut())}function Ut(){return new Error("Array Methods must be provided an Array")}kt.prototype._enumerate=function(){for(var t=this.length,n=this._input,a=0;this._state===ut&&a<t;a++)this._eachEntry(n[a],a)},kt.prototype._eachEntry=function(t,n){var a=this._instanceConstructor,p=a.resolve;if(p===U){var m=yt(t);if(m===z&&t._state!==ut)this._settledAt(t._state,n,t._result);else if(typeof m!="function")this._remaining--,this._result[n]=t;else if(a===ft){var g=new a(lt);wt(g,t,m),this._willSettleAt(g,n)}else this._willSettleAt(new a(function(C){C(t)}),n)}else this._willSettleAt(p(t),n)},kt.prototype._settledAt=function(t,n,a){var p=this.promise;p._state===ut&&(this._remaining--,t===D?B(p,a):this._result[n]=a),this._remaining===0&&K(p,this._result)},kt.prototype._willSettleAt=function(t,n){var a=this;Pt(t,void 0,function(p){a._settledAt(R,n,p)},function(p){a._settledAt(D,n,p)})};function e(){var t;if(typeof global<"u")t=global;else if(typeof self<"u")t=self;else try{t=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;n&&Object.prototype.toString.call(n.resolve())==="[object Promise]"&&!n.cast||(t.Promise=ft)}var s=e;ft.Promise=ft,ft.polyfill=s,typeof define=="function"&&define.amd?define(function(){return ft}):typeof Ft<"u"&&Ft.exports?Ft.exports=ft:typeof this<"u"&&(this.Promise=ft),s()}).call(void 0);(function(){class c{constructor(){this._broadcastChannel=typeof BroadcastChannel>"u"?null:new BroadcastChannel("offline"),this._queuedMessages=[],this._onMessageCallback=null,this._broadcastChannel&&(this._broadcastChannel.onmessage=T=>this._OnBroadcastChannelMessage(T))}_OnBroadcastChannelMessage(T){if(this._onMessageCallback){this._onMessageCallback(T);return}this._queuedMessages.push(T)}SetMessageCallback(T){this._onMessageCallback=T;for(let x of this._queuedMessages)this._onMessageCallback(x);this._queuedMessages.length=0}}window.OfflineClientInfo=new c})();(function(){let c={},$=!0;window.PWATracker={getRequest:()=>c,getInstalled:()=>$},window.addEventListener("beforeinstallprompt",function(T){$=!1,T.preventDefault(),c=T})})();let Bt=!1;function Gt(){}Gt.extend=function(c){const $=this.prototype;let T;Bt=!0,T=new this,Bt=!1;for(let w in c)typeof c[w]=="function"&&typeof $[w]=="function"?T[w]=function(_,y){return function(){const S=this._super;this._super=$[_];const O=y.apply(this,arguments);return this._super=S,O}}(w,c[w]):T[w]=c[w];function x(){if(this instanceof x)!Bt&&this.init&&this.init.apply(this,arguments);else return new x(...arguments)}return x.prototype=T,x.prototype.constructor=x,x.extend=this.extend,x};function ie(c){let $=Math,T=$.PI,x=2*T,w=T/180,_=$.sqrt,y=$.pow,S=$.cos,O=$.sin,q=$.round,I=$.abs,N=$.acos,M,P=Object.prototype.hasOwnProperty,V=Array.prototype.slice,Z={tx:0,ty:0,scaleX:1,scaleY:1,skewX:0,skewY:0,fill:"#000",stroke:"",lineWidth:1,lineJoin:"miter",lineCap:"butt",alpha:1,rotation:0,composite:"source-over",shadowColor:"rgba(0, 0, 0, 0.0)",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,fontStyle:"normal",fontWeight:"normal",fontSize:10,fontFamily:"Arial"},v=document.createElement("canvas"),b=v.getContext&&v.getContext("2d"),l=function(e,s){return _(y(e.x-s.x,2)+y(e.y-s.y,2))},r=function(e,s,t,n,a){let p=t-e,m=n-s,g={},C;if(!(p===0&&m===0))return C=((a.x-e)*p+(a.y-s)*m)/(p*p+m*m),C<0?g={x:e,y:s}:C>1?g={x:t,y:t}:g={x:e+C*p,y:s+C*m},l(g,a)},u=function(e,s,t){return t=w*t,{x:e*S(t)-s*O(t),y:e*O(t)+s*S(t)}},h=function(e,s){let t;for(t in s)P.call(s,t)&&(e[t]=s[t])},d=Gt.extend({init:function(e,s){this.x=e||0,this.y=s||0,h(this,Z)},position:function(){let e=u(this.x*this.scaleX,this.y*this.scaleY,this.rotation);return{x:e.x+this.tx,y:e.y+this.ty}},rmove:function(e,s){this.tx+=e,this.ty+=s},attr:function(e,s){let t;if(typeof e=="string")this[e]=s;else for(t in e)this[t]=e[t];return this},applyStyle:function(e){let s=this.shadowBlur,t=this.shadowOffsetX,n=this.shadowOffsetY;e.fillStyle=this.fill,e.globalAlpha=this.alpha,e.globalCompositeOperation=this.composite,this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.lineWidth),(t||n||s)&&(e.shadowColor=this.shadowColor,e.shadowOffsetX=t,e.shadowOffsetY=n,e.shadowBlur=s)},setTransform:function(e){let s=c.__zoom,t=this.scaleX*s,n=this.scaleY*s,a=this.skewX*s,p=this.skewY*s,m=this.rotation*w,g=O(m),C=S(m),G=this.tx*s,j=this.ty*s,at=C*t-g*p,ht=C*a-g*n,Tt=g*t+C*p,At=g*a+C*n;e.setTransform(at,Tt,ht,At,G,j)},draw:function(e){throw new Error("El método draw no se ha implementado")},fill_or_stroke:function(e){this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(b&&b.isPointInPath)return this.draw(b),b.setTransform(1,0,0,1,0,0),b.isPointInPath(e.x,e.y);throw Error("Método isPointInPath no soportado: Necesita FlashCanvasPro")}}),k=d.extend({init:function(e,s,t,n,a){this.r=a||0,this.w=t||5,this.h=n||t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y,n=this.w,a=this.h;this.applyStyle(e),this.setTransform(e),e.beginPath(),this.r?c.setContext(e).polygon(s,t,s+n,t,s+n,t+a,s,t+a,this.r):e.rect(s,t,q(n),q(a)),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.r)return this._super(e);let s=this.position(),t=u(e.x-s.x,e.y-s.y,-this.rotation);return t.x>=0&&t.x<=this.w*this.scaleX&&t.y>=0&&t.y<=this.h*this.scaleY}}),L=k.extend({init:function(e,s,t){this.setText(t),this._super(e,s,this.w,this.h)},applyStyle:function(e){e.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.h=this.fontSize,this.w=e.measureText(this.text).width,this._super(e)},setText:function(e){this.text=e+""},draw:function(e){this.applyStyle(e),this.setTransform(e),this.fill&&e.fillText(this.text,this.x,this.y+this.h),this.stroke&&e.strokeText(this.text,this.x,this.y+this.h)},hitTest:function(e){return this.skewX||this.skewY&&b&&b.isPointInPath?(this.setTransform(b),b.beginPath(),b.rect(this.x,this.y,this.w,this.h),b.closePath(),b.isPointInPath(e.x,e.y)):this._super(e)}}),z={},tt=k.extend({init:function(e,s,t){this.setImg(t),this._super(e,s,this.img.width,this.img.height)},setImg:function(e){if(z[e]){this.img=z[e],this.src=this.img.src;return}e.nodeName=="IMG"?this.img=e:(e+="",this.img=z[e]=new Image,this.img.src=e),this.img.onload=function(){c.forse_redraw()},this.src=this.img.src},draw:function(e){let s=this.x,t=this.y;this.w=this.img.width,this.h=this.img.height,this.applyStyle(e),this.setTransform(e),e===b?(e.beginPath(),e.rect(s,t,q(this.w),q(this.h)),e.closePath()):e.drawImage(this.img,s,t)}}),U=k.extend({draw:function(e){let s=this.x,t=this.y,n=this.w,a=this.h,p=.5522847498307933,m=p*n,g=p*a;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(s+n,t),e.bezierCurveTo(s+n,t-g,s+m,t-a,s,t-a),e.bezierCurveTo(s-m,t-a,s-n,t-g,s-n,t),e.bezierCurveTo(s-n,t+g,s-m,t+a,s,t+a),e.bezierCurveTo(s+m,t+a,s+n,t+g,s+n,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:d.prototype.hitTest}),F=d.extend({init:function(e,s,t,n,a,p){this.clockwise=p,this.endAngle=a,this.startAngle=n,this.r=t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,q(this.r),this.startAngle||T*2,this.endAngle||0,!!this.clockwise),e.lineTo(s,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()}}),lt=d.extend({init:function(e,s,t){this.r=t||5,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,q(this.r),0,T*2,!0),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.scaleX!==this.scaleY)return this._super(e);let s=!!this.stroke&&this.lineWidth,t=this.position();return l(e,t)<=(this.r+s)*this.scaleX}}),ut=d.extend({init:function(e,s,t,n){this.x2=t,this.y2=n,this._super(e,s),this.stroke="#000"},rmove:function(e,s){this.x+=e,this.y+=s,this.x2+=e,this.y2+=s},applyStyle:function(e){e.lineJoin=this.lineJoin,e.lineCap=this.lineCap,this._super(e)},draw:function(e){this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.x2,this.y2),e.stroke()},hitTest:function(e){return r(this.x,this.y,this.x2,this.y2,e)<=this.lineWidth+2}}),R,D,rt,Y=null,ot=null,yt=!1,ct=/[MmLlZzHhVvCcQqSsTtAa]\s*([\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?[,\s]*)*/g,Nt=/[\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?/g,Ct=function(e,s,t,n){let a=e*t+s*n,p=_(e*e+s*s),m=_(t*t+n*n),g=a/(p*m),C,G;return g>1?g=1:g<-1&&(g=-1),C=I(N(g)),G=e*n-s*t,G===I(G)?C:-C},wt=function(e,s,t){return[e*S(t)-s*O(t),s*S(t)+e*O(t)]},Q=function(e,s,t){yt&&e.ctx.moveTo(s,t)},et=function(e,s){R=e,D=s,Y=null,ot=null,yt=!1},K=function(){if(R===M)throw new Error("No current point; can't use relative coordinates")},B=function(e,s,t,n){if(s!==(t?e.length%t:e.length)||e.length<n)throw new Error("wrong number of arguments")},Pt=function(e,s){return this.ctx.moveTo(e,s),et(e,s),rt=e,arguments.length>2&&$t.apply(this,V.call(arguments,2)),this},xt=function(e,s){return yt&&(R=D=0),K(),e+=R,s+=D,this.ctx.moveTo(e,s),et(e,s),rt=e,arguments.length>2&&vt.apply(this,V.call(arguments,2)),this},$t=function(e,s){let t,n=arguments.length;for(B(arguments,0,2,2),Q(this,e,s),this.ctx.lineTo(e,s),t=2;t<n;t+=2)this.ctx.lineTo(e=arguments[t],s=arguments[t+1]);return et(e,s),this},vt=function(e,s){let t,n=R,a=D,p=arguments.length;for(B(arguments,0,2,2),K(),t=0;t<p;t+=2)this.ctx.lineTo(n+=arguments[t],a+=arguments[t+1]);return et(n,a),this},Et=function(){return this.ctx.closePath(),et(this,rt),this},J=function(e){let s,t=arguments.length;for(K(),s=0;s<t;s++)$t.call(this,arguments[s],D);return this},zt=function(e){let s,t=arguments.length;for(s=0;s<t;s++)vt.call(this,arguments[s],0);return this},i=function(e){let s,t=arguments.length;for(K(),s=0;s<t;s++)$t.call(this,R,arguments[s]);return this},o=function(e){let s,t=arguments.length;for(s=0;s<t;s++)vt.call(this,0,arguments[s]);return this},f=function(e,s,t,n,a,p){let m,g=arguments,C=arguments.length;for(B(g,0,6,6),Q(this,e,t),this.ctx.bezierCurveTo(e,s,t,n,a,p),m=6;m<C;m+=6)this.ctx.bezierCurveTo(g[m],g[m+1],t=g[m+2],n=g[m+3],a=g[m+4],p=g[m+5]);return et(a,p),Y=[t,n],this},E=function(e,s,t,n,a,p){let m,g=arguments,C=g.length,G=R,j=D;for(B(g,0,6,6),K(),m=0;m<C;m+=6)this.ctx.bezierCurveTo(G+g[m],j+g[m+1],t=G+g[m+2],n=j+g[m+3],G+=g[m+4],j+=g[m+5]);return et(G,j),Y=[t,n],this},A=function(e,s,t,n){let a,p=arguments,m=p.length;for(B(arguments,0,4,4),Q(this,e,s),this.ctx.quadraticCurveTo(e,s,t,n),a=4;a<m;a+=4)this.ctx.quadraticCurveTo(e=p[a],s=p[a+1],t=p[a+2],n=p[a+3]);return et(t,n),ot=[e,s],this},W=function(e,s,t,n){let a,p=arguments,m=p.length,g=R,C=D;for(B(arguments,0,4,4),K(),a=0;a<m;a+=4)this.ctx.quadraticCurveTo(e=g+p[a],s=C+p[a+1],g+=p[a+2],C+=p[a+3]);return et(g,C),ot=[e,s],this},it=function(){if(!Y)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=R,a=D,p=Y[0],m=Y[1],g,C,G,j,at,ht;for(B(arguments,0,4,4),K(),e=0;e<t;e+=4)g=n+(n-p),G=a+(a-m),C=s[e],j=s[e+1],at=s[e+2],ht=s[e+3],this.ctx.bezierCurveTo(g,G,C,j,at,ht),n=at,a=ht,p=C,m=j;return et(n,a),Y=[p,m],this},bt=function(){if(!Y)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=R,a=D,p=Y[0],m=Y[1],g,C,G,j,at,ht;for(B(arguments,0,4,4),K(),e=0;e<t;e+=4)g=n+(n-p),G=a+(a-m),C=n+s[e],j=a+s[e+1],at=n+s[e+2],ht=a+s[e+3],this.ctx.bezierCurveTo(g,G,C,j,at,ht),n=at,a=ht,p=C,m=j;return et(n,a),Y=[p,m],this},dt=function(){if(!ot)throw new Error("Last command was not a cubic bezier");let e,s=arguments.length,t=R,n=D,a=ot[0],p=ot[1],m,g,C,G;for(B(arguments,0,2,2),K(),e=0;e<s;e+=2)m=t+(t-a),g=n+(n-p),C=arguments[e],G=arguments[e+1],this.ctx.quadraticCurveTo(m,g,C,G),t=C,n=G,a=m,p=g;return et(t,n),ot=[a,p],this},pt=function(){if(!ot)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=R,a=D,p=ot[0],m=ot[1],g,C,G,j;for(B(arguments,0,2,2),K(),e=0;e<t;e+=2)g=n+(n-p),C=a+(a-m),G=n+arguments[e],j=a+arguments[e+1],this.ctx.quadraticCurveTo(g,C,G,j),n=G,a=j,p=g,m=C;return et(n,a),ot=[p,m],this},mt=function(e,s,t,n,a,p,m){if(!e||!s)return $t.call(this,p,m);n=!!n,a=!!a,K();let g=R,C=D,G=p,j=m,at=t*w,ht=O(at),Tt=S(at),At=(g-G)/2,Dt=(C-j)/2,St=Tt*At+ht*Dt,Lt=-ht*At+Tt*Dt,Xt,Mt,Ot,Jt,jt,qt,Vt,It;if(e=I(e),s=I(s),Xt=St*St/(e*e)+Lt*Lt/(s*s),Xt>1)e*=_(Xt),s*=_(Xt),Mt=Ot=0;else{let Kt=e*e,Qt=s*s,Zt=St*St,te=Lt*Lt,Rt=Kt*te+Qt*Zt;Rt=_(Kt*Qt/Rt-1),n===a&&(Rt=-Rt),Mt=Rt*e*Lt/s,Ot=-Rt*s*St/e}return Jt=Tt*(Mt-ht)*(Ot+(g+G)/2),jt=ht*(Mt+Tt)*(Ot+(C+j)/2),At=(St-Mt)/e,Dt=(Lt-Ot)/s,qt=Ct(1,0,At,Dt),It=Ct(At,Dt,(-St-Mt)/e,(-Lt-Ot)/s),a&&It<0?It+=x:!a&&It>0&&(It-=x),Vt=qt+It,this.ellipse(Jt,jt,e,s,at,qt,Vt,!a),this},ft=function(e,s,t,n,a,p,m){return K(),mt.call(this,e,s,t,n,a,p+R,m+D),this},H=function(e,s,t,n,a,p,m,g){a=a||0,p=p||0,m=m===M?x:m;let C=wt(t*S(p),n*O(p),a),G=e+C[0],j=s+C[1],at=wt(t*S(m),n*O(m),a),ht=e+at[0],Tt=s+at[1];return Q(this,G,j),this.ctx.translate(e,s),this.ctx.rotate(a),this.ctx.scale(t/n,1),this.ctx.arc(0,0,n,p,m,!!g),this.ctx.scale(n/t,1),this.ctx.rotate(-a),this.ctx.translate(-e,-s),et(ht,Tt),this},_t=function(){let e,s=arguments,t=s.length;if(t<6)throw new Error("not enough arguments");if(t%2===0)for(this.ctx.moveTo(s[0],s[1]),e=2;e<t;e+=2)this.ctx.lineTo(s[e],s[e+1]);else{let n=s[t-1],a=(t-1)/2,p=(s[a*2-2]+s[0])/2,m=(s[a*2-1]+s[1])/2,g,C;for(this.ctx.moveTo(p,m),e=0;e<a-1;e++)this.ctx.arcTo(g=s[e*2],C=s[e*2+1],s[e*2+2],s[e*2+3],n,p,m),p=g,m=C;this.ctx.arcTo(s[a*2-2],s[a*2-1],s[0],s[1],n,p,m)}return this},kt=function(e){let s=e.match(ct),t,n,a,p,m,g=[];if(!s)throw new Error("Bad path: "+e);for(p=0;t=s[p];p++){for(a=[],a.cmd=t.charAt(0),n=t.match(Nt)||[],m=0;m<n.length;m++)a[m]=+n[m];g.push(a)}return g},Ut=d.extend({init:function(e){this.svgpath=kt(e),this._super(0,0),this.svgpath[0].cmd.toLowerCase()=="m"&&(this.x=this.svgpath[0][0],this.y=this.svgpath[0][1])},draw:function(e){let s=this.svgpath,t,n;for(this.applyStyle(e),this.setTransform(e),e.beginPath(),c.setContext(e),t=0,n=s.length;t<n;t++)c[s[t].cmd].apply(c,s[t]);this.fill&&e.fill(),this.stroke&&e.stroke()}});return h(c,{distance:l,__zoom:1,Shape:d,setContext:function(e){return this.ctx=e,et(0,0),e.beginPath(),this},polygon:_t,ellipse:H,M:Pt,m:xt,L:$t,l:vt,H:J,h:zt,V:i,v:o,C:f,c:E,S:it,s:bt,Q:A,q:W,T:dt,t:pt,A:mt,a:ft,Z:Et,z:Et}),c.register("image",tt),c.register("circle",lt),c.register("arc",F),c.register("ellipse",U),c.register("rect",k),c.register("text",L),c.register("line",ut),c.register("path",Ut),c}function se(c,$,T){let x=Object.prototype.toString,w="function",_="string",y="array",S="object",O=!1,q=[],I=!1,N,M=c.G_vmlCanvasManager,P=/webkit|msie/i.exec(c.navigator.userAgent),V=navigator.userAgent,Z=V.match(/android/i),v=V.match(/iphone|ipad|ipod/i),b=V.match(/Windows Phone/i)||V.match(/iemobile/i),l=/^([#]?)([a-z][\w\-]*)$/,r=["","LEFT","CENTER","RIGHT"],u=[],h=null,d=null,k=!1,L="Cevent"+new Date().getTime(),z=0,tt={},U=function(i,o){return x.call(i).slice(8,-1).toLowerCase()===o},F=function(i,o){let f,E=0;if(U(i,y))for(;(f=i[E++])&&o(f,E)!==!1;);},lt=function(i,o){let f=ot(i,o);return f>=0?(i.splice(f,1),o):null},ut={click:"touchstart",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},R=function(i){return i=i||c.event,i.preventDefault||(i.preventDefault=function(){this.returnValue=!1}),i.stopPropagation||(i.stopPropagation=function(){this.cancelBubble=!0}),i},D=function(i,o){let f=ut[o];return f?function(E){let A=E.type===f;N=J.isTouchDevice=A,!(!A&&(Z||v||b))&&i.call(this,E)}:i},rt=function(i){return document.getElementById(i)},Y=function(){return document.addEventListener?function(o,f,E){o&&(o=typeof o=="string"?rt(o):o,E=D(E,f),ut[f]&&o.addEventListener(ut[f],E,!0),o.addEventListener(f,E,!0))}:function(o,f,E){o&&(o=typeof o=="string"?rt(o):o,o.attachEvent("on"+f,function(A){return A=R(A),E.call(A.target||A.srcElement,A)}))}}(),ot=function(){return[].indexOf?function(i,o){return i.indexOf(o)}:function(i,o){for(let f=0,E=i.length;f<E;f++)if(o===i[f])return f;return-1}}(),yt=function(i){let o=0,f=0;if(i.offsetParent)do o+=i.offsetLeft,f+=i.offsetTop;while(i=i.offsetParent);return{x:o,y:f}},ct=function(i,o,f){let E=i[L],A;return E||(E=i[L]=++z),A=tt[E],A||(A=tt[E]={}),o&&f!==T&&(A[o]=f),o?A[o]:A},Nt=function(i,o){if(!i)return;let f=i[L];f&&tt[f]&&delete tt[f]},Ct=function(i,o,f){let E=ct(i),A;F(o.split(" "),function(W){A=E[W]=E[W]||[],A.push(f)})},wt=function(i,o,f,E){let A,W=0,it=!0;for(f.ctx.save(),f.ctx.scale(f.__zoom,f.__zoom);A=o[W++];)A.call(i,f,E)===!1&&(it=!1);return f.ctx.restore(),it||E.preventDefault(),it},Q=function(i,o,f,E){let A=ct(i,o),W=ct(E.cv,o);A&&A.length&&u.push(i,A),W&&W.length&&u.push(i,W)},et=function(i,o){let f,E;for(i.clear(),f=0,E=u.length;f<E;f+=2)wt(u[f],u[f+1],i,o);u=[],i.redraw()},K=function(i,o){i.preventDefault(),i=i.touches?i.touches[0]:i;let f,E=o._shapes,A=E.length;for(o.x=((i&&i.pageX-o._pos.x+1||c.event.offsetX+1)-1)/o.__zoom||0,o.y=((i&&i.pageY-o._pos.y+1||c.event.offsetY+1)-1)/o.__zoom||0;f=E[--A];)if(f.hitTest(o))return f},B=function(i,o){return function(f){f.preventDefault(),f=f.touches?f.touches[0]:f,i.lastX=i.x,i.lastY=i.y,o=i._curHover;let E=((f&&f.pageX-i._pos.x+1||c.event.offsetX+1)-1)/i.__zoom||0,A=((f&&f.pageY-i._pos.y+1||c.event.offsetY+1)-1)/i.__zoom||0;if(!(!I&&Math.abs(E-i.x)<2&&Math.abs(A-i.y)<2)){if(i.x=E,i.y=A,I=!0,!i._clicked&&O){let W=K(f,i);W?(o!==W&&(Q(W,"mouseover",f,i),o&&Q(o,"mouseout",f,i)),i._curHover=o=W):o&&(Q(o,"mouseout",f,i),i._curHover=o=null)}o&&Q(o,"mousemove",f,i),u.length&&et(i,f)}}},Pt=function(i){return function(o){(o.type==="mousedown"||o.type==="touchstart")&&i.calcCanvasPosition(),O||(i._curHover=K(o,i)),i._curHover;let f=i._curHover,E=r[o.which||o.button];i._clicked=!0,h=i.cv,i[E]=!0,f?(Q(f,"mousedown",o,i),f!==i.focused&&(Q(f,"focus",o,i),i.focused&&Q(i.focused,"blur",o,i))):i.focused&&(Q(i.focused,"blur",o,i),i.focused=null),i.focused=f||null,u.length&&et(i,o),i[E]=!1}},xt=function(i){return function(o){i._clicked=!1,i._curHover&&(Q(i._curHover,"mouseup",o,i),!I&&N&&(Q(i._curHover,"tap",o,i),i.lastClick&&o.timeStamp-i.lastClick<300&&Q(i._curHover,"dblclick",o,i),i.lastClick=o.timeStamp)),I=!1,u.length&&et(i,o)}},$t=function(i){return function(o){i._curHover&&Q(i._curHover,"click",o,i),u.length&&et(i,o)}},vt=function(i){return function(o){i._curHover&&Q(i._curHover,"dblclick",o,i),u.length&&et(i,o)}},Et=function(){let i={specialKeys:{27:"esc",9:"tab",32:"space",13:"return",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",109:"-",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",191:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",110:".",111:"/",187:"+",189:"-"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"}},o;return function(f,E){let A=ct(E.cv,f,{}),W=ct(A);return function(it){if(h!==E.cv&&!E.__globalkeyevents)return;o=f=="keydown"?it.keyCode:o;let bt=i.specialKeys[o],dt=bt||String.fromCharCode(o||it.charCode).toLowerCase(),pt="",mt;if(it.altKey&&(pt+="alt+"),(it.ctrlKey||it.metaKey)&&(pt+="ctrl+"),it.shiftKey&&(pt+="shift+"),mt=W[pt+dt]||W[pt+i.shiftNums[dt]]||pt==="shift+"&&W[i.shiftNums[dt]]||W.any,mt){let ft=wt(E,mt,E,it);return E.play||E.redraw(),ft}}}}(),J=function(i,o){if(i=U(i,_)?$.getElementById(i):i,i.getContext||c.G_vmlCanvasManager)return new J.fn.init(i,o);throw Error("Your browser sucks")};J.forse_redraw=function(){let i,o=q.length;for(i=0;i<o;i++)q[i].redraw()},J.fn=J.prototype={init:function(i,o){this.cv=i,c.getComputedStyle?this.background=getComputedStyle(this.cv.parentElement).backgroundColor:this.background="#333",!i.getContext&&c.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(i),this.ctx=i.getContext("2d"),this.width=i.width,this.height=i.height,this.__zoom=1,this.x=0,this.y=0,this.cv[L]?(this._shapes=ct(i,"shapes"),this._last=o):(q.push(this),this._shapes=ct(i,"shapes",[]),this.__cache=ct(i,"cache",document.createElement("canvas")),this._last=null,c.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.__cache),this.__cachectx=this.__cache&&this.__cache.getContext("2d"),this.calcCanvasPosition(),Y(i,"mousemove",B(this),!1),Y(i,"dblclick",vt(this),!1),Y(i,"click",$t(this),!1),Y(i,"mouseup",xt(this),!1),Y(i,"mousedown",Pt(this),!1),Y($,"keydown",Et("keydown",this),!1),Y($,"keyup",Et("keyup",this),!1),P||Y($,"keypress",Et("keypress",this),!1),"onselectstart"in i&&(i.onselectstart=function(){return!1},i.onmousedown=function(){return!1}))},updateCache:function(){this.__cache&&(this.__cache.width=this.cv.width,this.__cache.height=this.cv.height,lt(this._shapes,d),this.draw(),this._shapes.push(d),this.__cachectx.drawImage(this.cv,0,0))},calcCanvasPosition:function(){return this._pos=yt(this.cv),this},get:function(i){return i=i<0?this._shapes.length+i:i,this._shapes[i]||this._shapes},getAll:function(i){let o=[],f=l.exec(i),E,A;return i==="*"?o=this._shapes.slice(0):f&&(E=f[1],A=f[2],F(this._shapes,function(W){W[E]===A&&o.push(W)})),o},remove:function(i){return Nt(lt(this._shapes,i)),this.redraw()},addId:function(i){let o=l.exec(i),f=this._last;return o&&!o[1]&&f&&(f.length?F(f,function(E){E["#"]=i}):f["#"]=i),this},removeId:function(){let i=this._last;return i&&!i.length?i["#"]="":F(i,function(o){o["#"]=""}),this},find:function(i){let o=this.getAll(i);return J(this.cv,o.length===1?o[0]:o)},attr:function(i,o){let f=this._last;return f&&f.attr?f.attr(i,o):F(f,function(E){E.attr(i,o)}),this},rotate:function(i){return this.attr({rotation:i})},translate:function(i,o){return this.attr({tx:i,ty:o})},scale:function(i,o){return this.attr({scaleX:i,scaleY:o})},skewX:function(i){return this.attr({skewX:i})},skewY:function(i){return this.attr({skewY:i})},zoomTo:function(i){return U(i,"number")&&(this.__zoom=i),this},zoomIn:function(){return this.zoomTo(this.__zoom+.1)},zoomOut:function(){return this.zoomTo(this.__zoom-.1)},setGlobalKeyEvents:function(i){return this.__globalkeyevents=!!i,this},bind:function(i,o,f){let E=f||this._last,A;if(!O&&"mouseover mouseout".indexOf(i)!==-1&&(O=!0),U(i,_)&&U(o,S))for(A in o)this[A](i,o[A]);else if(U(i,S))for(A in i)this[A](i[A]);else E&&!E.length?Ct(E,i,o):F(E,function(W){Ct(W,i,o)});return this},beforeDraw:function(i){return U(i,w)&&(this.__beforeDraw=i),this},afterDraw:function(i){return U(i,w)&&(this.__afterDraw=i),this},clear:function(i,o,f,E){return i=i||0,o=o||0,f=f||this.cv.width,E=E||this.cv.height,this.ctx.fillStyle=this.background,this.ctx.fillRect(i,o,f,E),this},draw:function(){let i,o=0,f=this._shapes;if(this.ctx.save(),J.__zoom=this.__zoom,this.__beforeDraw&&this.__beforeDraw.call(this,this),!M&&this.__cache&&k&&!this.play&&d)this.ctx.drawImage(this.__cache,0,0),d.draw(this.ctx);else for(;i=f[o++];)i.draw(this.ctx);return this.__afterDraw&&this.__afterDraw.call(this,this),J.__zoom=1,this.ctx.restore(),this},redraw:function(){return this.clear().draw()},frameCount:0,stop:function(){return delete this.play,this}},J.fn.init.prototype=J.prototype,J.addEventListener=Y;function zt(i,o){let f=l.exec(i);return function(E,A){(f&&this[f[1]]===f[2]||i==="*")&&o.call(this,E,A)}}return F("mousemove mouseover mouseout mousedown mouseup click dblclick focus blur tap".split(" "),function(i){J.fn[i]=function(o,f){let E;return U(f,w)&&(o=zt(o,f),E=this.cv),this.bind(i,o,E)}}),F("keydown keypress keyup".split(" "),function(i){J.fn[i]=function(o,f){return!f&&U(o,w)&&(f=o,o="any"),o=(o+"").toLowerCase(),this.bind(o,f,ct(this.cv,i))}}),P&&(J.fn.keypress=J.fn.keydown),J.fn.drag=function(i){let o,f,E,A,W=[],it,bt="Cevent-drag"+L,dt=this._last;if(U(i,_)&&(it=i,i=arguments[1]),i&&(o=i.start,f=i.move,E=i.end,A=i.afterMove),it)return this.mousedown(it,pt).mouseup(it,ft).mousemove(it,mt);dt&&!dt.length&&(dt=[dt]),F(dt,function(H){ct(H,bt)||(ct(H,bt,!0),W.push(H))}),J(this.cv,W).mousedown(pt).mouseup(ft).mousemove(mt);function pt(H,_t){(H.LEFT||N)&&(d=this,!H.play&&!M&&!k&&H.updateCache())}function mt(H,_t){if(this===d){if(!k){if(o&&o.call(this,H,_t)===!1)return d=k=null;k=!0}f&&f.call(this,H,_t),this.rmove(H.x-H.lastX,H.y-H.lastY),A&&A.call(this,H,_t)}}function ft(H,_t){this===d&&(d=k=null,E&&E.call(this,H,_t))}return this},J.registre=J.register=function(i,o){i=i.toLowerCase();let f=i.charAt(0).toUpperCase()+i.substring(1);this[f]=o,this.prototype[i]=function(){let E=o.apply(this,arguments);return E[""]=i,this._shapes.push(E),this._last=E,this}},Y($,"mousedown",function(i){let o=i.target||i.srcElement;o=o.nodeName==="OBJECT"?o.parentNode:o,o[L]||(h=o)},!1),J.isTouchDevice=N,c.Cevent=J,J}const gt=ie(se(window,document)),X=function(c){const $={randint:function(_){return~~(Math.random()*_)}};"bind"in Function||(Function.prototype.bind=function(_){let y=this;return function(){return y.apply(_,arguments)}});let T=Gt.extend({init:function(_){this.elem=document.getElementById(_)}}),x=function(_,y,S){return document.addEventListener?function(O,q,I){O.addEventListener(q,I,!1)}:function(O,q,I){O.attachEvent("on"+q,function(N){return N=N||y,N.preventDefault=N.preventDefault||function(){this.returnValue=!1},N.stopPropagation=N.stopPropagation||function(){this.cancelBubble=!0},I.call(N.target||N.srcElement,N)})}}(),w="mousemove mouseover mouseout mousedown mouseup click touchstart dblclick focus blur submit change".split(" ");for(let _=0;_<w.length;_++){let y=w[_];T.prototype[y]=function(S){return function(O,q){typeof O=="function"?x(this.elem,S,O):x(this.elem,S,function(I){let N=I.target||I.srcElement;N.tagName.toLowerCase()===O&&(I.stopPropagation(),q.call(N,I))},!1)}}(y)}return $.fullScreen=function(){document.documentElement.scrollHeight<c.outerHeight/c.devicePixelRatio?(document.body.style.height=c.outerHeight/c.devicePixelRatio+1+"px",setTimeout(function(){c.scrollTo(1,1)},0)):c.scrollTo(1,1)},$.getContext=function(_){return!_.getContext&&c.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(_),_.getContext("2d")},$.extend=function(_,y){let S;for(S in y)y.hasOwnProperty(S)&&!(S in _)&&(_[S]=y[S]);return _},$.calcPieces=function(_,y){let S=_.image.width,O=_.image.height,q=document.getElementById("set-parts"),I,N;q.innerHTML="";for(let M=0;M<_.options.length;M+=1){let P=~~Math.sqrt(S*O/_.options[M]),V=~~(S/P),Z=~~(O/P);for(;V*Z<_.options[M];)P--,V=~~(S/P),Z=~~(O/P);N!==V*Z&&(N=V*Z,I=document.createElement("option"),I.value=_.options[M],I.innerHTML=y(M),q.appendChild(I),_.options[M]===_.selected&&(I.selected=!0))}},$.addEvent=x,$.$=function(){let _=T();return function(y){return _.elem=document.getElementById(y),console.log(_),_}}(),$.getElement=function(_){return document.getElementById(_)},$.ajax=function(_){let y=new XMLHttpRequest;y.onreadystatechange=function(){y.readyState===XMLHttpRequest.DONE&&(y.status===200?_.success&&_.success(y.responseText):_.error&&_.error())},y.open("GET",_.url,!0),y.send()},c.Util=c.Util||$,$}(window),nt=function(){};nt.prototype.setMaxListeners=function(c){this._events||(this._events={}),this._events.maxListeners=c};Array.isArray=Array.isArray||function(c){return c.sort&&c.length&&c.slice};nt.prototype.emit=function(c){if(c==="error"&&(!this._events||!this._events.error||Array.isArray(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;let $=this._events[c];if(!$)return!1;if(typeof $=="function"){switch(arguments.length){case 1:$.call(this);break;case 2:$.call(this,arguments[1]);break;case 3:$.call(this,arguments[1],arguments[2]);break;default:let T=Array.prototype.slice.call(arguments,1);$.apply(this,T)}return!0}if(Array.isArray($)){let T=Array.prototype.slice.call(arguments,1),x=$.slice();for(let w=0,_=x.length;w<_;w++)x[w].apply(this,T);return!0}return!1};nt.prototype.publish=nt.prototype.emit,nt.prototype.addListener=function(c,$){if(typeof $!="function")throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",c,$),!this._events[c])this._events[c]=$;else if(Array.isArray(this._events[c])){if(this._events[c].push($),!this._events[c].warned){let T;this._events.maxListeners!==void 0?T=this._events.maxListeners:T=10,T&&T>0&&this._events[c].length>T&&(this._events[c].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[c].length),console.trace())}}else this._events[c]=[this._events[c],$];return this};nt.prototype.on=nt.prototype.subscribe=nt.prototype.addListener,nt.prototype.once=function(c,$){function T(){x.removeListener(c,T),$.apply(this,arguments)}if(typeof $!="function")throw new Error(".once only takes instances of Function");let x=this;return T.listener=$,x.on(c,T),this};nt.prototype.removeListener=function(c,$){if(typeof $!="function")throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[c])return this;let T=this._events[c];if(Array.isArray(T)){let x=-1;for(let w=0,_=T.length;w<_;w++)if(T[w]===$||T[w].listener&&T[w].listener===$){x=w;break}if(x<0)return this;T.splice(x,1),T.length==0&&delete this._events[c]}else(T===$||T.listener&&T.listener===$)&&delete this._events[c];return this};nt.prototype.unsubscribe=nt.prototype.removeListener,nt.prototype.removeAllListeners=function(c){return arguments.length===0?(this._events={},this):(c&&this._events&&this._events[c]&&(this._events[c]=null),this)};nt.prototype.listeners=function(c){return this._events||(this._events={}),this._events[c]||(this._events[c]=[]),Array.isArray(this._events[c])||(this._events[c]=[this._events[c]]),this._events[c]};nt.mixin=function(c){for(let $ in nt.prototype)c.prototype[$]||(c.prototype[$]=nt.prototype[$])};const ne=[4,20,50,75,100],re=["очень легко","легко","сложно","очень сложно","эксперт"];function oe(c){return re[c]}function st(){return window.devicePixelRatio||1}(function(c,$,T){let x=X.getContext(c.createElement("canvas")),w=Math.abs,_=Math.PI/180,y=X.getContext(c.createElement("canvas")),S=navigator.userAgent,O=S.match(/android/i),q=S.match(/iphone|ipad|ipod/i),I=S.match(/Windows Phone/i)||S.match(/iemobile/i),N=!O&&!q&&!I,M=20;function P(l,r){if(l.rotation%360||r.rotation%360||r.hide||l.hide||l.row!=r.row&&l.col!=r.col)return;let u=l.tx-r.tx,h=l.ty-r.ty,d=l.col-r.col,k=l.row-r.row,L=l.width,z=l.height;if(l.size,(d==-1&&u<0&&w(u+L)<M||d==1&&u>=0&&w(u-L)<M)&&h<=M&&h>=-20)return[l.col>r.col?-w(u)+L:w(u)-L,r.ty-l.ty];if((k==-1&&h<0&&w(h+z)<M||k==1&&h>=0&&w(h-z)<M)&&u<=M&&u>=-20)return[r.tx-l.tx,l.row>r.row?-w(h)+z:w(h)-z]}let V=gt.Shape.extend({type:"piece",init:function(l,r,u,h,d,k,L){this.flat=L,this._super(l,r),this.img=u,this.originalImg=u,this.size=Math.max(h,d),this.width=h,this.height=d,this.diagonal=~~Math.sqrt(h*h+d*d),this.edges=k,this.lastRotation=0,this.size/2,this.tx=this.x+this.width/2,this.ty=this.y+this.height/2,this.x=-this.width/2,this.y=-this.height/2},draw_path:function(l){let r=this.size,u,h=0;for(l.beginPath(),l.moveTo(this.x,this.y);h<4;h++){u=this.edges[h],r=h%2?this.height:this.width;let d=h%2?this.height:this.width,k=h%2?this.width:this.height,L=h%2?this.y:this.x,z=h%2?this.x:this.y;u?this[u](l,d,k,L,z):l.lineTo(L+r,z),l.rotate(Math.PI/2)}l.closePath()},render:function(l,r){l=l||this.ox||0,r=r||this.oy||0,this.originalTX=this.originalTX||this.tx,this.originalTY=this.originalTY||this.ty;let u=this.ctx||X.getContext(c.createElement("canvas")),h=this.size+.5;y.canvas.width=u.canvas.width=h*2,y.canvas.height=u.canvas.height=h*2,y.save(),u.save(),this.applyStyle(u),y.lineWidth=.5,u.lineWidth=.5,u.translate(this.width,this.height),u.rotate(this.rotation*_),y.translate(this.width,this.height),y.rotate(this.rotation*_),this.draw_path(u),this.draw_path(y),u.fill(),y.drawImage(this.originalImg,-this.originalTX-l,-this.originalTY-r),this.stroke&&(y.globalCompositeOperation="lighter",y.shadowOffsetY=1.5,y.shadowOffsetX=1.5,y.shadowBlur=0,y.shadowColor="rgba(255, 255, 255, .4)",y.lineWidth=1.5,y.strokeStyle="rgba(0, 0, 0, .4)",y.stroke(),y.globalCompositeOperation="darken",y.shadowBlur=1,y.shadowOffsetY=-1,y.shadowOffsetX=-1,y.shadowBlur=2,y.shadowColor="rgba(0, 0, 0, .2)",y.lineWidth=2,y.strokeStyle="rgba(0, 0, 0, .4)",y.stroke(),y.clip()),y.restore(),u.restore(),u.globalCompositeOperation="source-in",u.globalCompositeOperation!=="source-in"&&(u.globalCompositeOperation="source-atop"),u.drawImage(y.canvas,0,0),this.ctx||(this.tx+=this.offset),this.img=u.canvas,this.ctx=u,this.ox=l,this.oy=r},outside:function(l,r,u,h,d){if(this.flat)return l.lineTo(h+r,d);l.lineTo(h+r*.34,d),l.bezierCurveTo(h+r*.5,d,h+r*.4,d+u*-.15,h+r*.4,d+u*-.15),l.bezierCurveTo(h+r*.3,d+u*-.3,h+r*.5,d+u*-.3,h+r*.5,d+u*-.3),l.bezierCurveTo(h+r*.7,d+u*-.3,h+r*.6,d+u*-.15,h+r*.6,d+u*-.15),l.bezierCurveTo(h+r*.5,d,h+r*.65,d,h+r*.65,d),l.lineTo(h+r,d)},inside:function(l,r,u,h,d){if(this.flat)return l.lineTo(h+r,d);l.lineTo(h+r*.35,d),l.bezierCurveTo(h+r*.505,d+.05,h+r*.405,d+u*.155,h+r*.405,d+u*.1505),l.bezierCurveTo(h+r*.3,d+u*.3,h+r*.5,d+u*.3,h+r*.5,d+u*.3),l.bezierCurveTo(h+r*.7,d+u*.29,h+r*.6,d+u*.15,h+r*.6,d+u*.15),l.bezierCurveTo(h+r*.5,d,h+r*.65,d,h+r*.65,d),l.lineTo(h+r,d)},draw:function(l){let r=this.x-this.width/2-.5,u=this.y-this.height/2-.5;if(N){this.setTransform(l),l.drawImage(this.img,r,u);return}this.rotation!==this.lastRotation&&(this.render(),this.lastRotation=this.rotation),l.drawImage(this.img,r+this.tx,u+this.ty)},check:function(l){let r;if(l.type==="piece")r=P(this,l);else{let u,h=l.pieces.length;for(u=0;u<h&&!(r=P(this,l.pieces[u]));u++);}return r&&this.rmove(r[0],r[1]),r},hitTest:function(l){if(!this.hide)return this.setTransform(x),this.draw_path(x),x.isPointInPath(l.x*st(),l.y*st())}}),Z=gt.Shape.extend({type:"group",init:function(){this.pieces=[],this._super(0,0)},draw:function(l){if(this.hide)return;let r,u=this.pieces.length;for(r=0;r<u;r++)this.pieces[r].draw(l)},hitTest:function(l){let r,u=this.pieces.length;for(r=0;r<u;r++)if(this.pieces[r].hitTest(l))return!0},check:function(l){let r,u=this.pieces.length,h;if(l.type==="piece"){for(r=0;r<u;r++)if(h=P(this.pieces[r],l))return this.rmove(h[0],h[1]),!0}else{let d,k=l.pieces.length;for(r=0;r<u;r++)for(d=0;d<k;d++)if(h=P(this.pieces[r],l.pieces[d]))return this.rmove(h[0],h[1]),!0}},rmove:function(l,r){let u,h=this.pieces.length;for(u=0;u<h;u++)this.pieces[u].rmove(l,r);this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty},add:function(){this.pieces=this.pieces.concat.apply(this.pieces,arguments),this.minPieceX=b(this.pieces,"tx"),this.minPieceY=b(this.pieces,"ty"),this.width=v(this.pieces,"tx").tx-this.minPieceX.tx,this.height=v(this.pieces,"ty").ty-this.minPieceY.ty,this.width+=this.pieces[0].width,this.height+=this.pieces[0].height,this.x=this.pieces[0].x,this.y=this.pieces[0].y,this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty}});function v(l,r){let u=l[0][r],h=0;for(let d=1;d<l.length;d++)l[d][r]>u&&(u=l[d][r],h=d);return l[h]}function b(l,r){let u=l[0][r],h=0;for(let d=1;d<l.length;d++)l[d][r]<u&&(u=l[d][r],h=d);return l[h]}gt.register("group",Z),gt.register("piece",V)})(document);const Yt=function(c,$,T){let x="inside",w="outside",_=null,y,S=[x,w],O=0,q={spread:.7,offsetTop:$.innerHeight*.2,maxWidth:$.innerWidth*.8,maxHeight:$.innerHeight*.6,defaultImage:"images/default-puzzle.png",piecesNumberTmpl:"%d Pieces",redirect:"",border:!0,defaultPieces:3,shuffled:!1,rotatePieces:!0,numberOfPieces:ne,squarePieces:!1},I=45,N=st();function M(){return S[X.randint(2)]}let P={};P.Jigsaw=Gt.extend({init:function(v){let b=new nt,l=this;this.container=c.body,this.opts=v=X.extend(v||{},q),this.max_width=v.maxWidth,this.max_height=v.maxHeight,X.$("redirect-form").action=v.redirect,y=v.defaultImage,this.eventBus=b,this.ce=new gt("canvas"),this.ui=new P.UI(b,v.defaultPieces||10),this.tmp_img=c.createElement("img"),this.img=c.getElementById("image"),this.ctx=X.getContext(this.img),this.preview=c.getElementById("image-preview"),this.previewCtx=X.getContext(this.preview),this.parts=v.defaultPieces||10,this.tmp_img.onload=function(){l.original=this,l.draw_image(this),X.calcPieces({image:l.img,template:l.opts.piecesNumberTmpl,selected:l.parts,options:l.opts.numberOfPieces},oe),l.render()},this.tmp_img.onerror=function(){y&&l.set_image(y)},V(this.ce,b,this.opts.rotatePieces),b.on(P.Events.JIGSAW_COMPLETE,function(){l.ui.stop_clock(),v.redirect?l.redirect():l.ui.show_time()}),v.shuffled&&b.on(P.Events.RENDER_FINISH,this.start_game.bind(this)),b.on(P.Events.PARTS_NUMBER_CHANGED,this.set_parts.bind(this)),b.on(P.Events.RENDER_REQUEST,this.render.bind(this)),b.on(P.Events.START_GAME,this.start_game.bind(this)),b.on(P.Events.JIGSAW_SET_IMAGE,this.set_image.bind(this)),X.addEvent($,"resize",this.resize.bind(this)),this.resize(),this.set_image()},resize:function(){console.log(1);let b=this.ce.cv,l=this.width(),r=this.height()-I;b.width=l*st(),b.height=r*st(),b.style.width=l+"px",b.style.height=r+"px",this.ce.redraw(),gt.isTouchDevice&&X.fullScreen()},redirect:function(){X.$("t").value=this.ui.time(),X.$("p").value=this.parts,X.$("redirect-form").submit()},set_parts:function(v){this.parts=v},set_image:function(v){this.ce.cv.className="loading",this.tmp_img.src=v||y},width:function(){return this.container.offsetWidth},height:function(){return this.container.offsetHeight},draw_image:function(v,b,l){let r=b||this.max_width*st(),u=l||this.max_height*st(),h,d,k=this.ctx;if(r>this.width()||u>this.height()-I){let L=Math.min(this.width()/r,(this.height()-I)/u);r*=L,u*=L}if(v.width>r||v.height>u){let L=Math.min(r/v.width,u/v.height);h=~~(v.width*L)*st(),d=~~(v.height*L)*st(),k.canvas.width=h,k.canvas.height=d,k.drawImage(v,0,0,v.width,v.height,0,0,h,d)}else k.canvas.width=v.width*st(),k.canvas.height=v.height*st(),k.drawImage(v,0,0,v.width,v.height,0,0,k.canvas.width,k.canvas.height)},clear:function(){this.ce._shapes=[]},start_game:function(){let v=this.ce.getAll("piece");if(this.__pieces)this.ce._shapes=v=this.__pieces.slice(0);else return;this.ce.clear();let b,l=v.length,r;v[0].size;let u=this.opts.spread,h=this.width()*st(),d=(this.height()-I)*st(),k=h*u,L=d*u,z=~~((h-k)/2),tt=~~((d-L)/2);for(b=0;b<l;b++)r=v[b],r.tx=X.randint(k)+r.tx%1+z,r.ty=X.randint(L)+r.tx%1+tt,this.opts.rotatePieces&&(r.rotation=X.randint(4)*90);this.opts.shuffled&&(this.ce.cv.className="",this.ui.init_clock()),X.getElement("START_GAME").style.display="none",this.ce.find("*").attr({hide:!1}),this.ce.shuffled=!0,this.ce.redraw()},render:function(){this.opts.shuffled?(this.ce.cv.className="loading",this.ce.clear(),this.ui.stop_clock()):this.ce.cv.className="",X.getElement("START_GAME").style.display=null,this.ce.shuffled=!1;let v,b,l,r,u=[],h=[],d=this.img.width,k=this.img.height,L=~~Math.sqrt(d*k/this.parts),z=~~(d/L),tt=~~(k/L),U=0,F=0,lt=++O,ut;for(this.flag=lt;z*tt<this.parts;)L--,z=~~(d/L),tt=~~(k/L);let R=~~(d/z),D=~~(k/tt);R=R%2?R:R-1,D=D%2?D:D-1,ut=~~(this.width()/2*st()-R*z/2),this.clear();let rt=~~((d-z*R)/2),Y=~~((k-tt*D)/2);rt=rt>=0?rt:0,Y=Y>=0?Y:0,this.preview.style.marginTop=this.opts.offsetTop+"px",this.preview.width=R*z,this.preview.height=D*tt,this.preview.style.width=this.preview.width/st()+"px",this.preview.style.height=this.preview.height/st()+"px",this.previewCtx.globalAlpha=.3,this.previewCtx.drawImage(this.img,rt,Y,R*z,D*tt,0,0,R*z,D*tt),(function ot(){U<z&&lt===this.flag?(F<tt?(v=F===0?_:l===x?w:x,b=U===z-1?_:M(),l=F===tt-1?_:M(),r=U===0?0:h[F]===x?w:x,this.ce.piece(R*U,D*F+this.opts.offsetTop,$.G_vmlCanvasManager?this.tmp_img:this.img,R,D,[v,b,l,r],this.opts.squarePieces).attr({col:U,row:F,offset:ut,stroke:this.opts.border?"black":""}).get(-1).render(rt,Y-this.opts.offsetTop),this.opts.shuffled||this.ce.redraw(),u.push(b),F++):(U++,F=0,h=u,u=[]),setTimeout(ot.bind(this),20)):this.flag===lt&&(this.__pieces=this.ce.get().slice(0),this.ce.redraw(),this.eventBus.emit(P.Events.RENDER_FINISH))}).bind(this)()}}),P.Events={PARTS_NUMBER_CHANGED:"PartsNumberChanged",RENDER_REQUEST:"RenderRequestEvent",RENDER_FINISH:"RenderFinishEvent",JIGSAW_RENDERED:"JigsawRenderedEvent",JIGSAW_SET_IMAGE:"JigsawSetImageEvent",START_GAME:"JigsawGameStartEvent",SHOW_PREVIEW:"JigsawShowPreview",JIGSAW_COMPLETE:"JigsawCompleteEvent",PIECES_CONNECTED:"PieceConnectedEvent",ZOOM_IN:"JigsawZoomIn",ZOOM_OUT:"JigsawZoomOut"},P.GET=function(){if(location.query)return;let v=location.search.replace(/^[?]/,"").split("&"),b=0,l=v.length,r={};for(;b<l;b++){if(!v[b])continue;let u=v[b].split("=");r[unescape(u[0])]=unescape(u[1])}return r},P.UI=Gt.extend({init:function(v,b){this.eventBus=v,this.clock=X.getElement("clock"),Z(this,v),v.on(P.Events.START_GAME,this.init_clock.bind(this)),v.on(P.Events.SHOW_PREVIEW,this.show_preview.bind(this))},stop_clock:function(){O++},init_clock:function(){let v=this;this.ini=new Date().getTime(),this.uuid=O,function b(){console.log(v.uuid,O,v.time()),v.uuid===O&&(v.clock.innerHTML=v.time(),setTimeout(b,1e3))}()},show_preview:function(){let v=X.getElement("image-preview");v.className=v.className==="show"?"hide":"show",v.style.marginLeft=-(v.width/2/N)+"px"},show_time:function(){this.show_modal("congrat"),X.getElement("START_GAME").style.display=null,X.getElement("time").innerHTML=this.clock.innerHTML,X.getElement("time-input").value=this.clock.innerHTML},time:function(){let v=~~((new Date().getTime()-this.ini)/1e3),b=v%60,l=~~(v/60),r=~~(l/60);return l%=60,(r>9?r:"0"+r)+":"+(l>9?l:"0"+l%60)+":"+(b>9?b:"0"+b)},show_modal:function(v){Ht.Modal.open(v)}});function V(v,b,l){v.drag("*",{start:function(r,u){r.cv.style.cursor="move",r.lastX*=st(),r.lastY*=st(),this.handleX=r.lastX-this.tx,this.handleY=r.lastY-this.ty},move:function(r,u){r.x*=st(),r.y*=st(),r.x+=r.lastX-this.tx-this.handleX,r.y+=r.lastY-this.ty-this.handleY},afterMove:function(r,u){let h=~~(this.width/2),d=~~(this.height/2),k=this.x+this.tx+h,L=this.y+this.ty+d,z=r.cv.width,tt=r.cv.height;this.rotation/45%2&&(h=this.diagonal/2,d=this.diagonal/2);let U=0,F=0;k-h<0?U=k-h:k+h>z&&(U=k+h-z),L-d<0?F=L-d:L+d>tt&&(F=L+d-tt),this.rmove(-U,-F)},end:function(r,u){if(r.cv.style.cursor="default",!r.shuffled)return;let h=r.getAll("piece").concat(r.getAll("group")),d=0,k=h.length,L=this;for(;d<k;d++)h[d]!==this&&L.check(h[d])&&(r.remove(L),r.remove(h[d]),r._curHover=r.group().get(-1),r._curHover.add(L.pieces||L,h[d].pieces||h[d]),L=r._curHover,r.focused=null);this!==L&&b.emit(P.Events.PIECES_CONNECTED),!v.getAll("piece").length&&v.getAll("group").length===1&&v.shuffled&&(v.shuffled=!1,b.emit(P.Events.JIGSAW_COMPLETE)),L.type==="group"&&(r.remove(L),r._shapes.unshift(L))}}).focus("*",function(r,u){r.remove(this),r._shapes.push(this)}),X.addEvent(v.cv,"contextmenu",function(r){l&&v.focused&&(v.focused.rotation=(v.focused.rotation+45)%360,v.redraw()),r.preventDefault()}),l&&(v.keydown("right",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation+45)%360),!1}).keydown("left",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation-45)%360),!1}),v.tap("*",function(r,u){gt.isTouchDevice&&v.focused&&(v.focused.rotation=(v.focused.rotation+45)%360,v.redraw())}))}function Z(v,b){function l(h){let d=h[0];if(!d.type.match(/image.*/)){X.getElement("image-error").style.display="block";return}let k=new FileReader;k.onloadend=function(L){b.emit(P.Events.JIGSAW_SET_IMAGE,this.result),r()},k.readAsDataURL(d)}$.FileReader&&new FileReader().onload===null&&(X.getElement("create-puzzle").classList.remove("hide"),X.$("image-input").change(function(){l(this.files)}),"ondragenter"in $&&"ondrop"in $&&(X.getElement("dnd").style.display="block",c.addEventListener("dragenter",function(h){return h.stopPropagation(),h.preventDefault(),!1},!1),c.addEventListener("dragover",function(h){return h.stopPropagation(),h.preventDefault(),!1},!1),c.addEventListener("drop",function(h){h.stopPropagation(),h.preventDefault();let d=h.dataTransfer;l(d.files)},!1)));function r(){return Ht.Modal.close(),!1}function u(h){return console.log(h),h}X.$("set-parts").change(function(){b.emit(P.Events.PARTS_NUMBER_CHANGED,u(this.value)),b.emit(P.Events.RENDER_REQUEST)}),X.$("set-preview").change(function(){b.emit(P.Events.SHOW_PREVIEW)}),gt.addEventListener("game-options","mousedown",function(h){let d=h.target||h.srcElement;P.Events[d.id]&&(h.preventDefault(),b.emit(P.Events[d.id]))})}return nt.mixin(P.Jigsaw),P}(document,window),Ht=function(){let c=0,$=window.Audio&&new Audio().canPlayType,T=0,x=function(M){return document.getElementById(M)},w,_,y,S;function O(){w=x("modal-window"),_=x("modal-window-msg"),y=x("modal-window-close"),S=x("overlay");let M=gt.isTouchDevice?"touchstart":"click";gt.addEventListener(S,M,I),gt.addEventListener(y,M,I)}function q(M,P){w||O();let V=w.style,Z=x(M);Z.className="",Ht.Modal.currentContent=Z,_.appendChild(Z);let v=w.offsetWidth;V.marginLeft=-v/2+"px",w.className="modal",S.className=""}function I(M){M&&M.preventDefault(),w.className="modal hide",S.className="hide";let P=Ht.Modal.currentContent;return setTimeout(function(){P&&(P.className="hide",document.body.appendChild(P))},600),!1}function N(M,P){if(!$)return;let V;for(this.file=M,T=P,this.audio=[],V=0;V<P;V++)this.audio[V]=new Audio;const Z=(function(){document.removeEventListener("touchstart",Z),document.removeEventListener("mousedown",Z),this.load()}).bind(this);document.addEventListener("touchstart",Z),document.addEventListener("mousedown",Z)}return N.prototype.load=function(){if(!$||this._loaded)return;this._loaded=!0;const M=this.audio[0].canPlayType("audio/mp3")?".mp3":".wav";for(let P=0;P<T;P++)this.audio[P].src=this.file+M,this.audio[P].volume=0,this.audio[P].load()},N.prototype.play=function(){$&&(this.audio[c].volume=1,this.audio[c].play(),c=(c+1)%T)},{Sound:N,Modal:{open:q,close:I}}}(),Wt=(()=>{const c="app-slider-panel__animation-init",$="app-slider-panel__expanded",T="app-slider-ov",x="expanded";let w=null,_=[];return{isReadyToUse(){return w!=null},init:function(){if(_=Array.from(document.querySelectorAll(".js-sidebar-open")),w=document.querySelector(".app-slider-panel"),!Wt.isReadyToUse())throw new Error("SliderPanel: elements to init not found");setTimeout(()=>{w.classList.add(c)},0),_.forEach(y=>{y.addEventListener("click",()=>Wt.toggle())}),document.addEventListener("click",y=>{!w.contains(y.target)&&_.every(S=>!S.contains(y.target))&&w.classList.contains(x)&&Wt.toggle()})},toggle:function(){const y=!w.classList.contains(x);w.classList.toggle(x,y),_.forEach(S=>S.classList.toggle("active",y)),document.body.classList.toggle($,y),matchMedia&&matchMedia("(max-width: 767px)").matches&&document.documentElement.classList.toggle(T,y)}}})();window.addEventListener("DOMContentLoaded",function(){new Wt.init("#sidebar-panel");const c=new Ht.Sound("sound/click",10),$=new Yt.Jigsaw({defaultImage:"images/default-puzzle.png",piecesNumberTmpl:"%d Pieces",defaultPieces:3});$.eventBus.on(Yt.Events.PIECES_CONNECTED,function(){c.play()}),Yt.GET.image&&$.set_image(Yt.GET.image)});document.addEventListener("ontouchmove",function($){$.preventDefault()})});export default ae();
