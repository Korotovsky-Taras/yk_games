var ee=(f,v)=>()=>(v||f((v={exports:{}}).exports,v),v.exports);var ae=ee((le,Wt)=>{(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))A(E);new MutationObserver(E=>{for(const _ of E)if(_.type==="childList")for(const y of _.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&A(y)}).observe(document,{childList:!0,subtree:!0});function P(E){const _={};return E.integrity&&(_.integrity=E.integrity),E.referrerPolicy&&(_.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?_.credentials="include":E.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function A(E){if(E.ep)return;E.ep=!0;const _=P(E);fetch(E.href,_)}})();/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   3.2.2+39aa2571
 */(function(){function f(t){return typeof t=="function"||typeof t=="object"&&t!==null}function v(t){return typeof t=="function"}var P;Array.isArray?P=Array.isArray:P=function(t){return Object.prototype.toString.call(t)==="[object Array]"};var A=P,E=0,_,y,S=function(n,a){u[E]=n,u[E+1]=a,E+=2,E===2&&(y?y(h):C())};function O(t){y=t}function F(t){S=t}var M=typeof window<"u"?window:void 0,I=M||{},R=I.MutationObserver||I.WebKitMutationObserver,L=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",Q=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function ft(){return function(){process.nextTick(h)}}function $(){return function(){_(h)}}function b(){var t=0,n=new R(h),a=document.createTextNode("");return n.observe(a,{characterData:!0}),function(){a.data=t=++t%2}}function l(){var t=new MessageChannel;return t.port1.onmessage=h,function(){t.port2.postMessage(0)}}function r(){return function(){setTimeout(h,1)}}var u=new Array(1e3);function h(){for(var t=0;t<E;t+=2){var n=u[t],a=u[t+1];n(a),u[t]=void 0,u[t+1]=void 0}E=0}function d(){try{var t=require,n=t("vertx");return _=n.runOnLoop||n.runOnContext,$()}catch{return r()}}var C;L?C=ft():R?C=b():Q?C=l():M===void 0&&typeof require=="function"?C=d():C=r();function k(t,n){var a=this,p=new this.constructor(ht);p[U]===void 0&&c(p);var m=a._state;if(m){var g=arguments[m-1];S(function(){j(m,p,g,a._result)})}else Pt(a,p,t,n);return p}var z=k;function Z(t){var n=this;if(t&&typeof t=="object"&&t.constructor===n)return t;var a=new n(ht);return K(a,t),a}var q=Z,U=Math.random().toString(36).substring(16);function ht(){}var lt=void 0,N=1,D=2,nt=new $t;function Y(){return new TypeError("You cannot resolve a promise with itself")}function rt(){return new TypeError("A promises callback cannot return that same promise.")}function yt(t){try{return t.then}catch(n){return nt.error=n,nt}}function ut(t,n,a,p){try{t.call(n,a,p)}catch(m){return m}}function Nt(t,n,a){S(function(p){var m=!1,g=ut(a,n,function(T){m||(m=!0,n!==T?K(p,T):V(p,T))},function(T){m||(m=!0,B(p,T))},"Settle: "+(p._label||" unknown promise"));!m&&g&&(m=!0,B(p,g))},t)}function Ct(t,n){n._state===N?V(t,n._result):n._state===D?B(t,n._result):Pt(n,void 0,function(a){K(t,a)},function(a){B(t,a)})}function wt(t,n,a){n.constructor===t.constructor&&a===z&&constructor.resolve===q?Ct(t,n):a===nt?B(t,nt.error):a===void 0?V(t,n):v(a)?Nt(t,n,a):V(t,n)}function K(t,n){t===n?B(t,Y()):f(n)?wt(t,n,yt(n)):V(t,n)}function tt(t){t._onerror&&t._onerror(t._result),xt(t)}function V(t,n){t._state===lt&&(t._result=n,t._state=N,t._subscribers.length!==0&&S(xt,t))}function B(t,n){t._state===lt&&(t._state=D,t._result=n,S(tt,t))}function Pt(t,n,a,p){var m=t._subscribers,g=m.length;t._onerror=null,m[g]=n,m[g+N]=a,m[g+D]=p,g===0&&t._state&&S(xt,t)}function xt(t){var n=t._subscribers,a=t._state;if(n.length!==0){for(var p,m,g=t._result,T=0;T<n.length;T+=3)p=n[T],m=n[T+a],p?j(a,p,m,g):m(g);t._subscribers.length=0}}function $t(){this.error=null}var vt=new $t;function Et(t,n){try{return t(n)}catch(a){return vt.error=a,vt}}function j(t,n,a,p){var m=v(a),g,T,G,J;if(m){if(g=Et(a,p),g===vt?(J=!0,T=g.error,g=null):G=!0,n===g){B(n,rt());return}}else g=p,G=!0;n._state!==lt||(m&&G?K(n,g):J?B(n,T):t===N?V(n,g):t===D&&B(n,g))}function zt(t,n){try{n(function(p){K(t,p)},function(p){B(t,p)})}catch(a){B(t,a)}}var i=0;function o(){return i++}function c(t){t[U]=i++,t._state=void 0,t._result=void 0,t._subscribers=[]}function w(t){return new _t(this,t).promise}var x=w;function W(t){var n=this;return A(t)?new n(function(a,p){for(var m=t.length,g=0;g<m;g++)n.resolve(t[g]).then(a,p)}):new n(function(a,p){p(new TypeError("You must pass an array to race."))})}var et=W;function bt(t){var n=this,a=new n(ht);return B(a,t),a}var dt=bt;function pt(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function mt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ct=X;function X(t){this[U]=o(),this._result=this._state=void 0,this._subscribers=[],ht!==t&&(typeof t!="function"&&pt(),this instanceof X?zt(this,t):mt())}X.all=x,X.race=et,X.resolve=q,X.reject=dt,X._setScheduler=O,X._setAsap=F,X._asap=S,X.prototype={constructor:X,then:z,catch:function(t){return this.then(null,t)}};var _t=At;function At(t,n){this._instanceConstructor=t,this.promise=new t(ht),this.promise[U]||c(this.promise),A(n)?(this._input=n,this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),this.length===0?V(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&V(this.promise,this._result))):B(this.promise,Ft())}function Ft(){return new Error("Array Methods must be provided an Array")}At.prototype._enumerate=function(){for(var t=this.length,n=this._input,a=0;this._state===lt&&a<t;a++)this._eachEntry(n[a],a)},At.prototype._eachEntry=function(t,n){var a=this._instanceConstructor,p=a.resolve;if(p===q){var m=yt(t);if(m===z&&t._state!==lt)this._settledAt(t._state,n,t._result);else if(typeof m!="function")this._remaining--,this._result[n]=t;else if(a===ct){var g=new a(ht);wt(g,t,m),this._willSettleAt(g,n)}else this._willSettleAt(new a(function(T){T(t)}),n)}else this._willSettleAt(p(t),n)},At.prototype._settledAt=function(t,n,a){var p=this.promise;p._state===lt&&(this._remaining--,t===D?B(p,a):this._result[n]=a),this._remaining===0&&V(p,this._result)},At.prototype._willSettleAt=function(t,n){var a=this;Pt(t,void 0,function(p){a._settledAt(N,n,p)},function(p){a._settledAt(D,n,p)})};function e(){var t;if(typeof global<"u")t=global;else if(typeof self<"u")t=self;else try{t=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;n&&Object.prototype.toString.call(n.resolve())==="[object Promise]"&&!n.cast||(t.Promise=ct)}var s=e;ct.Promise=ct,ct.polyfill=s,typeof define=="function"&&define.amd?define(function(){return ct}):typeof Wt<"u"&&Wt.exports?Wt.exports=ct:typeof this<"u"&&(this.Promise=ct),s()}).call(void 0);let qt=!1;function Gt(){}Gt.extend=function(f){const v=this.prototype;let P;qt=!0,P=new this,qt=!1;for(let E in f)typeof f[E]=="function"&&typeof v[E]=="function"?P[E]=function(_,y){return function(){const S=this._super;this._super=v[_];const O=y.apply(this,arguments);return this._super=S,O}}(E,f[E]):P[E]=f[E];function A(){if(this instanceof A)!qt&&this.init&&this.init.apply(this,arguments);else return new A(...arguments)}return A.prototype=P,A.prototype.constructor=A,A.extend=this.extend,A};function ie(f){let v=Math,P=v.PI,A=2*P,E=P/180,_=v.sqrt,y=v.pow,S=v.cos,O=v.sin,F=v.round,M=v.abs,I=v.acos,R,L=Object.prototype.hasOwnProperty,Q=Array.prototype.slice,ft={tx:0,ty:0,scaleX:1,scaleY:1,skewX:0,skewY:0,fill:"#000",stroke:"",lineWidth:1,lineJoin:"miter",lineCap:"butt",alpha:1,rotation:0,composite:"source-over",shadowColor:"rgba(0, 0, 0, 0.0)",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,fontStyle:"normal",fontWeight:"normal",fontSize:10,fontFamily:"Arial"},$=document.createElement("canvas"),b=$.getContext&&$.getContext("2d"),l=function(e,s){return _(y(e.x-s.x,2)+y(e.y-s.y,2))},r=function(e,s,t,n,a){let p=t-e,m=n-s,g={},T;if(!(p===0&&m===0))return T=((a.x-e)*p+(a.y-s)*m)/(p*p+m*m),T<0?g={x:e,y:s}:T>1?g={x:t,y:t}:g={x:e+T*p,y:s+T*m},l(g,a)},u=function(e,s,t){return t=E*t,{x:e*S(t)-s*O(t),y:e*O(t)+s*S(t)}},h=function(e,s){let t;for(t in s)L.call(s,t)&&(e[t]=s[t])},d=Gt.extend({init:function(e,s){this.x=e||0,this.y=s||0,h(this,ft)},position:function(){let e=u(this.x*this.scaleX,this.y*this.scaleY,this.rotation);return{x:e.x+this.tx,y:e.y+this.ty}},rmove:function(e,s){this.tx+=e,this.ty+=s},attr:function(e,s){let t;if(typeof e=="string")this[e]=s;else for(t in e)this[t]=e[t];return this},applyStyle:function(e){let s=this.shadowBlur,t=this.shadowOffsetX,n=this.shadowOffsetY;e.fillStyle=this.fill,e.globalAlpha=this.alpha,e.globalCompositeOperation=this.composite,this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.lineWidth),(t||n||s)&&(e.shadowColor=this.shadowColor,e.shadowOffsetX=t,e.shadowOffsetY=n,e.shadowBlur=s)},setTransform:function(e){let s=f.__zoom,t=this.scaleX*s,n=this.scaleY*s,a=this.skewX*s,p=this.skewY*s,m=this.rotation*E,g=O(m),T=S(m),G=this.tx*s,J=this.ty*s,ot=T*t-g*p,at=T*a-g*n,Tt=g*t+T*p,kt=g*a+T*n;e.setTransform(ot,Tt,at,kt,G,J)},draw:function(e){throw new Error("El método draw no se ha implementado")},fill_or_stroke:function(e){this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(b&&b.isPointInPath)return this.draw(b),b.setTransform(1,0,0,1,0,0),b.isPointInPath(e.x,e.y);throw Error("Método isPointInPath no soportado: Necesita FlashCanvasPro")}}),C=d.extend({init:function(e,s,t,n,a){this.r=a||0,this.w=t||5,this.h=n||t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y,n=this.w,a=this.h;this.applyStyle(e),this.setTransform(e),e.beginPath(),this.r?f.setContext(e).polygon(s,t,s+n,t,s+n,t+a,s,t+a,this.r):e.rect(s,t,F(n),F(a)),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.r)return this._super(e);let s=this.position(),t=u(e.x-s.x,e.y-s.y,-this.rotation);return t.x>=0&&t.x<=this.w*this.scaleX&&t.y>=0&&t.y<=this.h*this.scaleY}}),k=C.extend({init:function(e,s,t){this.setText(t),this._super(e,s,this.w,this.h)},applyStyle:function(e){e.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.h=this.fontSize,this.w=e.measureText(this.text).width,this._super(e)},setText:function(e){this.text=e+""},draw:function(e){this.applyStyle(e),this.setTransform(e),this.fill&&e.fillText(this.text,this.x,this.y+this.h),this.stroke&&e.strokeText(this.text,this.x,this.y+this.h)},hitTest:function(e){return this.skewX||this.skewY&&b&&b.isPointInPath?(this.setTransform(b),b.beginPath(),b.rect(this.x,this.y,this.w,this.h),b.closePath(),b.isPointInPath(e.x,e.y)):this._super(e)}}),z={},Z=C.extend({init:function(e,s,t){this.setImg(t),this._super(e,s,this.img.width,this.img.height)},setImg:function(e){if(z[e]){this.img=z[e],this.src=this.img.src;return}e.nodeName=="IMG"?this.img=e:(e+="",this.img=z[e]=new Image,this.img.src=e),this.img.onload=function(){f.forse_redraw()},this.src=this.img.src},draw:function(e){let s=this.x,t=this.y;this.w=this.img.width,this.h=this.img.height,this.applyStyle(e),this.setTransform(e),e===b?(e.beginPath(),e.rect(s,t,F(this.w),F(this.h)),e.closePath()):e.drawImage(this.img,s,t)}}),q=C.extend({draw:function(e){let s=this.x,t=this.y,n=this.w,a=this.h,p=.5522847498307933,m=p*n,g=p*a;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(s+n,t),e.bezierCurveTo(s+n,t-g,s+m,t-a,s,t-a),e.bezierCurveTo(s-m,t-a,s-n,t-g,s-n,t),e.bezierCurveTo(s-n,t+g,s-m,t+a,s,t+a),e.bezierCurveTo(s+m,t+a,s+n,t+g,s+n,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:d.prototype.hitTest}),U=d.extend({init:function(e,s,t,n,a,p){this.clockwise=p,this.endAngle=a,this.startAngle=n,this.r=t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,F(this.r),this.startAngle||P*2,this.endAngle||0,!!this.clockwise),e.lineTo(s,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()}}),ht=d.extend({init:function(e,s,t){this.r=t||5,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,F(this.r),0,P*2,!0),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.scaleX!==this.scaleY)return this._super(e);let s=!!this.stroke&&this.lineWidth,t=this.position();return l(e,t)<=(this.r+s)*this.scaleX}}),lt=d.extend({init:function(e,s,t,n){this.x2=t,this.y2=n,this._super(e,s),this.stroke="#000"},rmove:function(e,s){this.x+=e,this.y+=s,this.x2+=e,this.y2+=s},applyStyle:function(e){e.lineJoin=this.lineJoin,e.lineCap=this.lineCap,this._super(e)},draw:function(e){this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.x2,this.y2),e.stroke()},hitTest:function(e){return r(this.x,this.y,this.x2,this.y2,e)<=this.lineWidth+2}}),N,D,nt,Y=null,rt=null,yt=!1,ut=/[MmLlZzHhVvCcQqSsTtAa]\s*([\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?[,\s]*)*/g,Nt=/[\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?/g,Ct=function(e,s,t,n){let a=e*t+s*n,p=_(e*e+s*s),m=_(t*t+n*n),g=a/(p*m),T,G;return g>1?g=1:g<-1&&(g=-1),T=M(I(g)),G=e*n-s*t,G===M(G)?T:-T},wt=function(e,s,t){return[e*S(t)-s*O(t),s*S(t)+e*O(t)]},K=function(e,s,t){yt&&e.ctx.moveTo(s,t)},tt=function(e,s){N=e,D=s,Y=null,rt=null,yt=!1},V=function(){if(N===R)throw new Error("No current point; can't use relative coordinates")},B=function(e,s,t,n){if(s!==(t?e.length%t:e.length)||e.length<n)throw new Error("wrong number of arguments")},Pt=function(e,s){return this.ctx.moveTo(e,s),tt(e,s),nt=e,arguments.length>2&&$t.apply(this,Q.call(arguments,2)),this},xt=function(e,s){return yt&&(N=D=0),V(),e+=N,s+=D,this.ctx.moveTo(e,s),tt(e,s),nt=e,arguments.length>2&&vt.apply(this,Q.call(arguments,2)),this},$t=function(e,s){let t,n=arguments.length;for(B(arguments,0,2,2),K(this,e,s),this.ctx.lineTo(e,s),t=2;t<n;t+=2)this.ctx.lineTo(e=arguments[t],s=arguments[t+1]);return tt(e,s),this},vt=function(e,s){let t,n=N,a=D,p=arguments.length;for(B(arguments,0,2,2),V(),t=0;t<p;t+=2)this.ctx.lineTo(n+=arguments[t],a+=arguments[t+1]);return tt(n,a),this},Et=function(){return this.ctx.closePath(),tt(this,nt),this},j=function(e){let s,t=arguments.length;for(V(),s=0;s<t;s++)$t.call(this,arguments[s],D);return this},zt=function(e){let s,t=arguments.length;for(s=0;s<t;s++)vt.call(this,arguments[s],0);return this},i=function(e){let s,t=arguments.length;for(V(),s=0;s<t;s++)$t.call(this,N,arguments[s]);return this},o=function(e){let s,t=arguments.length;for(s=0;s<t;s++)vt.call(this,0,arguments[s]);return this},c=function(e,s,t,n,a,p){let m,g=arguments,T=arguments.length;for(B(g,0,6,6),K(this,e,t),this.ctx.bezierCurveTo(e,s,t,n,a,p),m=6;m<T;m+=6)this.ctx.bezierCurveTo(g[m],g[m+1],t=g[m+2],n=g[m+3],a=g[m+4],p=g[m+5]);return tt(a,p),Y=[t,n],this},w=function(e,s,t,n,a,p){let m,g=arguments,T=g.length,G=N,J=D;for(B(g,0,6,6),V(),m=0;m<T;m+=6)this.ctx.bezierCurveTo(G+g[m],J+g[m+1],t=G+g[m+2],n=J+g[m+3],G+=g[m+4],J+=g[m+5]);return tt(G,J),Y=[t,n],this},x=function(e,s,t,n){let a,p=arguments,m=p.length;for(B(arguments,0,4,4),K(this,e,s),this.ctx.quadraticCurveTo(e,s,t,n),a=4;a<m;a+=4)this.ctx.quadraticCurveTo(e=p[a],s=p[a+1],t=p[a+2],n=p[a+3]);return tt(t,n),rt=[e,s],this},W=function(e,s,t,n){let a,p=arguments,m=p.length,g=N,T=D;for(B(arguments,0,4,4),V(),a=0;a<m;a+=4)this.ctx.quadraticCurveTo(e=g+p[a],s=T+p[a+1],g+=p[a+2],T+=p[a+3]);return tt(g,T),rt=[e,s],this},et=function(){if(!Y)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=N,a=D,p=Y[0],m=Y[1],g,T,G,J,ot,at;for(B(arguments,0,4,4),V(),e=0;e<t;e+=4)g=n+(n-p),G=a+(a-m),T=s[e],J=s[e+1],ot=s[e+2],at=s[e+3],this.ctx.bezierCurveTo(g,G,T,J,ot,at),n=ot,a=at,p=T,m=J;return tt(n,a),Y=[p,m],this},bt=function(){if(!Y)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=N,a=D,p=Y[0],m=Y[1],g,T,G,J,ot,at;for(B(arguments,0,4,4),V(),e=0;e<t;e+=4)g=n+(n-p),G=a+(a-m),T=n+s[e],J=a+s[e+1],ot=n+s[e+2],at=a+s[e+3],this.ctx.bezierCurveTo(g,G,T,J,ot,at),n=ot,a=at,p=T,m=J;return tt(n,a),Y=[p,m],this},dt=function(){if(!rt)throw new Error("Last command was not a cubic bezier");let e,s=arguments.length,t=N,n=D,a=rt[0],p=rt[1],m,g,T,G;for(B(arguments,0,2,2),V(),e=0;e<s;e+=2)m=t+(t-a),g=n+(n-p),T=arguments[e],G=arguments[e+1],this.ctx.quadraticCurveTo(m,g,T,G),t=T,n=G,a=m,p=g;return tt(t,n),rt=[a,p],this},pt=function(){if(!rt)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=N,a=D,p=rt[0],m=rt[1],g,T,G,J;for(B(arguments,0,2,2),V(),e=0;e<t;e+=2)g=n+(n-p),T=a+(a-m),G=n+arguments[e],J=a+arguments[e+1],this.ctx.quadraticCurveTo(g,T,G,J),n=G,a=J,p=g,m=T;return tt(n,a),rt=[p,m],this},mt=function(e,s,t,n,a,p,m){if(!e||!s)return $t.call(this,p,m);n=!!n,a=!!a,V();let g=N,T=D,G=p,J=m,ot=t*E,at=O(ot),Tt=S(ot),kt=(g-G)/2,Dt=(T-J)/2,St=Tt*kt+at*Dt,Lt=-at*kt+Tt*Dt,Xt,It,Ot,jt,Jt,Ut,Vt,Mt;if(e=M(e),s=M(s),Xt=St*St/(e*e)+Lt*Lt/(s*s),Xt>1)e*=_(Xt),s*=_(Xt),It=Ot=0;else{let Kt=e*e,Qt=s*s,Zt=St*St,te=Lt*Lt,Rt=Kt*te+Qt*Zt;Rt=_(Kt*Qt/Rt-1),n===a&&(Rt=-Rt),It=Rt*e*Lt/s,Ot=-Rt*s*St/e}return jt=Tt*(It-at)*(Ot+(g+G)/2),Jt=at*(It+Tt)*(Ot+(T+J)/2),kt=(St-It)/e,Dt=(Lt-Ot)/s,Ut=Ct(1,0,kt,Dt),Mt=Ct(kt,Dt,(-St-It)/e,(-Lt-Ot)/s),a&&Mt<0?Mt+=A:!a&&Mt>0&&(Mt-=A),Vt=Ut+Mt,this.ellipse(jt,Jt,e,s,ot,Ut,Vt,!a),this},ct=function(e,s,t,n,a,p,m){return V(),mt.call(this,e,s,t,n,a,p+N,m+D),this},X=function(e,s,t,n,a,p,m,g){a=a||0,p=p||0,m=m===R?A:m;let T=wt(t*S(p),n*O(p),a),G=e+T[0],J=s+T[1],ot=wt(t*S(m),n*O(m),a),at=e+ot[0],Tt=s+ot[1];return K(this,G,J),this.ctx.translate(e,s),this.ctx.rotate(a),this.ctx.scale(t/n,1),this.ctx.arc(0,0,n,p,m,!!g),this.ctx.scale(n/t,1),this.ctx.rotate(-a),this.ctx.translate(-e,-s),tt(at,Tt),this},_t=function(){let e,s=arguments,t=s.length;if(t<6)throw new Error("not enough arguments");if(t%2===0)for(this.ctx.moveTo(s[0],s[1]),e=2;e<t;e+=2)this.ctx.lineTo(s[e],s[e+1]);else{let n=s[t-1],a=(t-1)/2,p=(s[a*2-2]+s[0])/2,m=(s[a*2-1]+s[1])/2,g,T;for(this.ctx.moveTo(p,m),e=0;e<a-1;e++)this.ctx.arcTo(g=s[e*2],T=s[e*2+1],s[e*2+2],s[e*2+3],n,p,m),p=g,m=T;this.ctx.arcTo(s[a*2-2],s[a*2-1],s[0],s[1],n,p,m)}return this},At=function(e){let s=e.match(ut),t,n,a,p,m,g=[];if(!s)throw new Error("Bad path: "+e);for(p=0;t=s[p];p++){for(a=[],a.cmd=t.charAt(0),n=t.match(Nt)||[],m=0;m<n.length;m++)a[m]=+n[m];g.push(a)}return g},Ft=d.extend({init:function(e){this.svgpath=At(e),this._super(0,0),this.svgpath[0].cmd.toLowerCase()=="m"&&(this.x=this.svgpath[0][0],this.y=this.svgpath[0][1])},draw:function(e){let s=this.svgpath,t,n;for(this.applyStyle(e),this.setTransform(e),e.beginPath(),f.setContext(e),t=0,n=s.length;t<n;t++)f[s[t].cmd].apply(f,s[t]);this.fill&&e.fill(),this.stroke&&e.stroke()}});return h(f,{distance:l,__zoom:1,Shape:d,setContext:function(e){return this.ctx=e,tt(0,0),e.beginPath(),this},polygon:_t,ellipse:X,M:Pt,m:xt,L:$t,l:vt,H:j,h:zt,V:i,v:o,C:c,c:w,S:et,s:bt,Q:x,q:W,T:dt,t:pt,A:mt,a:ct,Z:Et,z:Et}),f.register("image",Z),f.register("circle",ht),f.register("arc",U),f.register("ellipse",q),f.register("rect",C),f.register("text",k),f.register("line",lt),f.register("path",Ft),f}function se(f,v,P){let A=Object.prototype.toString,E="function",_="string",y="array",S="object",O=!1,F=[],M=!1,I,R=f.G_vmlCanvasManager,L=/webkit|msie/i.exec(f.navigator.userAgent),Q=navigator.userAgent,ft=Q.match(/android/i),$=Q.match(/iphone|ipad|ipod/i),b=Q.match(/Windows Phone/i)||Q.match(/iemobile/i),l=/^([#]?)([a-z][\w\-]*)$/,r=["","LEFT","CENTER","RIGHT"],u=[],h=null,d=null,C=!1,k="Cevent"+new Date().getTime(),z=0,Z={},q=function(i,o){return A.call(i).slice(8,-1).toLowerCase()===o},U=function(i,o){let c,w=0;if(q(i,y))for(;(c=i[w++])&&o(c,w)!==!1;);},ht=function(i,o){let c=rt(i,o);return c>=0?(i.splice(c,1),o):null},lt={click:"touchstart",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},N=function(i){return i=i||f.event,i.preventDefault||(i.preventDefault=function(){this.returnValue=!1}),i.stopPropagation||(i.stopPropagation=function(){this.cancelBubble=!0}),i},D=function(i,o){let c=lt[o];return c?function(w){let x=w.type===c;I=j.isTouchDevice=x,!(!x&&(ft||$||b))&&i.call(this,w)}:i},nt=function(i){return document.getElementById(i)},Y=function(){return document.addEventListener?function(o,c,w){o&&(o=typeof o=="string"?nt(o):o,w=D(w,c),lt[c]&&o.addEventListener(lt[c],w,!0),o.addEventListener(c,w,!0))}:function(o,c,w){o&&(o=typeof o=="string"?nt(o):o,o.attachEvent("on"+c,function(x){return x=N(x),w.call(x.target||x.srcElement,x)}))}}(),rt=function(){return[].indexOf?function(i,o){return i.indexOf(o)}:function(i,o){for(let c=0,w=i.length;c<w;c++)if(o===i[c])return c;return-1}}(),yt=function(i){let o=0,c=0;if(i.offsetParent)do o+=i.offsetLeft,c+=i.offsetTop;while(i=i.offsetParent);return{x:o,y:c}},ut=function(i,o,c){let w=i[k],x;return w||(w=i[k]=++z),x=Z[w],x||(x=Z[w]={}),o&&c!==P&&(x[o]=c),o?x[o]:x},Nt=function(i,o){if(!i)return;let c=i[k];c&&Z[c]&&delete Z[c]},Ct=function(i,o,c){let w=ut(i),x;U(o.split(" "),function(W){x=w[W]=w[W]||[],x.push(c)})},wt=function(i,o,c,w){let x,W=0,et=!0;for(c.ctx.save(),c.ctx.scale(c.__zoom,c.__zoom);x=o[W++];)x.call(i,c,w)===!1&&(et=!1);return c.ctx.restore(),et||w.preventDefault(),et},K=function(i,o,c,w){let x=ut(i,o),W=ut(w.cv,o);x&&x.length&&u.push(i,x),W&&W.length&&u.push(i,W)},tt=function(i,o){let c,w;for(i.clear(),c=0,w=u.length;c<w;c+=2)wt(u[c],u[c+1],i,o);u=[],i.redraw()},V=function(i,o){i.preventDefault(),i=i.touches?i.touches[0]:i;let c,w=o._shapes,x=w.length;for(o.x=((i&&i.pageX-o._pos.x+1||f.event.offsetX+1)-1)/o.__zoom||0,o.y=((i&&i.pageY-o._pos.y+1||f.event.offsetY+1)-1)/o.__zoom||0;c=w[--x];)if(c.hitTest(o))return c},B=function(i,o){return function(c){c.preventDefault(),c=c.touches?c.touches[0]:c,i.lastX=i.x,i.lastY=i.y,o=i._curHover;let w=((c&&c.pageX-i._pos.x+1||f.event.offsetX+1)-1)/i.__zoom||0,x=((c&&c.pageY-i._pos.y+1||f.event.offsetY+1)-1)/i.__zoom||0;if(!(!M&&Math.abs(w-i.x)<2&&Math.abs(x-i.y)<2)){if(i.x=w,i.y=x,M=!0,!i._clicked&&O){let W=V(c,i);W?(o!==W&&(K(W,"mouseover",c,i),o&&K(o,"mouseout",c,i)),i._curHover=o=W):o&&(K(o,"mouseout",c,i),i._curHover=o=null)}o&&K(o,"mousemove",c,i),u.length&&tt(i,c)}}},Pt=function(i){return function(o){(o.type==="mousedown"||o.type==="touchstart")&&i.calcCanvasPosition(),O||(i._curHover=V(o,i)),i._curHover;let c=i._curHover,w=r[o.which||o.button];i._clicked=!0,h=i.cv,i[w]=!0,c?(K(c,"mousedown",o,i),c!==i.focused&&(K(c,"focus",o,i),i.focused&&K(i.focused,"blur",o,i))):i.focused&&(K(i.focused,"blur",o,i),i.focused=null),i.focused=c||null,u.length&&tt(i,o),i[w]=!1}},xt=function(i){return function(o){i._clicked=!1,i._curHover&&(K(i._curHover,"mouseup",o,i),!M&&I&&(K(i._curHover,"tap",o,i),i.lastClick&&o.timeStamp-i.lastClick<300&&K(i._curHover,"dblclick",o,i),i.lastClick=o.timeStamp)),M=!1,u.length&&tt(i,o)}},$t=function(i){return function(o){i._curHover&&K(i._curHover,"click",o,i),u.length&&tt(i,o)}},vt=function(i){return function(o){i._curHover&&K(i._curHover,"dblclick",o,i),u.length&&tt(i,o)}},Et=function(){let i={specialKeys:{27:"esc",9:"tab",32:"space",13:"return",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",109:"-",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",191:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",110:".",111:"/",187:"+",189:"-"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"}},o;return function(c,w){let x=ut(w.cv,c,{}),W=ut(x);return function(et){if(h!==w.cv&&!w.__globalkeyevents)return;o=c=="keydown"?et.keyCode:o;let bt=i.specialKeys[o],dt=bt||String.fromCharCode(o||et.charCode).toLowerCase(),pt="",mt;if(et.altKey&&(pt+="alt+"),(et.ctrlKey||et.metaKey)&&(pt+="ctrl+"),et.shiftKey&&(pt+="shift+"),mt=W[pt+dt]||W[pt+i.shiftNums[dt]]||pt==="shift+"&&W[i.shiftNums[dt]]||W.any,mt){let ct=wt(w,mt,w,et);return w.play||w.redraw(),ct}}}}(),j=function(i,o){if(i=q(i,_)?v.getElementById(i):i,i.getContext||f.G_vmlCanvasManager)return new j.fn.init(i,o);throw Error("Your browser sucks")};j.forse_redraw=function(){let i,o=F.length;for(i=0;i<o;i++)F[i].redraw()},j.fn=j.prototype={init:function(i,o){this.cv=i,f.getComputedStyle?this.background=getComputedStyle(this.cv.parentElement).backgroundColor:this.background="#152937",!i.getContext&&f.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(i),this.ctx=i.getContext("2d"),this.width=i.width,this.height=i.height,this.__zoom=1,this.x=0,this.y=0,this.cv[k]?(this._shapes=ut(i,"shapes"),this._last=o):(F.push(this),this._shapes=ut(i,"shapes",[]),this.__cache=ut(i,"cache",document.createElement("canvas")),this._last=null,f.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.__cache),this.__cachectx=this.__cache&&this.__cache.getContext("2d"),this.calcCanvasPosition(),Y(i,"mousemove",B(this),!1),Y(i,"dblclick",vt(this),!1),Y(i,"click",$t(this),!1),Y(i,"mouseup",xt(this),!1),Y(i,"mousedown",Pt(this),!1),Y(v,"keydown",Et("keydown",this),!1),Y(v,"keyup",Et("keyup",this),!1),L||Y(v,"keypress",Et("keypress",this),!1),"onselectstart"in i&&(i.onselectstart=function(){return!1},i.onmousedown=function(){return!1}))},updateCache:function(){this.__cache&&(this.__cache.width=this.cv.width,this.__cache.height=this.cv.height,ht(this._shapes,d),this.draw(),this._shapes.push(d),this.__cachectx.drawImage(this.cv,0,0))},calcCanvasPosition:function(){return this._pos=yt(this.cv),this},get:function(i){return i=i<0?this._shapes.length+i:i,this._shapes[i]||this._shapes},getAll:function(i){let o=[],c=l.exec(i),w,x;return i==="*"?o=this._shapes.slice(0):c&&(w=c[1],x=c[2],U(this._shapes,function(W){W[w]===x&&o.push(W)})),o},remove:function(i){return Nt(ht(this._shapes,i)),this.redraw()},addId:function(i){let o=l.exec(i),c=this._last;return o&&!o[1]&&c&&(c.length?U(c,function(w){w["#"]=i}):c["#"]=i),this},removeId:function(){let i=this._last;return i&&!i.length?i["#"]="":U(i,function(o){o["#"]=""}),this},find:function(i){let o=this.getAll(i);return j(this.cv,o.length===1?o[0]:o)},attr:function(i,o){let c=this._last;return c&&c.attr?c.attr(i,o):U(c,function(w){w.attr(i,o)}),this},rotate:function(i){return this.attr({rotation:i})},translate:function(i,o){return this.attr({tx:i,ty:o})},scale:function(i,o){return this.attr({scaleX:i,scaleY:o})},skewX:function(i){return this.attr({skewX:i})},skewY:function(i){return this.attr({skewY:i})},zoomTo:function(i){return q(i,"number")&&(this.__zoom=i),this},zoomIn:function(){return this.zoomTo(this.__zoom+.1)},zoomOut:function(){return this.zoomTo(this.__zoom-.1)},setGlobalKeyEvents:function(i){return this.__globalkeyevents=!!i,this},bind:function(i,o,c){let w=c||this._last,x;if(!O&&"mouseover mouseout".indexOf(i)!==-1&&(O=!0),q(i,_)&&q(o,S))for(x in o)this[x](i,o[x]);else if(q(i,S))for(x in i)this[x](i[x]);else w&&!w.length?Ct(w,i,o):U(w,function(W){Ct(W,i,o)});return this},beforeDraw:function(i){return q(i,E)&&(this.__beforeDraw=i),this},afterDraw:function(i){return q(i,E)&&(this.__afterDraw=i),this},clear:function(i,o,c,w){return i=i||0,o=o||0,c=c||this.cv.width,w=w||this.cv.height,this.ctx.fillStyle=this.background,this.ctx.fillRect(i,o,c,w),this},draw:function(){let i,o=0,c=this._shapes;if(this.ctx.save(),j.__zoom=this.__zoom,this.__beforeDraw&&this.__beforeDraw.call(this,this),!R&&this.__cache&&C&&!this.play&&d)this.ctx.drawImage(this.__cache,0,0),d.draw(this.ctx);else for(;i=c[o++];)i.draw(this.ctx);return this.__afterDraw&&this.__afterDraw.call(this,this),j.__zoom=1,this.ctx.restore(),this},redraw:function(){return this.clear().draw()},frameCount:0,stop:function(){return delete this.play,this}},j.fn.init.prototype=j.prototype,j.addEventListener=Y;function zt(i,o){let c=l.exec(i);return function(w,x){(c&&this[c[1]]===c[2]||i==="*")&&o.call(this,w,x)}}return U("mousemove mouseover mouseout mousedown mouseup click dblclick focus blur tap".split(" "),function(i){j.fn[i]=function(o,c){let w;return q(c,E)&&(o=zt(o,c),w=this.cv),this.bind(i,o,w)}}),U("keydown keypress keyup".split(" "),function(i){j.fn[i]=function(o,c){return!c&&q(o,E)&&(c=o,o="any"),o=(o+"").toLowerCase(),this.bind(o,c,ut(this.cv,i))}}),L&&(j.fn.keypress=j.fn.keydown),j.fn.drag=function(i){let o,c,w,x,W=[],et,bt="Cevent-drag"+k,dt=this._last;if(q(i,_)&&(et=i,i=arguments[1]),i&&(o=i.start,c=i.move,w=i.end,x=i.afterMove),et)return this.mousedown(et,pt).mouseup(et,ct).mousemove(et,mt);dt&&!dt.length&&(dt=[dt]),U(dt,function(X){ut(X,bt)||(ut(X,bt,!0),W.push(X))}),j(this.cv,W).mousedown(pt).mouseup(ct).mousemove(mt);function pt(X,_t){(X.LEFT||I)&&(d=this,!X.play&&!R&&!C&&X.updateCache())}function mt(X,_t){if(this===d){if(!C){if(o&&o.call(this,X,_t)===!1)return d=C=null;C=!0}c&&c.call(this,X,_t),this.rmove(X.x-X.lastX,X.y-X.lastY),x&&x.call(this,X,_t)}}function ct(X,_t){this===d&&(d=C=null,w&&w.call(this,X,_t))}return this},j.registre=j.register=function(i,o){i=i.toLowerCase();let c=i.charAt(0).toUpperCase()+i.substring(1);this[c]=o,this.prototype[i]=function(){let w=o.apply(this,arguments);return w[""]=i,this._shapes.push(w),this._last=w,this}},Y(v,"mousedown",function(i){let o=i.target||i.srcElement;o=o.nodeName==="OBJECT"?o.parentNode:o,o[k]||(h=o)},!1),j.isTouchDevice=I,f.Cevent=j,j}const gt=ie(se(window,document)),H=function(f){const v={randint:function(_){return~~(Math.random()*_)}};"bind"in Function||(Function.prototype.bind=function(_){let y=this;return function(){return y.apply(_,arguments)}});let P=Gt.extend({init:function(_){this.elem=document.getElementById(_)}}),A=function(_,y,S){return document.addEventListener?function(O,F,M){O.addEventListener(F,M,!1)}:function(O,F,M){O.attachEvent("on"+F,function(I){return I=I||y,I.preventDefault=I.preventDefault||function(){this.returnValue=!1},I.stopPropagation=I.stopPropagation||function(){this.cancelBubble=!0},M.call(I.target||I.srcElement,I)})}}(),E="mousemove mouseover mouseout mousedown mouseup click touchstart dblclick focus blur submit change".split(" ");for(let _=0;_<E.length;_++){let y=E[_];P.prototype[y]=function(S){return function(O,F){typeof O=="function"?A(this.elem,S,O):A(this.elem,S,function(M){let I=M.target||M.srcElement;I.tagName.toLowerCase()===O&&(M.stopPropagation(),F.call(I,M))},!1)}}(y)}return v.fullScreen=function(){document.documentElement.scrollHeight<f.outerHeight/f.devicePixelRatio?(document.body.style.height=f.outerHeight/f.devicePixelRatio+1+"px",setTimeout(function(){f.scrollTo(1,1)},0)):f.scrollTo(1,1)},v.getContext=function(_){return!_.getContext&&f.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(_),_.getContext("2d")},v.extend=function(_,y){let S;for(S in y)y.hasOwnProperty(S)&&!(S in _)&&(_[S]=y[S]);return _},v.calcPieces=function(_,y){let S=_.image.width,O=_.image.height,F=document.getElementById("set-parts"),M,I;F.innerHTML="";for(let R=0;R<_.options.length;R+=1){let L=~~Math.sqrt(S*O/_.options[R]),Q=~~(S/L),ft=~~(O/L);for(;Q*ft<_.options[R];)L--,Q=~~(S/L),ft=~~(O/L);I!==Q*ft&&(I=Q*ft,M=document.createElement("option"),M.value=_.options[R],M.innerHTML=y(R),F.appendChild(M),_.options[R]===_.selected&&(M.selected=!0))}},v.addEvent=A,v.$=function(){let _=P();return function(y){return _.elem=document.getElementById(y),console.log(_),_}}(),v.getElement=function(_){return document.getElementById(_)},v.ajax=function(_){let y=new XMLHttpRequest;y.onreadystatechange=function(){y.readyState===XMLHttpRequest.DONE&&(y.status===200?_.success&&_.success(y.responseText):_.error&&_.error())},y.open("GET",_.url,!0),y.send()},f.Util=f.Util||v,v}(window),st=function(){};st.prototype.setMaxListeners=function(f){this._events||(this._events={}),this._events.maxListeners=f};Array.isArray=Array.isArray||function(f){return f.sort&&f.length&&f.slice};st.prototype.emit=function(f){if(f==="error"&&(!this._events||!this._events.error||Array.isArray(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;let v=this._events[f];if(!v)return!1;if(typeof v=="function"){switch(arguments.length){case 1:v.call(this);break;case 2:v.call(this,arguments[1]);break;case 3:v.call(this,arguments[1],arguments[2]);break;default:let P=Array.prototype.slice.call(arguments,1);v.apply(this,P)}return!0}if(Array.isArray(v)){let P=Array.prototype.slice.call(arguments,1),A=v.slice();for(let E=0,_=A.length;E<_;E++)A[E].apply(this,P);return!0}return!1};st.prototype.publish=st.prototype.emit,st.prototype.addListener=function(f,v){if(typeof v!="function")throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",f,v),!this._events[f])this._events[f]=v;else if(Array.isArray(this._events[f])){if(this._events[f].push(v),!this._events[f].warned){let P;this._events.maxListeners!==void 0?P=this._events.maxListeners:P=10,P&&P>0&&this._events[f].length>P&&(this._events[f].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[f].length),console.trace())}}else this._events[f]=[this._events[f],v];return this};st.prototype.on=st.prototype.subscribe=st.prototype.addListener,st.prototype.once=function(f,v){function P(){A.removeListener(f,P),v.apply(this,arguments)}if(typeof v!="function")throw new Error(".once only takes instances of Function");let A=this;return P.listener=v,A.on(f,P),this};st.prototype.removeListener=function(f,v){if(typeof v!="function")throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[f])return this;let P=this._events[f];if(Array.isArray(P)){let A=-1;for(let E=0,_=P.length;E<_;E++)if(P[E]===v||P[E].listener&&P[E].listener===v){A=E;break}if(A<0)return this;P.splice(A,1),P.length==0&&delete this._events[f]}else(P===v||P.listener&&P.listener===v)&&delete this._events[f];return this};st.prototype.unsubscribe=st.prototype.removeListener,st.prototype.removeAllListeners=function(f){return arguments.length===0?(this._events={},this):(f&&this._events&&this._events[f]&&(this._events[f]=null),this)};st.prototype.listeners=function(f){return this._events||(this._events={}),this._events[f]||(this._events[f]=[]),Array.isArray(this._events[f])||(this._events[f]=[this._events[f]]),this._events[f]};st.mixin=function(f){for(let v in st.prototype)f.prototype[v]||(f.prototype[v]=st.prototype[v])};const ne=[3,20,50,75,100],re=["очень легко","легко","сложно","очень сложно","эксперт"];function oe(f){return re[f]}function it(){return window.devicePixelRatio||1}(function(f,v,P){let A=H.getContext(f.createElement("canvas")),E=Math.abs,_=Math.PI/180,y=H.getContext(f.createElement("canvas")),S=navigator.userAgent,O=S.match(/android/i),F=S.match(/iphone|ipad|ipod/i),M=S.match(/Windows Phone/i)||S.match(/iemobile/i),I=!O&&!F&&!M,R=20;function L(l,r){if(l.rotation%360||r.rotation%360||r.hide||l.hide||l.row!=r.row&&l.col!=r.col)return;let u=l.tx-r.tx,h=l.ty-r.ty,d=l.col-r.col,C=l.row-r.row,k=l.width,z=l.height;if(l.size,(d==-1&&u<0&&E(u+k)<R||d==1&&u>=0&&E(u-k)<R)&&h<=R&&h>=-20)return[l.col>r.col?-E(u)+k:E(u)-k,r.ty-l.ty];if((C==-1&&h<0&&E(h+z)<R||C==1&&h>=0&&E(h-z)<R)&&u<=R&&u>=-20)return[r.tx-l.tx,l.row>r.row?-E(h)+z:E(h)-z]}let Q=gt.Shape.extend({type:"piece",init:function(l,r,u,h,d,C,k){this.flat=k,this._super(l,r),this.img=u,this.originalImg=u,this.size=Math.max(h,d),this.width=h,this.height=d,this.diagonal=~~Math.sqrt(h*h+d*d),this.edges=C,this.lastRotation=0,this.size/2,this.tx=this.x+this.width/2,this.ty=this.y+this.height/2,this.x=-this.width/2,this.y=-this.height/2},draw_path:function(l){let r=this.size,u,h=0;for(l.beginPath(),l.moveTo(this.x,this.y);h<4;h++){u=this.edges[h],r=h%2?this.height:this.width;let d=h%2?this.height:this.width,C=h%2?this.width:this.height,k=h%2?this.y:this.x,z=h%2?this.x:this.y;u?this[u](l,d,C,k,z):l.lineTo(k+r,z),l.rotate(Math.PI/2)}l.closePath()},render:function(l,r){l=l||this.ox||0,r=r||this.oy||0,this.originalTX=this.originalTX||this.tx,this.originalTY=this.originalTY||this.ty;let u=this.ctx||H.getContext(f.createElement("canvas")),h=this.size+.5;y.canvas.width=u.canvas.width=h*2,y.canvas.height=u.canvas.height=h*2,y.save(),u.save(),this.applyStyle(u),y.lineWidth=.5,u.lineWidth=.5,u.translate(this.width,this.height),u.rotate(this.rotation*_),y.translate(this.width,this.height),y.rotate(this.rotation*_),this.draw_path(u),this.draw_path(y),u.fill(),y.drawImage(this.originalImg,-this.originalTX-l,-this.originalTY-r),this.stroke&&(y.globalCompositeOperation="lighter",y.shadowOffsetY=1.5,y.shadowOffsetX=1.5,y.shadowBlur=0,y.shadowColor="rgba(255, 255, 255, .4)",y.lineWidth=1.5,y.strokeStyle="rgba(0, 0, 0, .4)",y.stroke(),y.globalCompositeOperation="darken",y.shadowBlur=1,y.shadowOffsetY=-1,y.shadowOffsetX=-1,y.shadowBlur=2,y.shadowColor="rgba(0, 0, 0, .2)",y.lineWidth=2,y.strokeStyle="rgba(0, 0, 0, .4)",y.stroke(),y.clip()),y.restore(),u.restore(),u.globalCompositeOperation="source-in",u.globalCompositeOperation!=="source-in"&&(u.globalCompositeOperation="source-atop"),u.drawImage(y.canvas,0,0),this.ctx||(this.tx+=this.offset),this.img=u.canvas,this.ctx=u,this.ox=l,this.oy=r},outside:function(l,r,u,h,d){if(this.flat)return l.lineTo(h+r,d);l.lineTo(h+r*.34,d),l.bezierCurveTo(h+r*.5,d,h+r*.4,d+u*-.15,h+r*.4,d+u*-.15),l.bezierCurveTo(h+r*.3,d+u*-.3,h+r*.5,d+u*-.3,h+r*.5,d+u*-.3),l.bezierCurveTo(h+r*.7,d+u*-.3,h+r*.6,d+u*-.15,h+r*.6,d+u*-.15),l.bezierCurveTo(h+r*.5,d,h+r*.65,d,h+r*.65,d),l.lineTo(h+r,d)},inside:function(l,r,u,h,d){if(this.flat)return l.lineTo(h+r,d);l.lineTo(h+r*.35,d),l.bezierCurveTo(h+r*.505,d+.05,h+r*.405,d+u*.155,h+r*.405,d+u*.1505),l.bezierCurveTo(h+r*.3,d+u*.3,h+r*.5,d+u*.3,h+r*.5,d+u*.3),l.bezierCurveTo(h+r*.7,d+u*.29,h+r*.6,d+u*.15,h+r*.6,d+u*.15),l.bezierCurveTo(h+r*.5,d,h+r*.65,d,h+r*.65,d),l.lineTo(h+r,d)},draw:function(l){let r=this.x-this.width/2-.5,u=this.y-this.height/2-.5;if(I){this.setTransform(l),l.drawImage(this.img,r,u);return}this.rotation!==this.lastRotation&&(this.render(),this.lastRotation=this.rotation),l.drawImage(this.img,r+this.tx,u+this.ty)},check:function(l){let r;if(l.type==="piece")r=L(this,l);else{let u,h=l.pieces.length;for(u=0;u<h&&!(r=L(this,l.pieces[u]));u++);}return r&&this.rmove(r[0],r[1]),r},hitTest:function(l){if(!this.hide)return this.setTransform(A),this.draw_path(A),A.isPointInPath(l.x*it(),l.y*it())}}),ft=gt.Shape.extend({type:"group",init:function(){this.pieces=[],this._super(0,0)},draw:function(l){if(this.hide)return;let r,u=this.pieces.length;for(r=0;r<u;r++)this.pieces[r].draw(l)},hitTest:function(l){let r,u=this.pieces.length;for(r=0;r<u;r++)if(this.pieces[r].hitTest(l))return!0},check:function(l){let r,u=this.pieces.length,h;if(l.type==="piece"){for(r=0;r<u;r++)if(h=L(this.pieces[r],l))return this.rmove(h[0],h[1]),!0}else{let d,C=l.pieces.length;for(r=0;r<u;r++)for(d=0;d<C;d++)if(h=L(this.pieces[r],l.pieces[d]))return this.rmove(h[0],h[1]),!0}},rmove:function(l,r){let u,h=this.pieces.length;for(u=0;u<h;u++)this.pieces[u].rmove(l,r);this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty},add:function(){this.pieces=this.pieces.concat.apply(this.pieces,arguments),this.minPieceX=b(this.pieces,"tx"),this.minPieceY=b(this.pieces,"ty"),this.width=$(this.pieces,"tx").tx-this.minPieceX.tx,this.height=$(this.pieces,"ty").ty-this.minPieceY.ty,this.width+=this.pieces[0].width,this.height+=this.pieces[0].height,this.x=this.pieces[0].x,this.y=this.pieces[0].y,this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty}});function $(l,r){let u=l[0][r],h=0;for(let d=1;d<l.length;d++)l[d][r]>u&&(u=l[d][r],h=d);return l[h]}function b(l,r){let u=l[0][r],h=0;for(let d=1;d<l.length;d++)l[d][r]<u&&(u=l[d][r],h=d);return l[h]}gt.register("group",ft),gt.register("piece",Q)})(document);const Ht=function(f,v,P){let A="inside",E="outside",_=null,y,S=[A,E],O=0,F={spread:.7,offsetTop:v.innerHeight*.2,maxWidth:v.innerWidth*.8,maxHeight:v.innerHeight*.6,defaultImage:"images/default-puzzle.jpg",piecesNumberTmpl:"%d Pieces",redirect:"",border:!0,defaultPieces:3,shuffled:!1,rotatePieces:!0,numberOfPieces:ne,squarePieces:!1},M=45,I=it();function R(){return S[H.randint(2)]}let L={};L.Jigsaw=Gt.extend({init:function($){let b=new st,l=this;this.container=f.body,this.opts=$=H.extend($||{},F),this.max_width=$.maxWidth,this.max_height=$.maxHeight,H.$("redirect-form").action=$.redirect,y=$.defaultImage,this.eventBus=b,this.ce=new gt("canvas"),this.ui=new L.UI(b,$.defaultPieces||10),this.tmp_img=f.createElement("img"),this.img=f.getElementById("image"),this.ctx=H.getContext(this.img),this.preview=f.getElementById("image-preview"),this.previewCtx=H.getContext(this.preview),this.parts=$.defaultPieces||10,this.tmp_img.onload=function(){l.original=this,l.draw_image(this),H.calcPieces({image:l.img,template:l.opts.piecesNumberTmpl,selected:l.parts,options:l.opts.numberOfPieces},oe),l.render()},this.tmp_img.onerror=function(){y&&l.set_image(y)},Q(this.ce,b,this.opts.rotatePieces),b.on(L.Events.JIGSAW_COMPLETE,function(){l.ui.stop_clock(),$.redirect?l.redirect():l.ui.show_time()}),$.shuffled&&b.on(L.Events.RENDER_FINISH,this.start_game.bind(this)),b.on(L.Events.PARTS_NUMBER_CHANGED,this.set_parts.bind(this)),b.on(L.Events.RENDER_REQUEST,this.render.bind(this)),b.on(L.Events.START_GAME,this.start_game.bind(this)),b.on(L.Events.JIGSAW_SET_IMAGE,this.set_image.bind(this)),H.addEvent(v,"resize",this.resize.bind(this)),this.resize(),this.set_image()},resize:function(){console.log(1);let b=this.ce.cv,l=this.width(),r=this.height()-M;b.width=l*it(),b.height=r*it(),b.style.width=l+"px",b.style.height=r+"px",this.ce.redraw(),gt.isTouchDevice&&H.fullScreen()},redirect:function(){H.$("t").value=this.ui.time(),H.$("p").value=this.parts,H.$("redirect-form").submit()},set_parts:function($){this.parts=$},set_image:function($){this.ce.cv.className="loading",this.tmp_img.src=$||y},width:function(){return this.container.offsetWidth},height:function(){return this.container.offsetHeight},draw_image:function($,b,l){let r=b||this.max_width*it(),u=l||this.max_height*it(),h,d,C=this.ctx;if(r>this.width()||u>this.height()-M){let k=Math.min(this.width()/r,(this.height()-M)/u);r*=k,u*=k}if($.width>r||$.height>u){let k=Math.min(r/$.width,u/$.height);h=~~($.width*k)*it(),d=~~($.height*k)*it(),C.canvas.width=h,C.canvas.height=d,C.drawImage($,0,0,$.width,$.height,0,0,h,d)}else C.canvas.width=$.width*it(),C.canvas.height=$.height*it(),C.drawImage($,0,0,$.width,$.height,0,0,C.canvas.width,C.canvas.height)},clear:function(){this.ce._shapes=[]},start_game:function(){let $=this.ce.getAll("piece");if(this.__pieces)this.ce._shapes=$=this.__pieces.slice(0);else return;this.ce.clear();let b,l=$.length,r;$[0].size;let u=this.opts.spread,h=this.width()*it(),d=(this.height()-M)*it(),C=h*u,k=d*u,z=~~((h-C)/2),Z=~~((d-k)/2);for(b=0;b<l;b++)r=$[b],r.tx=H.randint(C)+r.tx%1+z,r.ty=H.randint(k)+r.tx%1+Z,this.opts.rotatePieces&&(r.rotation=H.randint(4)*90);this.opts.shuffled&&(this.ce.cv.className="",this.ui.init_clock()),H.getElement("START_GAME").style.display="none",this.ce.find("*").attr({hide:!1}),this.ce.shuffled=!0,this.ce.redraw()},render:function(){this.opts.shuffled?(this.ce.cv.className="loading",this.ce.clear(),this.ui.stop_clock()):this.ce.cv.className="",H.getElement("START_GAME").style.display=null,this.ce.shuffled=!1;let $,b,l,r,u=[],h=[],d=this.img.width,C=this.img.height,k=~~Math.sqrt(d*C/this.parts),z=~~(d/k),Z=~~(C/k),q=0,U=0,ht=++O,lt;for(this.flag=ht;z*Z<this.parts;)k--,z=~~(d/k),Z=~~(C/k);let N=~~(d/z),D=~~(C/Z);N=N%2?N:N-1,D=D%2?D:D-1,lt=~~(this.width()/2*it()-N*z/2),this.clear();let nt=~~((d-z*N)/2),Y=~~((C-Z*D)/2);nt=nt>=0?nt:0,Y=Y>=0?Y:0,this.preview.style.marginTop=this.opts.offsetTop+"px",this.preview.width=N*z,this.preview.height=D*Z,this.preview.style.width=this.preview.width/it()+"px",this.preview.style.height=this.preview.height/it()+"px",this.previewCtx.globalAlpha=.3,this.previewCtx.drawImage(this.img,nt,Y,N*z,D*Z,0,0,N*z,D*Z),(function rt(){q<z&&ht===this.flag?(U<Z?($=U===0?_:l===A?E:A,b=q===z-1?_:R(),l=U===Z-1?_:R(),r=q===0?0:h[U]===A?E:A,this.ce.piece(N*q,D*U+this.opts.offsetTop,v.G_vmlCanvasManager?this.tmp_img:this.img,N,D,[$,b,l,r],this.opts.squarePieces).attr({col:q,row:U,offset:lt,stroke:this.opts.border?"black":""}).get(-1).render(nt,Y-this.opts.offsetTop),this.opts.shuffled||this.ce.redraw(),u.push(b),U++):(q++,U=0,h=u,u=[]),setTimeout(rt.bind(this),20)):this.flag===ht&&(this.__pieces=this.ce.get().slice(0),this.ce.redraw(),this.eventBus.emit(L.Events.RENDER_FINISH))}).bind(this)()}}),L.Events={PARTS_NUMBER_CHANGED:"PartsNumberChanged",RENDER_REQUEST:"RenderRequestEvent",RENDER_FINISH:"RenderFinishEvent",JIGSAW_RENDERED:"JigsawRenderedEvent",JIGSAW_SET_IMAGE:"JigsawSetImageEvent",START_GAME:"JigsawGameStartEvent",SHOW_PREVIEW:"JigsawShowPreview",JIGSAW_COMPLETE:"JigsawCompleteEvent",PIECES_CONNECTED:"PieceConnectedEvent",ZOOM_IN:"JigsawZoomIn",ZOOM_OUT:"JigsawZoomOut"},L.GET=function(){if(location.query)return;let $=location.search.replace(/^[?]/,"").split("&"),b=0,l=$.length,r={};for(;b<l;b++){if(!$[b])continue;let u=$[b].split("=");r[unescape(u[0])]=unescape(u[1])}return r},L.UI=Gt.extend({init:function($,b){this.eventBus=$,this.clock=H.getElement("clock"),ft(this,$),$.on(L.Events.START_GAME,this.init_clock.bind(this)),$.on(L.Events.SHOW_PREVIEW,this.show_preview.bind(this))},stop_clock:function(){O++},init_clock:function(){let $=this;this.ini=new Date().getTime(),this.uuid=O,function b(){console.log($.uuid,O,$.time()),$.uuid===O&&($.clock.innerHTML=$.time(),setTimeout(b,1e3))}()},show_preview:function(){let $=H.getElement("image-preview");$.className=$.className==="show"?"hide":"show",$.style.marginLeft=-($.width/2/I)+"px"},show_time:function(){this.show_modal("congrat"),H.getElement("START_GAME").style.display=null,H.getElement("time").innerHTML=this.clock.innerHTML},time:function(){let $=~~((new Date().getTime()-this.ini)/1e3),b=$%60,l=~~($/60),r=~~(l/60);return l%=60,(r>9?r:"0"+r)+":"+(l>9?l:"0"+l%60)+":"+(b>9?b:"0"+b)},show_modal:function($){Bt.Modal.open($)}});function Q($,b,l){$.drag("*",{start:function(r,u){r.cv.style.cursor="move",r.lastX*=it(),r.lastY*=it(),this.handleX=r.lastX-this.tx,this.handleY=r.lastY-this.ty},move:function(r,u){r.x*=it(),r.y*=it(),r.x+=r.lastX-this.tx-this.handleX,r.y+=r.lastY-this.ty-this.handleY},afterMove:function(r,u){let h=~~(this.width/2),d=~~(this.height/2),C=this.x+this.tx+h,k=this.y+this.ty+d,z=r.cv.width,Z=r.cv.height;this.rotation/45%2&&(h=this.diagonal/2,d=this.diagonal/2);let q=0,U=0;C-h<0?q=C-h:C+h>z&&(q=C+h-z),k-d<0?U=k-d:k+d>Z&&(U=k+d-Z),this.rmove(-q,-U)},end:function(r,u){if(r.cv.style.cursor="default",!r.shuffled)return;let h=r.getAll("piece").concat(r.getAll("group")),d=0,C=h.length,k=this;for(;d<C;d++)h[d]!==this&&k.check(h[d])&&(r.remove(k),r.remove(h[d]),r._curHover=r.group().get(-1),r._curHover.add(k.pieces||k,h[d].pieces||h[d]),k=r._curHover,r.focused=null);this!==k&&b.emit(L.Events.PIECES_CONNECTED),!$.getAll("piece").length&&$.getAll("group").length===1&&$.shuffled&&($.shuffled=!1,b.emit(L.Events.JIGSAW_COMPLETE)),k.type==="group"&&(r.remove(k),r._shapes.unshift(k))}}).focus("*",function(r,u){r.remove(this),r._shapes.push(this)}),H.addEvent($.cv,"contextmenu",function(r){l&&$.focused&&($.focused.rotation=($.focused.rotation+45)%360,$.redraw()),r.preventDefault()}),l&&($.keydown("right",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation+45)%360),!1}).keydown("left",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation-45)%360),!1}),$.tap("*",function(r,u){gt.isTouchDevice&&$.focused&&($.focused.rotation=($.focused.rotation+45)%360,$.redraw())}))}function ft($,b){function l(h){let d=h[0];if(!d.type.match(/image.*/)){H.getElement("image-error").style.display="block";return}let C=new FileReader;C.onloadend=function(k){b.emit(L.Events.JIGSAW_SET_IMAGE,this.result),r()},C.readAsDataURL(d)}v.FileReader&&new FileReader().onload===null&&(H.getElement("create-puzzle").classList.remove("hide"),H.$("image-input").change(function(){l(this.files)}),"ondragenter"in v&&"ondrop"in v&&(H.getElement("dnd").style.display="block",f.addEventListener("dragenter",function(h){return h.stopPropagation(),h.preventDefault(),!1},!1),f.addEventListener("dragover",function(h){return h.stopPropagation(),h.preventDefault(),!1},!1),f.addEventListener("drop",function(h){h.stopPropagation(),h.preventDefault();let d=h.dataTransfer;l(d.files)},!1)));function r(){return Bt.Modal.close(),!1}function u(h){return console.log(h),h}Array.from(f.querySelectorAll(".app-slider-selector")).forEach(function(h){H.addEvent(h,"click",function(d){b.emit(L.Events.JIGSAW_SET_IMAGE,d.target.src)})}),H.$("set-parts").change(function(){b.emit(L.Events.PARTS_NUMBER_CHANGED,u(this.value)),b.emit(L.Events.RENDER_REQUEST)}),H.$("set-preview").change(function(){b.emit(L.Events.SHOW_PREVIEW)}),gt.addEventListener("game-options","mousedown",function(h){let d=h.target||h.srcElement;L.Events[d.id]&&(h.preventDefault(),b.emit(L.Events[d.id]))})}return st.mixin(L.Jigsaw),L}(document,window),Bt=function(){let f=0,v=window.Audio&&new Audio().canPlayType,P=0,A=function(I){return document.getElementById(I)},E,_,y;function S(){E=A("modal-window"),_=A("modal-window-close"),y=A("overlay");let I=gt.isTouchDevice?"touchstart":"click";gt.addEventListener(y,I,F),gt.addEventListener(_,I,F)}function O(){E||S(),E.className="modal",y.className=""}function F(I){return I&&I.preventDefault(),E.className="modal hide",y.className="hide",!1}function M(I,R){if(!v)return;let L;for(this.file=I,P=R,this.audio=[],L=0;L<R;L++)this.audio[L]=new Audio;const Q=(function(){document.removeEventListener("touchstart",Q),document.removeEventListener("mousedown",Q),this.load()}).bind(this);document.addEventListener("touchstart",Q),document.addEventListener("mousedown",Q)}return M.prototype.load=function(){if(!v||this._loaded)return;this._loaded=!0;const I=this.audio[0].canPlayType("audio/mp3")?".mp3":".wav";for(let R=0;R<P;R++)this.audio[R].src=this.file+I,this.audio[R].volume=0,this.audio[R].load()},M.prototype.play=function(){v&&(this.audio[f].volume=1,this.audio[f].play(),f=(f+1)%P)},{Sound:M,Modal:{open:O,close:F}}}(),Yt=(()=>{const f="app-slider-panel__animation-init",v="app-slider-panel__expanded",P="app-slider-ov",A="expanded";let E=null,_=[];return{isReadyToUse(){return E!=null},init:function(){if(_=Array.from(document.querySelectorAll(".js-sidebar-open")),E=document.querySelector(".app-slider-panel"),!Yt.isReadyToUse())throw new Error("SliderPanel: elements to init not found");setTimeout(()=>{E.classList.add(f)},0),_.forEach(y=>{y.addEventListener("click",()=>Yt.toggle())}),document.addEventListener("click",y=>{!E.contains(y.target)&&_.every(S=>!S.contains(y.target))&&E.classList.contains(A)&&Yt.toggle()})},toggle:function(){const y=!E.classList.contains(A);E.classList.toggle(A,y),_.forEach(S=>S.classList.toggle("active",y)),document.body.classList.toggle(v,y),matchMedia&&matchMedia("(max-width: 767px)").matches&&document.documentElement.classList.toggle(P,y)}}})();window.addEventListener("DOMContentLoaded",function(){new Yt.init("#sidebar-panel");const f=new Bt.Sound("click",10),v=new Ht.Jigsaw({defaultImage:"./default-puzzle.jpg",piecesNumberTmpl:"%d Pieces",defaultPieces:3});v.eventBus.on(Ht.Events.PIECES_CONNECTED,function(){f.play()}),Ht.GET.image&&v.set_image(Ht.GET.image)});document.addEventListener("ontouchmove",function(v){v.preventDefault()})});export default ae();
