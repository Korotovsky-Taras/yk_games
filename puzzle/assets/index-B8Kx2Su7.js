var ee=(f,$)=>()=>($||f(($={exports:{}}).exports,$),$.exports);var ae=ee((le,Wt)=>{(function(){const $=document.createElement("link").relList;if($&&$.supports&&$.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))k(y);new MutationObserver(y=>{for(const _ of y)if(_.type==="childList")for(const E of _.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&k(E)}).observe(document,{childList:!0,subtree:!0});function S(y){const _={};return y.integrity&&(_.integrity=y.integrity),y.referrerPolicy&&(_.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?_.credentials="include":y.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function k(y){if(y.ep)return;y.ep=!0;const _=S(y);fetch(y.href,_)}})();/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   3.2.2+39aa2571
 */(function(){function f(t){return typeof t=="function"||typeof t=="object"&&t!==null}function $(t){return typeof t=="function"}var S;Array.isArray?S=Array.isArray:S=function(t){return Object.prototype.toString.call(t)==="[object Array]"};var k=S,y=0,_,E,x=function(n,o){h[y]=n,h[y+1]=o,y+=2,y===2&&(E?E(l):P())};function L(t){E=t}function W(t){x=t}var O=typeof window<"u"?window:void 0,N=O||{},A=N.MutationObserver||N.WebKitMutationObserver,tt=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",Z=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function m(){return function(){process.nextTick(l)}}function b(){return function(){_(l)}}function C(){var t=0,n=new A(l),o=document.createTextNode("");return n.observe(o,{characterData:!0}),function(){o.data=t=++t%2}}function a(){var t=new MessageChannel;return t.port1.onmessage=l,function(){t.port2.postMessage(0)}}function u(){return function(){setTimeout(l,1)}}var h=new Array(1e3);function l(){for(var t=0;t<y;t+=2){var n=h[t],o=h[t+1];n(o),h[t]=void 0,h[t+1]=void 0}y=0}function g(){try{var t=require,n=t("vertx");return _=n.runOnLoop||n.runOnContext,b()}catch{return u()}}var P;tt?P=m():A?P=C():Z?P=a():O===void 0&&typeof require=="function"?P=g():P=u();function M(t,n){var o=this,d=new this.constructor(ft);d[it]===void 0&&c(d);var p=o._state;if(p){var v=arguments[p-1];x(function(){B(p,d,v,o._result)})}else Pt(o,d,t,n);return d}var z=M;function st(t){var n=this;if(t&&typeof t=="object"&&t.constructor===n)return t;var o=new n(ft);return K(o,t),o}var X=st,it=Math.random().toString(36).substring(16);function ft(){}var V=void 0,R=1,F=2,ot=new vt;function q(){return new TypeError("You cannot resolve a promise with itself")}function lt(){return new TypeError("A promises callback cannot return that same promise.")}function yt(t){try{return t.then}catch(n){return ot.error=n,ot}}function ut(t,n,o,d){try{t.call(n,o,d)}catch(p){return p}}function zt(t,n,o){x(function(d){var p=!1,v=ut(o,n,function(T){p||(p=!0,n!==T?K(d,T):J(d,T))},function(T){p||(p=!0,U(d,T))},"Settle: "+(d._label||" unknown promise"));!p&&v&&(p=!0,U(d,v))},t)}function Ct(t,n){n._state===R?J(t,n._result):n._state===F?U(t,n._result):Pt(n,void 0,function(o){K(t,o)},function(o){U(t,o)})}function wt(t,n,o){n.constructor===t.constructor&&o===z&&constructor.resolve===X?Ct(t,n):o===ot?U(t,ot.error):o===void 0?J(t,n):$(o)?zt(t,n,o):J(t,n)}function K(t,n){t===n?U(t,q()):f(n)?wt(t,n,yt(n)):J(t,n)}function Q(t){t._onerror&&t._onerror(t._result),At(t)}function J(t,n){t._state===V&&(t._result=n,t._state=R,t._subscribers.length!==0&&x(At,t))}function U(t,n){t._state===V&&(t._state=F,t._result=n,x(Q,t))}function Pt(t,n,o,d){var p=t._subscribers,v=p.length;t._onerror=null,p[v]=n,p[v+R]=o,p[v+F]=d,v===0&&t._state&&x(At,t)}function At(t){var n=t._subscribers,o=t._state;if(n.length!==0){for(var d,p,v=t._result,T=0;T<n.length;T+=3)d=n[T],p=n[T+o],d?B(o,d,p,v):p(v);t._subscribers.length=0}}function vt(){this.error=null}var $t=new vt;function Et(t,n){try{return t(n)}catch(o){return $t.error=o,$t}}function B(t,n,o,d){var p=$(o),v,T,D,j;if(p){if(v=Et(o,d),v===$t?(j=!0,T=v.error,v=null):D=!0,n===v){U(n,lt());return}}else v=d,D=!0;n._state!==V||(p&&D?K(n,v):j?U(n,T):t===R?J(n,v):t===F&&U(n,v))}function Ht(t,n){try{n(function(d){K(t,d)},function(d){U(t,d)})}catch(o){U(t,o)}}var i=0;function r(){return i++}function c(t){t[it]=i++,t._state=void 0,t._result=void 0,t._subscribers=[]}function w(t){return new _t(this,t).promise}var I=w;function Y(t){var n=this;return k(t)?new n(function(o,d){for(var p=t.length,v=0;v<p;v++)n.resolve(t[v]).then(o,d)}):new n(function(o,d){d(new TypeError("You must pass an array to race."))})}var et=Y;function bt(t){var n=this,o=new n(ft);return U(o,t),o}var dt=bt;function pt(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function gt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ct=H;function H(t){this[it]=r(),this._result=this._state=void 0,this._subscribers=[],ft!==t&&(typeof t!="function"&&pt(),this instanceof H?Ht(this,t):gt())}H.all=I,H.race=et,H.resolve=X,H.reject=dt,H._setScheduler=L,H._setAsap=W,H._asap=x,H.prototype={constructor:H,then:z,catch:function(t){return this.then(null,t)}};var _t=St;function St(t,n){this._instanceConstructor=t,this.promise=new t(ft),this.promise[it]||c(this.promise),k(n)?(this._input=n,this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),this.length===0?J(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&J(this.promise,this._result))):U(this.promise,Ft())}function Ft(){return new Error("Array Methods must be provided an Array")}St.prototype._enumerate=function(){for(var t=this.length,n=this._input,o=0;this._state===V&&o<t;o++)this._eachEntry(n[o],o)},St.prototype._eachEntry=function(t,n){var o=this._instanceConstructor,d=o.resolve;if(d===X){var p=yt(t);if(p===z&&t._state!==V)this._settledAt(t._state,n,t._result);else if(typeof p!="function")this._remaining--,this._result[n]=t;else if(o===ct){var v=new o(ft);wt(v,t,p),this._willSettleAt(v,n)}else this._willSettleAt(new o(function(T){T(t)}),n)}else this._willSettleAt(d(t),n)},St.prototype._settledAt=function(t,n,o){var d=this.promise;d._state===V&&(this._remaining--,t===F?U(d,o):this._result[n]=o),this._remaining===0&&J(d,this._result)},St.prototype._willSettleAt=function(t,n){var o=this;Pt(t,void 0,function(d){o._settledAt(R,n,d)},function(d){o._settledAt(F,n,d)})};function e(){var t;if(typeof global<"u")t=global;else if(typeof self<"u")t=self;else try{t=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;n&&Object.prototype.toString.call(n.resolve())==="[object Promise]"&&!n.cast||(t.Promise=ct)}var s=e;ct.Promise=ct,ct.polyfill=s,typeof define=="function"&&define.amd?define(function(){return ct}):typeof Wt<"u"&&Wt.exports?Wt.exports=ct:typeof this<"u"&&(this.Promise=ct),s()}).call(void 0);let Bt=!1;function Xt(){}Xt.extend=function(f){const $=this.prototype;let S;Bt=!0,S=new this,Bt=!1;for(let y in f)typeof f[y]=="function"&&typeof $[y]=="function"?S[y]=function(_,E){return function(){const x=this._super;this._super=$[_];const L=E.apply(this,arguments);return this._super=x,L}}(y,f[y]):S[y]=f[y];function k(){if(this instanceof k)!Bt&&this.init&&this.init.apply(this,arguments);else return new k(...arguments)}return k.prototype=S,k.prototype.constructor=k,k.extend=this.extend,k};function ie(f){let $=Math,S=$.PI,k=2*S,y=S/180,_=$.sqrt,E=$.pow,x=$.cos,L=$.sin,W=$.round,O=$.abs,N=$.acos,A,tt=Object.prototype.hasOwnProperty,Z=Array.prototype.slice,m={tx:0,ty:0,scaleX:1,scaleY:1,skewX:0,skewY:0,fill:"#000",stroke:"",lineWidth:1,lineJoin:"miter",lineCap:"butt",alpha:1,rotation:0,composite:"source-over",shadowColor:"rgba(0, 0, 0, 0.0)",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,fontStyle:"normal",fontWeight:"normal",fontSize:10,fontFamily:"Arial"},b=document.createElement("canvas"),C=b.getContext&&b.getContext("2d"),a=function(e,s){return _(E(e.x-s.x,2)+E(e.y-s.y,2))},u=function(e,s,t,n,o){let d=t-e,p=n-s,v={},T;if(!(d===0&&p===0))return T=((o.x-e)*d+(o.y-s)*p)/(d*d+p*p),T<0?v={x:e,y:s}:T>1?v={x:t,y:t}:v={x:e+T*d,y:s+T*p},a(v,o)},h=function(e,s,t){return t=y*t,{x:e*x(t)-s*L(t),y:e*L(t)+s*x(t)}},l=function(e,s){let t;for(t in s)tt.call(s,t)&&(e[t]=s[t])},g=Xt.extend({init:function(e,s){this.x=e||0,this.y=s||0,l(this,m)},position:function(){let e=h(this.x*this.scaleX,this.y*this.scaleY,this.rotation);return{x:e.x+this.tx,y:e.y+this.ty}},rmove:function(e,s){this.tx+=e,this.ty+=s},attr:function(e,s){let t;if(typeof e=="string")this[e]=s;else for(t in e)this[t]=e[t];return this},applyStyle:function(e){let s=this.shadowBlur,t=this.shadowOffsetX,n=this.shadowOffsetY;e.fillStyle=this.fill,e.globalAlpha=this.alpha,e.globalCompositeOperation=this.composite,this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.lineWidth),(t||n||s)&&(e.shadowColor=this.shadowColor,e.shadowOffsetX=t,e.shadowOffsetY=n,e.shadowBlur=s)},setTransform:function(e){let s=f.__zoom,t=this.scaleX*s,n=this.scaleY*s,o=this.skewX*s,d=this.skewY*s,p=this.rotation*y,v=L(p),T=x(p),D=this.tx*s,j=this.ty*s,at=T*t-v*d,ht=T*o-v*n,Tt=v*t+T*d,xt=v*o+T*n;e.setTransform(at,Tt,ht,xt,D,j)},draw:function(e){throw new Error("El método draw no se ha implementado")},fill_or_stroke:function(e){this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(C&&C.isPointInPath)return this.draw(C),C.setTransform(1,0,0,1,0,0),C.isPointInPath(e.x,e.y);throw Error("Método isPointInPath no soportado: Necesita FlashCanvasPro")}}),P=g.extend({init:function(e,s,t,n,o){this.r=o||0,this.w=t||5,this.h=n||t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y,n=this.w,o=this.h;this.applyStyle(e),this.setTransform(e),e.beginPath(),this.r?f.setContext(e).polygon(s,t,s+n,t,s+n,t+o,s,t+o,this.r):e.rect(s,t,W(n),W(o)),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.r)return this._super(e);let s=this.position(),t=h(e.x-s.x,e.y-s.y,-this.rotation);return t.x>=0&&t.x<=this.w*this.scaleX&&t.y>=0&&t.y<=this.h*this.scaleY}}),M=P.extend({init:function(e,s,t){this.setText(t),this._super(e,s,this.w,this.h)},applyStyle:function(e){e.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.h=this.fontSize,this.w=e.measureText(this.text).width,this._super(e)},setText:function(e){this.text=e+""},draw:function(e){this.applyStyle(e),this.setTransform(e),this.fill&&e.fillText(this.text,this.x,this.y+this.h),this.stroke&&e.strokeText(this.text,this.x,this.y+this.h)},hitTest:function(e){return this.skewX||this.skewY&&C&&C.isPointInPath?(this.setTransform(C),C.beginPath(),C.rect(this.x,this.y,this.w,this.h),C.closePath(),C.isPointInPath(e.x,e.y)):this._super(e)}}),z={},st=P.extend({init:function(e,s,t){this.setImg(t),this._super(e,s,this.img.width,this.img.height)},setImg:function(e){if(z[e]){this.img=z[e],this.src=this.img.src;return}e.nodeName=="IMG"?this.img=e:(e+="",this.img=z[e]=new Image,this.img.src=e),this.img.onload=function(){f.forse_redraw()},this.src=this.img.src},draw:function(e){let s=this.x,t=this.y;this.w=this.img.width,this.h=this.img.height,this.applyStyle(e),this.setTransform(e),e===C?(e.beginPath(),e.rect(s,t,W(this.w),W(this.h)),e.closePath()):e.drawImage(this.img,s,t)}}),X=P.extend({draw:function(e){let s=this.x,t=this.y,n=this.w,o=this.h,d=.5522847498307933,p=d*n,v=d*o;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(s+n,t),e.bezierCurveTo(s+n,t-v,s+p,t-o,s,t-o),e.bezierCurveTo(s-p,t-o,s-n,t-v,s-n,t),e.bezierCurveTo(s-n,t+v,s-p,t+o,s,t+o),e.bezierCurveTo(s+p,t+o,s+n,t+v,s+n,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:g.prototype.hitTest}),it=g.extend({init:function(e,s,t,n,o,d){this.clockwise=d,this.endAngle=o,this.startAngle=n,this.r=t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,W(this.r),this.startAngle||S*2,this.endAngle||0,!!this.clockwise),e.lineTo(s,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()}}),ft=g.extend({init:function(e,s,t){this.r=t||5,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,W(this.r),0,S*2,!0),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.scaleX!==this.scaleY)return this._super(e);let s=!!this.stroke&&this.lineWidth,t=this.position();return a(e,t)<=(this.r+s)*this.scaleX}}),V=g.extend({init:function(e,s,t,n){this.x2=t,this.y2=n,this._super(e,s),this.stroke="#000"},rmove:function(e,s){this.x+=e,this.y+=s,this.x2+=e,this.y2+=s},applyStyle:function(e){e.lineJoin=this.lineJoin,e.lineCap=this.lineCap,this._super(e)},draw:function(e){this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.x2,this.y2),e.stroke()},hitTest:function(e){return u(this.x,this.y,this.x2,this.y2,e)<=this.lineWidth+2}}),R,F,ot,q=null,lt=null,yt=!1,ut=/[MmLlZzHhVvCcQqSsTtAa]\s*([\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?[,\s]*)*/g,zt=/[\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?/g,Ct=function(e,s,t,n){let o=e*t+s*n,d=_(e*e+s*s),p=_(t*t+n*n),v=o/(d*p),T,D;return v>1?v=1:v<-1&&(v=-1),T=O(N(v)),D=e*n-s*t,D===O(D)?T:-T},wt=function(e,s,t){return[e*x(t)-s*L(t),s*x(t)+e*L(t)]},K=function(e,s,t){yt&&e.ctx.moveTo(s,t)},Q=function(e,s){R=e,F=s,q=null,lt=null,yt=!1},J=function(){if(R===A)throw new Error("No current point; can't use relative coordinates")},U=function(e,s,t,n){if(s!==(t?e.length%t:e.length)||e.length<n)throw new Error("wrong number of arguments")},Pt=function(e,s){return this.ctx.moveTo(e,s),Q(e,s),ot=e,arguments.length>2&&vt.apply(this,Z.call(arguments,2)),this},At=function(e,s){return yt&&(R=F=0),J(),e+=R,s+=F,this.ctx.moveTo(e,s),Q(e,s),ot=e,arguments.length>2&&$t.apply(this,Z.call(arguments,2)),this},vt=function(e,s){let t,n=arguments.length;for(U(arguments,0,2,2),K(this,e,s),this.ctx.lineTo(e,s),t=2;t<n;t+=2)this.ctx.lineTo(e=arguments[t],s=arguments[t+1]);return Q(e,s),this},$t=function(e,s){let t,n=R,o=F,d=arguments.length;for(U(arguments,0,2,2),J(),t=0;t<d;t+=2)this.ctx.lineTo(n+=arguments[t],o+=arguments[t+1]);return Q(n,o),this},Et=function(){return this.ctx.closePath(),Q(this,ot),this},B=function(e){let s,t=arguments.length;for(J(),s=0;s<t;s++)vt.call(this,arguments[s],F);return this},Ht=function(e){let s,t=arguments.length;for(s=0;s<t;s++)$t.call(this,arguments[s],0);return this},i=function(e){let s,t=arguments.length;for(J(),s=0;s<t;s++)vt.call(this,R,arguments[s]);return this},r=function(e){let s,t=arguments.length;for(s=0;s<t;s++)$t.call(this,0,arguments[s]);return this},c=function(e,s,t,n,o,d){let p,v=arguments,T=arguments.length;for(U(v,0,6,6),K(this,e,t),this.ctx.bezierCurveTo(e,s,t,n,o,d),p=6;p<T;p+=6)this.ctx.bezierCurveTo(v[p],v[p+1],t=v[p+2],n=v[p+3],o=v[p+4],d=v[p+5]);return Q(o,d),q=[t,n],this},w=function(e,s,t,n,o,d){let p,v=arguments,T=v.length,D=R,j=F;for(U(v,0,6,6),J(),p=0;p<T;p+=6)this.ctx.bezierCurveTo(D+v[p],j+v[p+1],t=D+v[p+2],n=j+v[p+3],D+=v[p+4],j+=v[p+5]);return Q(D,j),q=[t,n],this},I=function(e,s,t,n){let o,d=arguments,p=d.length;for(U(arguments,0,4,4),K(this,e,s),this.ctx.quadraticCurveTo(e,s,t,n),o=4;o<p;o+=4)this.ctx.quadraticCurveTo(e=d[o],s=d[o+1],t=d[o+2],n=d[o+3]);return Q(t,n),lt=[e,s],this},Y=function(e,s,t,n){let o,d=arguments,p=d.length,v=R,T=F;for(U(arguments,0,4,4),J(),o=0;o<p;o+=4)this.ctx.quadraticCurveTo(e=v+d[o],s=T+d[o+1],v+=d[o+2],T+=d[o+3]);return Q(v,T),lt=[e,s],this},et=function(){if(!q)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=R,o=F,d=q[0],p=q[1],v,T,D,j,at,ht;for(U(arguments,0,4,4),J(),e=0;e<t;e+=4)v=n+(n-d),D=o+(o-p),T=s[e],j=s[e+1],at=s[e+2],ht=s[e+3],this.ctx.bezierCurveTo(v,D,T,j,at,ht),n=at,o=ht,d=T,p=j;return Q(n,o),q=[d,p],this},bt=function(){if(!q)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=R,o=F,d=q[0],p=q[1],v,T,D,j,at,ht;for(U(arguments,0,4,4),J(),e=0;e<t;e+=4)v=n+(n-d),D=o+(o-p),T=n+s[e],j=o+s[e+1],at=n+s[e+2],ht=o+s[e+3],this.ctx.bezierCurveTo(v,D,T,j,at,ht),n=at,o=ht,d=T,p=j;return Q(n,o),q=[d,p],this},dt=function(){if(!lt)throw new Error("Last command was not a cubic bezier");let e,s=arguments.length,t=R,n=F,o=lt[0],d=lt[1],p,v,T,D;for(U(arguments,0,2,2),J(),e=0;e<s;e+=2)p=t+(t-o),v=n+(n-d),T=arguments[e],D=arguments[e+1],this.ctx.quadraticCurveTo(p,v,T,D),t=T,n=D,o=p,d=v;return Q(t,n),lt=[o,d],this},pt=function(){if(!lt)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=R,o=F,d=lt[0],p=lt[1],v,T,D,j;for(U(arguments,0,2,2),J(),e=0;e<t;e+=2)v=n+(n-d),T=o+(o-p),D=n+arguments[e],j=o+arguments[e+1],this.ctx.quadraticCurveTo(v,T,D,j),n=D,o=j,d=v,p=T;return Q(n,o),lt=[d,p],this},gt=function(e,s,t,n,o,d,p){if(!e||!s)return vt.call(this,d,p);n=!!n,o=!!o,J();let v=R,T=F,D=d,j=p,at=t*y,ht=L(at),Tt=x(at),xt=(v-D)/2,Gt=(T-j)/2,kt=Tt*xt+ht*Gt,It=-ht*xt+Tt*Gt,Yt,Mt,Rt,jt,Jt,Ut,Vt,Dt;if(e=O(e),s=O(s),Yt=kt*kt/(e*e)+It*It/(s*s),Yt>1)e*=_(Yt),s*=_(Yt),Mt=Rt=0;else{let Kt=e*e,Qt=s*s,Zt=kt*kt,te=It*It,Nt=Kt*te+Qt*Zt;Nt=_(Kt*Qt/Nt-1),n===o&&(Nt=-Nt),Mt=Nt*e*It/s,Rt=-Nt*s*kt/e}return jt=Tt*(Mt-ht)*(Rt+(v+D)/2),Jt=ht*(Mt+Tt)*(Rt+(T+j)/2),xt=(kt-Mt)/e,Gt=(It-Rt)/s,Ut=Ct(1,0,xt,Gt),Dt=Ct(xt,Gt,(-kt-Mt)/e,(-It-Rt)/s),o&&Dt<0?Dt+=k:!o&&Dt>0&&(Dt-=k),Vt=Ut+Dt,this.ellipse(jt,Jt,e,s,at,Ut,Vt,!o),this},ct=function(e,s,t,n,o,d,p){return J(),gt.call(this,e,s,t,n,o,d+R,p+F),this},H=function(e,s,t,n,o,d,p,v){o=o||0,d=d||0,p=p===A?k:p;let T=wt(t*x(d),n*L(d),o),D=e+T[0],j=s+T[1],at=wt(t*x(p),n*L(p),o),ht=e+at[0],Tt=s+at[1];return K(this,D,j),this.ctx.translate(e,s),this.ctx.rotate(o),this.ctx.scale(t/n,1),this.ctx.arc(0,0,n,d,p,!!v),this.ctx.scale(n/t,1),this.ctx.rotate(-o),this.ctx.translate(-e,-s),Q(ht,Tt),this},_t=function(){let e,s=arguments,t=s.length;if(t<6)throw new Error("not enough arguments");if(t%2===0)for(this.ctx.moveTo(s[0],s[1]),e=2;e<t;e+=2)this.ctx.lineTo(s[e],s[e+1]);else{let n=s[t-1],o=(t-1)/2,d=(s[o*2-2]+s[0])/2,p=(s[o*2-1]+s[1])/2,v,T;for(this.ctx.moveTo(d,p),e=0;e<o-1;e++)this.ctx.arcTo(v=s[e*2],T=s[e*2+1],s[e*2+2],s[e*2+3],n,d,p),d=v,p=T;this.ctx.arcTo(s[o*2-2],s[o*2-1],s[0],s[1],n,d,p)}return this},St=function(e){let s=e.match(ut),t,n,o,d,p,v=[];if(!s)throw new Error("Bad path: "+e);for(d=0;t=s[d];d++){for(o=[],o.cmd=t.charAt(0),n=t.match(zt)||[],p=0;p<n.length;p++)o[p]=+n[p];v.push(o)}return v},Ft=g.extend({init:function(e){this.svgpath=St(e),this._super(0,0),this.svgpath[0].cmd.toLowerCase()=="m"&&(this.x=this.svgpath[0][0],this.y=this.svgpath[0][1])},draw:function(e){let s=this.svgpath,t,n;for(this.applyStyle(e),this.setTransform(e),e.beginPath(),f.setContext(e),t=0,n=s.length;t<n;t++)f[s[t].cmd].apply(f,s[t]);this.fill&&e.fill(),this.stroke&&e.stroke()}});return l(f,{distance:a,__zoom:1,Shape:g,setContext:function(e){return this.ctx=e,Q(0,0),e.beginPath(),this},polygon:_t,ellipse:H,M:Pt,m:At,L:vt,l:$t,H:B,h:Ht,V:i,v:r,C:c,c:w,S:et,s:bt,Q:I,q:Y,T:dt,t:pt,A:gt,a:ct,Z:Et,z:Et}),f.register("image",st),f.register("circle",ft),f.register("arc",it),f.register("ellipse",X),f.register("rect",P),f.register("text",M),f.register("line",V),f.register("path",Ft),f}function se(f,$,S){let k=Object.prototype.toString,y="function",_="string",E="array",x="object",L=!1,W=[],O=!1,N,A=f.G_vmlCanvasManager,tt=/webkit|msie/i.exec(f.navigator.userAgent),Z=navigator.userAgent,m=Z.match(/android/i),b=Z.match(/iphone|ipad|ipod/i),C=Z.match(/Windows Phone/i)||Z.match(/iemobile/i),a=/^([#]?)([a-z][\w\-]*)$/,u=["","LEFT","CENTER","RIGHT"],h=[],l=null,g=null,P=!1,M="Cevent"+new Date().getTime(),z=0,st={},X=function(i,r){return k.call(i).slice(8,-1).toLowerCase()===r},it=function(i,r){let c,w=0;if(X(i,E))for(;(c=i[w++])&&r(c,w)!==!1;);},ft=function(i,r){let c=lt(i,r);return c>=0?(i.splice(c,1),r):null},V={click:"touchstart",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},R=function(i){return i=i||f.event,i.preventDefault||(i.preventDefault=function(){this.returnValue=!1}),i.stopPropagation||(i.stopPropagation=function(){this.cancelBubble=!0}),i},F=function(i,r){let c=V[r];return c?function(w){let I=w.type===c;N=B.isTouchDevice=I,!(!I&&(m||b||C))&&i.call(this,w)}:i},ot=function(i){return document.getElementById(i)},q=function(){return document.addEventListener?function(r,c,w){r&&(r=typeof r=="string"?ot(r):r,w=F(w,c),V[c]&&r.addEventListener(V[c],w,!0),r.addEventListener(c,w,!0))}:function(r,c,w){r&&(r=typeof r=="string"?ot(r):r,r.attachEvent("on"+c,function(I){return I=R(I),w.call(I.target||I.srcElement,I)}))}}(),lt=function(){return[].indexOf?function(i,r){return i.indexOf(r)}:function(i,r){for(let c=0,w=i.length;c<w;c++)if(r===i[c])return c;return-1}}(),yt=function(i){let r=0,c=0;if(i.offsetParent)do r+=i.offsetLeft,c+=i.offsetTop;while(i=i.offsetParent);return{x:r,y:c}},ut=function(i,r,c){let w=i[M],I;return w||(w=i[M]=++z),I=st[w],I||(I=st[w]={}),r&&c!==S&&(I[r]=c),r?I[r]:I},zt=function(i,r){if(!i)return;let c=i[M];c&&st[c]&&delete st[c]},Ct=function(i,r,c){let w=ut(i),I;it(r.split(" "),function(Y){I=w[Y]=w[Y]||[],I.push(c)})},wt=function(i,r,c,w){let I,Y=0,et=!0;for(c.ctx.save(),c.ctx.scale(c.__zoom,c.__zoom);I=r[Y++];)I.call(i,c,w)===!1&&(et=!1);return c.ctx.restore(),et||w.preventDefault(),et},K=function(i,r,c,w){let I=ut(i,r),Y=ut(w.cv,r);I&&I.length&&h.push(i,I),Y&&Y.length&&h.push(i,Y)},Q=function(i,r){let c,w;for(i.clear(),c=0,w=h.length;c<w;c+=2)wt(h[c],h[c+1],i,r);h=[],i.redraw()},J=function(i,r){i.preventDefault(),i=i.touches?i.touches[0]:i;let c,w=r._shapes,I=w.length;for(r.x=((i&&i.pageX-r._pos.x+1||f.event.offsetX+1)-1)/r.__zoom||0,r.y=((i&&i.pageY-r._pos.y+1||f.event.offsetY+1)-1)/r.__zoom||0;c=w[--I];)if(c.hitTest(r))return c},U=function(i,r){return function(c){c.preventDefault(),c=c.touches?c.touches[0]:c,i.lastX=i.x,i.lastY=i.y,r=i._curHover;let w=((c&&c.pageX-i._pos.x+1||f.event.offsetX+1)-1)/i.__zoom||0,I=((c&&c.pageY-i._pos.y+1||f.event.offsetY+1)-1)/i.__zoom||0;if(!(!O&&Math.abs(w-i.x)<2&&Math.abs(I-i.y)<2)){if(i.x=w,i.y=I,O=!0,!i._clicked&&L){let Y=J(c,i);Y?(r!==Y&&(K(Y,"mouseover",c,i),r&&K(r,"mouseout",c,i)),i._curHover=r=Y):r&&(K(r,"mouseout",c,i),i._curHover=r=null)}r&&K(r,"mousemove",c,i),h.length&&Q(i,c)}}},Pt=function(i){return function(r){(r.type==="mousedown"||r.type==="touchstart")&&i.calcCanvasPosition(),L||(i._curHover=J(r,i)),i._curHover;let c=i._curHover,w=u[r.which||r.button];i._clicked=!0,l=i.cv,i[w]=!0,c?(K(c,"mousedown",r,i),c!==i.focused&&(K(c,"focus",r,i),i.focused&&K(i.focused,"blur",r,i))):i.focused&&(K(i.focused,"blur",r,i),i.focused=null),i.focused=c||null,h.length&&Q(i,r),i[w]=!1}},At=function(i){return function(r){i._clicked=!1,i._curHover&&(K(i._curHover,"mouseup",r,i),!O&&N&&(K(i._curHover,"tap",r,i),i.lastClick&&r.timeStamp-i.lastClick<300&&K(i._curHover,"dblclick",r,i),i.lastClick=r.timeStamp)),O=!1,h.length&&Q(i,r)}},vt=function(i){return function(r){i._curHover&&K(i._curHover,"click",r,i),h.length&&Q(i,r)}},$t=function(i){return function(r){i._curHover&&K(i._curHover,"dblclick",r,i),h.length&&Q(i,r)}},Et=function(){let i={specialKeys:{27:"esc",9:"tab",32:"space",13:"return",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",109:"-",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",191:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",110:".",111:"/",187:"+",189:"-"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"}},r;return function(c,w){let I=ut(w.cv,c,{}),Y=ut(I);return function(et){if(l!==w.cv&&!w.__globalkeyevents)return;r=c=="keydown"?et.keyCode:r;let bt=i.specialKeys[r],dt=bt||String.fromCharCode(r||et.charCode).toLowerCase(),pt="",gt;if(et.altKey&&(pt+="alt+"),(et.ctrlKey||et.metaKey)&&(pt+="ctrl+"),et.shiftKey&&(pt+="shift+"),gt=Y[pt+dt]||Y[pt+i.shiftNums[dt]]||pt==="shift+"&&Y[i.shiftNums[dt]]||Y.any,gt){let ct=wt(w,gt,w,et);return w.play||w.redraw(),ct}}}}(),B=function(i,r){if(i=X(i,_)?$.getElementById(i):i,i.getContext||f.G_vmlCanvasManager)return new B.fn.init(i,r);throw Error("Your browser sucks")};B.forse_redraw=function(){let i,r=W.length;for(i=0;i<r;i++)W[i].redraw()},B.fn=B.prototype={init:function(i,r){this.cv=i,f.getComputedStyle?this.background=getComputedStyle(this.cv.parentElement).backgroundColor:this.background="#152937",!i.getContext&&f.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(i),this.ctx=i.getContext("2d"),this.width=i.width,this.height=i.height,this.__zoom=1,this.x=0,this.y=0,this.cv[M]?(this._shapes=ut(i,"shapes"),this._last=r):(W.push(this),this._shapes=ut(i,"shapes",[]),this.__cache=ut(i,"cache",document.createElement("canvas")),this._last=null,f.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.__cache),this.__cachectx=this.__cache&&this.__cache.getContext("2d"),this.calcCanvasPosition(),q(i,"mousemove",U(this),!1),q(i,"dblclick",$t(this),!1),q(i,"click",vt(this),!1),q(i,"mouseup",At(this),!1),q(i,"mousedown",Pt(this),!1),q($,"keydown",Et("keydown",this),!1),q($,"keyup",Et("keyup",this),!1),tt||q($,"keypress",Et("keypress",this),!1),"onselectstart"in i&&(i.onselectstart=function(){return!1},i.onmousedown=function(){return!1}))},updateCache:function(){this.__cache&&(this.__cache.width=this.cv.width,this.__cache.height=this.cv.height,ft(this._shapes,g),this.draw(),this._shapes.push(g),this.__cachectx.drawImage(this.cv,0,0))},calcCanvasPosition:function(){return this._pos=yt(this.cv),this},get:function(i){return i=i<0?this._shapes.length+i:i,this._shapes[i]||this._shapes},getAll:function(i){let r=[],c=a.exec(i),w,I;return i==="*"?r=this._shapes.slice(0):c&&(w=c[1],I=c[2],it(this._shapes,function(Y){Y[w]===I&&r.push(Y)})),r},remove:function(i){return zt(ft(this._shapes,i)),this.redraw()},addId:function(i){let r=a.exec(i),c=this._last;return r&&!r[1]&&c&&(c.length?it(c,function(w){w["#"]=i}):c["#"]=i),this},removeId:function(){let i=this._last;return i&&!i.length?i["#"]="":it(i,function(r){r["#"]=""}),this},find:function(i){let r=this.getAll(i);return B(this.cv,r.length===1?r[0]:r)},attr:function(i,r){let c=this._last;return c&&c.attr?c.attr(i,r):it(c,function(w){w.attr(i,r)}),this},rotate:function(i){return this.attr({rotation:i})},translate:function(i,r){return this.attr({tx:i,ty:r})},scale:function(i,r){return this.attr({scaleX:i,scaleY:r})},skewX:function(i){return this.attr({skewX:i})},skewY:function(i){return this.attr({skewY:i})},zoomTo:function(i){return X(i,"number")&&(this.__zoom=i),this},zoomIn:function(){return this.zoomTo(this.__zoom+.1)},zoomOut:function(){return this.zoomTo(this.__zoom-.1)},setGlobalKeyEvents:function(i){return this.__globalkeyevents=!!i,this},bind:function(i,r,c){let w=c||this._last,I;if(!L&&"mouseover mouseout".indexOf(i)!==-1&&(L=!0),X(i,_)&&X(r,x))for(I in r)this[I](i,r[I]);else if(X(i,x))for(I in i)this[I](i[I]);else w&&!w.length?Ct(w,i,r):it(w,function(Y){Ct(Y,i,r)});return this},beforeDraw:function(i){return X(i,y)&&(this.__beforeDraw=i),this},afterDraw:function(i){return X(i,y)&&(this.__afterDraw=i),this},clear:function(i,r,c,w){return i=i||0,r=r||0,c=c||this.cv.width,w=w||this.cv.height,this.ctx.fillStyle=this.background,this.ctx.fillRect(i,r,c,w),this},draw:function(){let i,r=0,c=this._shapes;if(this.ctx.save(),B.__zoom=this.__zoom,this.__beforeDraw&&this.__beforeDraw.call(this,this),!A&&this.__cache&&P&&!this.play&&g)this.ctx.drawImage(this.__cache,0,0),g.draw(this.ctx);else for(;i=c[r++];)i.draw(this.ctx);return this.__afterDraw&&this.__afterDraw.call(this,this),B.__zoom=1,this.ctx.restore(),this},redraw:function(){return this.clear().draw()},frameCount:0,stop:function(){return delete this.play,this}},B.fn.init.prototype=B.prototype,B.addEventListener=q;function Ht(i,r){let c=a.exec(i);return function(w,I){(c&&this[c[1]]===c[2]||i==="*")&&r.call(this,w,I)}}return it("mousemove mouseover mouseout mousedown mouseup click dblclick focus blur tap".split(" "),function(i){B.fn[i]=function(r,c){let w;return X(c,y)&&(r=Ht(r,c),w=this.cv),this.bind(i,r,w)}}),it("keydown keypress keyup".split(" "),function(i){B.fn[i]=function(r,c){return!c&&X(r,y)&&(c=r,r="any"),r=(r+"").toLowerCase(),this.bind(r,c,ut(this.cv,i))}}),tt&&(B.fn.keypress=B.fn.keydown),B.fn.drag=function(i){let r,c,w,I,Y=[],et,bt="Cevent-drag"+M,dt=this._last;if(X(i,_)&&(et=i,i=arguments[1]),i&&(r=i.start,c=i.move,w=i.end,I=i.afterMove),et)return this.mousedown(et,pt).mouseup(et,ct).mousemove(et,gt);dt&&!dt.length&&(dt=[dt]),it(dt,function(H){ut(H,bt)||(ut(H,bt,!0),Y.push(H))}),B(this.cv,Y).mousedown(pt).mouseup(ct).mousemove(gt);function pt(H,_t){(H.LEFT||N)&&(g=this,!H.play&&!A&&!P&&H.updateCache())}function gt(H,_t){if(this===g){if(!P){if(r&&r.call(this,H,_t)===!1)return g=P=null;P=!0}c&&c.call(this,H,_t),this.rmove(H.x-H.lastX,H.y-H.lastY),I&&I.call(this,H,_t)}}function ct(H,_t){this===g&&(g=P=null,w&&w.call(this,H,_t))}return this},B.registre=B.register=function(i,r){i=i.toLowerCase();let c=i.charAt(0).toUpperCase()+i.substring(1);this[c]=r,this.prototype[i]=function(){let w=r.apply(this,arguments);return w[""]=i,this._shapes.push(w),this._last=w,this}},q($,"mousedown",function(i){let r=i.target||i.srcElement;r=r.nodeName==="OBJECT"?r.parentNode:r,r[M]||(l=r)},!1),B.isTouchDevice=N,f.Cevent=B,B}const mt=ie(se(window,document)),G=function(f){const $={randint:function(_){return~~(Math.random()*_)}};"bind"in Function||(Function.prototype.bind=function(_){let E=this;return function(){return E.apply(_,arguments)}});let S=Xt.extend({init:function(_){this.elem=document.getElementById(_)}}),k=function(_,E,x){return document.addEventListener?function(L,W,O){L.addEventListener(W,O,!1)}:function(L,W,O){L.attachEvent("on"+W,function(N){return N=N||E,N.preventDefault=N.preventDefault||function(){this.returnValue=!1},N.stopPropagation=N.stopPropagation||function(){this.cancelBubble=!0},O.call(N.target||N.srcElement,N)})}}(),y="mousemove mouseover mouseout mousedown mouseup click touchstart dblclick focus blur submit change".split(" ");for(let _=0;_<y.length;_++){let E=y[_];S.prototype[E]=function(x){return function(L,W){typeof L=="function"?k(this.elem,x,L):k(this.elem,x,function(O){let N=O.target||O.srcElement;N.tagName.toLowerCase()===L&&(O.stopPropagation(),W.call(N,O))},!1)}}(E)}return $.fullScreen=function(){document.documentElement.scrollHeight<f.outerHeight/f.devicePixelRatio?(document.body.style.height=f.outerHeight/f.devicePixelRatio+1+"px",setTimeout(function(){f.scrollTo(1,1)},0)):f.scrollTo(1,1)},$.getContext=function(_){return!_.getContext&&f.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(_),_.getContext("2d")},$.extend=function(_,E){let x;for(x in E)E.hasOwnProperty(x)&&!(x in _)&&(_[x]=E[x]);return _},$.calcPieces=function(_,E){let x=_.image.width,L=_.image.height,W=document.getElementById("set-parts"),O,N;W.innerHTML="";for(let A=0;A<_.options.length;A+=1){let tt=~~Math.sqrt(x*L/_.options[A]),Z=~~(x/tt),m=~~(L/tt);for(;Z*m<_.options[A];)tt--,Z=~~(x/tt),m=~~(L/tt);N!==Z*m&&(N=Z*m,O=document.createElement("option"),O.value=_.options[A],O.innerHTML=E(A),W.appendChild(O),_.options[A]===_.selected&&(O.selected=!0))}},$.addEvent=k,$.$=function(){let _=S();return function(E){return _.elem=document.getElementById(E),_}}(),$.getElement=function(_){return document.getElementById(_)},$.ajax=function(_){let E=new XMLHttpRequest;E.onreadystatechange=function(){E.readyState===XMLHttpRequest.DONE&&(E.status===200?_.success&&_.success(E.responseText):_.error&&_.error())},E.open("GET",_.url,!0),E.send()},f.Util=f.Util||$,$}(window),rt=function(){};rt.prototype.setMaxListeners=function(f){this._events||(this._events={}),this._events.maxListeners=f};Array.isArray=Array.isArray||function(f){return f.sort&&f.length&&f.slice};rt.prototype.emit=function(f){if(f==="error"&&(!this._events||!this._events.error||Array.isArray(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;let $=this._events[f];if(!$)return!1;if(typeof $=="function"){switch(arguments.length){case 1:$.call(this);break;case 2:$.call(this,arguments[1]);break;case 3:$.call(this,arguments[1],arguments[2]);break;default:let S=Array.prototype.slice.call(arguments,1);$.apply(this,S)}return!0}if(Array.isArray($)){let S=Array.prototype.slice.call(arguments,1),k=$.slice();for(let y=0,_=k.length;y<_;y++)k[y].apply(this,S);return!0}return!1};rt.prototype.publish=rt.prototype.emit,rt.prototype.addListener=function(f,$){if(typeof $!="function")throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",f,$),!this._events[f])this._events[f]=$;else if(Array.isArray(this._events[f])){if(this._events[f].push($),!this._events[f].warned){let S;this._events.maxListeners!==void 0?S=this._events.maxListeners:S=10,S&&S>0&&this._events[f].length>S&&(this._events[f].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[f].length),console.trace())}}else this._events[f]=[this._events[f],$];return this};rt.prototype.on=rt.prototype.subscribe=rt.prototype.addListener,rt.prototype.once=function(f,$){function S(){k.removeListener(f,S),$.apply(this,arguments)}if(typeof $!="function")throw new Error(".once only takes instances of Function");let k=this;return S.listener=$,k.on(f,S),this};rt.prototype.removeListener=function(f,$){if(typeof $!="function")throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[f])return this;let S=this._events[f];if(Array.isArray(S)){let k=-1;for(let y=0,_=S.length;y<_;y++)if(S[y]===$||S[y].listener&&S[y].listener===$){k=y;break}if(k<0)return this;S.splice(k,1),S.length==0&&delete this._events[f]}else(S===$||S.listener&&S.listener===$)&&delete this._events[f];return this};rt.prototype.unsubscribe=rt.prototype.removeListener,rt.prototype.removeAllListeners=function(f){return arguments.length===0?(this._events={},this):(f&&this._events&&this._events[f]&&(this._events[f]=null),this)};rt.prototype.listeners=function(f){return this._events||(this._events={}),this._events[f]||(this._events[f]=[]),Array.isArray(this._events[f])||(this._events[f]=[this._events[f]]),this._events[f]};rt.mixin=function(f){for(let $ in rt.prototype)f.prototype[$]||(f.prototype[$]=rt.prototype[$])};const ne=[3,20,50,75,100],re=["вельмі лёгка","лёгка","складана","вельмі складана","эксперт"];function oe(f){return re[f]}function nt(){return window.devicePixelRatio||1}(function(f,$,S){let k=G.getContext(f.createElement("canvas")),y=Math.abs,_=Math.PI/180,E=G.getContext(f.createElement("canvas")),x=navigator.userAgent,L=x.match(/android/i),W=x.match(/iphone|ipad|ipod/i),O=x.match(/Windows Phone/i)||x.match(/iemobile/i),N=!L&&!W&&!O,A=20;function tt(a,u){if(a.rotation%360||u.rotation%360||u.hide||a.hide||a.row!=u.row&&a.col!=u.col)return;let h=a.tx-u.tx,l=a.ty-u.ty,g=a.col-u.col,P=a.row-u.row,M=a.width,z=a.height;if(a.size,(g==-1&&h<0&&y(h+M)<A||g==1&&h>=0&&y(h-M)<A)&&l<=A&&l>=-20)return[a.col>u.col?-y(h)+M:y(h)-M,u.ty-a.ty];if((P==-1&&l<0&&y(l+z)<A||P==1&&l>=0&&y(l-z)<A)&&h<=A&&h>=-20)return[u.tx-a.tx,a.row>u.row?-y(l)+z:y(l)-z]}let Z=mt.Shape.extend({type:"piece",init:function(a,u,h,l,g,P,M){this.flat=M,this._super(a,u),this.img=h,this.originalImg=h,this.size=Math.max(l,g),this.width=l,this.height=g,this.diagonal=~~Math.sqrt(l*l+g*g),this.edges=P,this.lastRotation=0,this.size/2,this.tx=this.x+this.width/2,this.ty=this.y+this.height/2,this.x=-this.width/2,this.y=-this.height/2},draw_path:function(a){let u=this.size,h,l=0;for(a.beginPath(),a.moveTo(this.x,this.y);l<4;l++){h=this.edges[l],u=l%2?this.height:this.width;let g=l%2?this.height:this.width,P=l%2?this.width:this.height,M=l%2?this.y:this.x,z=l%2?this.x:this.y;h?this[h](a,g,P,M,z):a.lineTo(M+u,z),a.rotate(Math.PI/2)}a.closePath()},render:function(a,u){a=a||this.ox||0,u=u||this.oy||0,this.originalTX=this.originalTX||this.tx,this.originalTY=this.originalTY||this.ty;let h=this.ctx||G.getContext(f.createElement("canvas")),l=this.size+.5;E.canvas.width=h.canvas.width=l*2,E.canvas.height=h.canvas.height=l*2,E.save(),h.save(),this.applyStyle(h),E.lineWidth=.5,h.lineWidth=.5,h.translate(this.width,this.height),h.rotate(this.rotation*_),E.translate(this.width,this.height),E.rotate(this.rotation*_),this.draw_path(h),this.draw_path(E),h.fill(),E.drawImage(this.originalImg,-this.originalTX-a,-this.originalTY-u),this.stroke&&(E.globalCompositeOperation="lighter",E.shadowOffsetY=1.5,E.shadowOffsetX=1.5,E.shadowBlur=0,E.shadowColor="rgba(255, 255, 255, .4)",E.lineWidth=1.5,E.strokeStyle="rgba(0, 0, 0, .4)",E.stroke(),E.globalCompositeOperation="darken",E.shadowBlur=1,E.shadowOffsetY=-1,E.shadowOffsetX=-1,E.shadowBlur=2,E.shadowColor="rgba(0, 0, 0, .2)",E.lineWidth=2,E.strokeStyle="rgba(0, 0, 0, .4)",E.stroke(),E.clip()),E.restore(),h.restore(),h.globalCompositeOperation="source-in",h.globalCompositeOperation!=="source-in"&&(h.globalCompositeOperation="source-atop"),h.drawImage(E.canvas,0,0),this.ctx||(this.tx+=this.offset),this.img=h.canvas,this.ctx=h,this.ox=a,this.oy=u},outside:function(a,u,h,l,g){if(this.flat)return a.lineTo(l+u,g);a.lineTo(l+u*.34,g),a.bezierCurveTo(l+u*.5,g,l+u*.4,g+h*-.15,l+u*.4,g+h*-.15),a.bezierCurveTo(l+u*.3,g+h*-.3,l+u*.5,g+h*-.3,l+u*.5,g+h*-.3),a.bezierCurveTo(l+u*.7,g+h*-.3,l+u*.6,g+h*-.15,l+u*.6,g+h*-.15),a.bezierCurveTo(l+u*.5,g,l+u*.65,g,l+u*.65,g),a.lineTo(l+u,g)},inside:function(a,u,h,l,g){if(this.flat)return a.lineTo(l+u,g);a.lineTo(l+u*.35,g),a.bezierCurveTo(l+u*.505,g+.05,l+u*.405,g+h*.155,l+u*.405,g+h*.1505),a.bezierCurveTo(l+u*.3,g+h*.3,l+u*.5,g+h*.3,l+u*.5,g+h*.3),a.bezierCurveTo(l+u*.7,g+h*.29,l+u*.6,g+h*.15,l+u*.6,g+h*.15),a.bezierCurveTo(l+u*.5,g,l+u*.65,g,l+u*.65,g),a.lineTo(l+u,g)},draw:function(a){let u=this.x-this.width/2-.5,h=this.y-this.height/2-.5;if(N){this.setTransform(a),a.drawImage(this.img,u,h);return}this.rotation!==this.lastRotation&&(this.render(),this.lastRotation=this.rotation),a.drawImage(this.img,u+this.tx,h+this.ty)},check:function(a){let u;if(a.type==="piece")u=tt(this,a);else{let h,l=a.pieces.length;for(h=0;h<l&&!(u=tt(this,a.pieces[h]));h++);}return u&&this.rmove(u[0],u[1]),u},hitTest:function(a){if(!this.hide)return this.setTransform(k),this.draw_path(k),k.isPointInPath(a.x*nt(),a.y*nt())}}),m=mt.Shape.extend({type:"group",init:function(){this.pieces=[],this._super(0,0)},draw:function(a){if(this.hide)return;let u,h=this.pieces.length;for(u=0;u<h;u++)this.pieces[u].draw(a)},hitTest:function(a){let u,h=this.pieces.length;for(u=0;u<h;u++)if(this.pieces[u].hitTest(a))return!0},check:function(a){let u,h=this.pieces.length,l;if(a.type==="piece"){for(u=0;u<h;u++)if(l=tt(this.pieces[u],a))return this.rmove(l[0],l[1]),!0}else{let g,P=a.pieces.length;for(u=0;u<h;u++)for(g=0;g<P;g++)if(l=tt(this.pieces[u],a.pieces[g]))return this.rmove(l[0],l[1]),!0}},rmove:function(a,u){let h,l=this.pieces.length;for(h=0;h<l;h++)this.pieces[h].rmove(a,u);this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty},add:function(){this.pieces=this.pieces.concat.apply(this.pieces,arguments),this.minPieceX=C(this.pieces,"tx"),this.minPieceY=C(this.pieces,"ty"),this.width=b(this.pieces,"tx").tx-this.minPieceX.tx,this.height=b(this.pieces,"ty").ty-this.minPieceY.ty,this.width+=this.pieces[0].width,this.height+=this.pieces[0].height,this.x=this.pieces[0].x,this.y=this.pieces[0].y,this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty}});function b(a,u){let h=a[0][u],l=0;for(let g=1;g<a.length;g++)a[g][u]>h&&(h=a[g][u],l=g);return a[l]}function C(a,u){let h=a[0][u],l=0;for(let g=1;g<a.length;g++)a[g][u]<h&&(h=a[g][u],l=g);return a[l]}mt.register("group",m),mt.register("piece",Z)})(document);const Ot=function(f,$,S){let k="inside",y="outside",_=null,E,x=[k,y],L=0,W={spread:.7,offsetTop:$.innerHeight*.2,maxWidth:$.innerWidth*.8,maxHeight:$.innerHeight*.6,defaultImage:"images/puzzle-01.jpg",piecesNumberTmpl:"%d Pieces",redirect:"",border:!0,defaultPieces:3,shuffled:!1,rotatePieces:!0,numberOfPieces:ne,squarePieces:!1},O=45;function N(){return x[G.randint(2)]}let A={};A.Jigsaw=Xt.extend({init:function(m){let b=new rt,C=this;this.container=f.body,this.opts=m=G.extend(m||{},W),this.max_width=m.maxWidth,this.max_height=m.maxHeight,G.$("redirect-form").action=m.redirect,E=m.defaultImage,this.eventBus=b,this.ce=new mt("canvas"),this.ui=new A.UI(b,m.defaultPieces||10),this.tmp_img=f.createElement("img"),this.img=f.getElementById("image"),this.ctx=G.getContext(this.img),this.preview=f.getElementById("image-preview"),this.previewCtx=G.getContext(this.preview),this.parts=m.defaultPieces||10,this.tmp_img.onload=function(){C.original=this,C.draw_image(this),G.calcPieces({image:C.img,template:C.opts.piecesNumberTmpl,selected:C.parts,options:C.opts.numberOfPieces},oe),C.render()},this.tmp_img.onerror=function(){E&&C.set_image(E)},tt(this.ce,b,this.opts.rotatePieces),b.on(A.Events.JIGSAW_COMPLETE,function(){C.ui.stop_clock(),m.redirect?C.redirect():C.ui.show_time()}),m.shuffled&&b.on(A.Events.RENDER_FINISH,this.start_game.bind(this)),b.on(A.Events.PARTS_NUMBER_CHANGED,this.set_parts.bind(this)),b.on(A.Events.RENDER_REQUEST,this.render.bind(this)),b.on(A.Events.START_GAME,this.start_game.bind(this)),b.on(A.Events.JIGSAW_SET_IMAGE,this.set_image.bind(this)),G.addEvent($,"resize",this.resize.bind(this)),this.resize(),this.set_image()},resize:function(){let b=this.ce.cv,C=this.width(),a=this.height()-O;b.width=C*nt(),b.height=a*nt(),b.style.width=C+"px",b.style.height=a+"px",this.ce.redraw(),mt.isTouchDevice&&G.fullScreen()},redirect:function(){G.$("t").value=this.ui.time(),G.$("p").value=this.parts,G.$("redirect-form").submit()},set_parts:function(m){this.parts=m},set_image:function(m){this.ce.cv.className="loading",this.tmp_img.src=m||E},width:function(){return this.container.offsetWidth},height:function(){return this.container.offsetHeight},draw_image:function(m,b,C){let a=b||this.max_width*nt(),u=C||this.max_height*nt(),h,l,g=this.ctx;if(a>this.width()||u>this.height()-O){let P=Math.min(this.width()/a,(this.height()-O)/u);a*=P,u*=P}if(m.width>a||m.height>u){let P=Math.min(a/m.width,u/m.height);h=~~(m.width*P)*nt(),l=~~(m.height*P)*nt(),g.canvas.width=h,g.canvas.height=l,g.drawImage(m,0,0,m.width,m.height,0,0,h,l)}else g.canvas.width=m.width*nt(),g.canvas.height=m.height*nt(),g.drawImage(m,0,0,m.width,m.height,0,0,g.canvas.width,g.canvas.height)},clear:function(){this.ce._shapes=[]},start_game:function(){let m=this.ce.getAll("piece");if(this.__pieces)this.ce._shapes=m=this.__pieces.slice(0);else return;this.ce.clear();let b,C=m.length,a;m[0].size;let u=this.opts.spread,h=this.width()*nt(),l=(this.height()-O)*nt(),g=h*u,P=l*u,M=~~((h-g)/2),z=~~((l-P)/2);for(b=0;b<C;b++)a=m[b],a.tx=G.randint(g)+a.tx%1+M,a.ty=G.randint(P)+a.tx%1+z,this.opts.rotatePieces&&(a.rotation=G.randint(4)*90);this.opts.shuffled&&(this.ce.cv.className="",this.ui.init_clock()),G.getElement("START_GAME").style.display="none",this.ce.find("*").attr({hide:!1}),this.ce.shuffled=!0,this.ce.redraw()},render:function(){this.opts.shuffled?(this.ce.cv.className="loading",this.ce.clear(),this.ui.stop_clock()):this.ce.cv.className="",G.getElement("START_GAME").style.display=null,this.ce.shuffled=!1;let m,b,C,a,u=[],h=[],l=this.img.width,g=this.img.height,P=~~Math.sqrt(l*g/this.parts),M=~~(l/P),z=~~(g/P),st=0,X=0,it=++L,ft;for(this.flag=it;M*z<this.parts;)P--,M=~~(l/P),z=~~(g/P);let V=~~(l/M),R=~~(g/z);V=V%2?V:V-1,R=R%2?R:R-1,ft=~~(this.width()/2*nt()-V*M/2),this.clear();let F=~~((l-M*V)/2),ot=~~((g-z*R)/2);F=F>=0?F:0,ot=ot>=0?ot:0,this.preview.width=V*M,this.preview.height=R*z,this.preview.style.width=this.preview.width/nt()+"px",this.preview.style.height=this.preview.height/nt()+"px",this.previewCtx.globalAlpha=.3,this.previewCtx.drawImage(this.img,F,ot,V*M,R*z,0,0,V*M,R*z),(function q(){st<M&&it===this.flag?(X<z?(m=X===0?_:C===k?y:k,b=st===M-1?_:N(),C=X===z-1?_:N(),a=st===0?0:h[X]===k?y:k,this.ce.piece(V*st,R*X+this.opts.offsetTop,$.G_vmlCanvasManager?this.tmp_img:this.img,V,R,[m,b,C,a],this.opts.squarePieces).attr({col:st,row:X,offset:ft,stroke:this.opts.border?"black":""}).get(-1).render(F,ot-this.opts.offsetTop),this.opts.shuffled||this.ce.redraw(),u.push(b),X++):(st++,X=0,h=u,u=[]),setTimeout(q.bind(this),20)):this.flag===it&&(this.__pieces=this.ce.get().slice(0),this.ce.redraw(),this.eventBus.emit(A.Events.RENDER_FINISH))}).bind(this)()}}),A.Events={PARTS_NUMBER_CHANGED:"PartsNumberChanged",RENDER_REQUEST:"RenderRequestEvent",RENDER_FINISH:"RenderFinishEvent",JIGSAW_RENDERED:"JigsawRenderedEvent",JIGSAW_SET_IMAGE:"JigsawSetImageEvent",START_GAME:"JigsawGameStartEvent",SHOW_PREVIEW:"JigsawShowPreview",JIGSAW_COMPLETE:"JigsawCompleteEvent",PIECES_CONNECTED:"PieceConnectedEvent",SHOW_SIDEBAR:"ShowSidebarEvent",HIDE_SIDEBAR:"HideSidebarEvent",ZOOM_IN:"JigsawZoomIn",ZOOM_OUT:"JigsawZoomOut"},A.GET=function(){if(location.query)return;let m=location.search.replace(/^[?]/,"").split("&"),b=0,C=m.length,a={};for(;b<C;b++){if(!m[b])continue;let u=m[b].split("=");a[unescape(u[0])]=unescape(u[1])}return a},A.UI=Xt.extend({init:function(m,b){this.eventBus=m,this.clock=G.getElement("clock"),Z(this,m),m.on(A.Events.START_GAME,this.init_clock.bind(this)),m.on(A.Events.SHOW_PREVIEW,this.show_preview.bind(this))},stop_clock:function(){L++},init_clock:function(){let m=this;this.ini=new Date().getTime(),this.uuid=L,function b(){m.uuid===L&&(m.clock.innerHTML=m.time(),setTimeout(b,1e3))}()},show_preview:function(){let m=G.getElement("image-preview");m.className=m.className==="show"?"hide":"show"},show_time:function(){this.show_modal("congrat"),G.getElement("START_GAME").style.display=null,G.getElement("time").innerHTML=this.clock.innerHTML},time:function(){let m=~~((new Date().getTime()-this.ini)/1e3),b=m%60,C=~~(m/60),a=~~(C/60);return C%=60,(a>9?a:"0"+a)+":"+(C>9?C:"0"+C%60)+":"+(b>9?b:"0"+b)},show_modal:function(m){qt.Modal.open(m)}});function tt(m,b,C){m.drag("*",{start:function(a,u){a.cv.style.cursor="move",a.lastX*=nt(),a.lastY*=nt(),this.handleX=a.lastX-this.tx,this.handleY=a.lastY-this.ty},move:function(a,u){a.x*=nt(),a.y*=nt(),a.x+=a.lastX-this.tx-this.handleX,a.y+=a.lastY-this.ty-this.handleY},afterMove:function(a,u){let h=~~(this.width/2),l=~~(this.height/2),g=this.x+this.tx+h,P=this.y+this.ty+l,M=a.cv.width,z=a.cv.height;this.rotation/45%2&&(h=this.diagonal/2,l=this.diagonal/2);let st=0,X=0;g-h<0?st=g-h:g+h>M&&(st=g+h-M),P-l<0?X=P-l:P+l>z&&(X=P+l-z),this.rmove(-st,-X)},end:function(a,u){if(a.cv.style.cursor="default",!a.shuffled)return;let h=a.getAll("piece").concat(a.getAll("group")),l=0,g=h.length,P=this;for(;l<g;l++)h[l]!==this&&P.check(h[l])&&(a.remove(P),a.remove(h[l]),a._curHover=a.group().get(-1),a._curHover.add(P.pieces||P,h[l].pieces||h[l]),P=a._curHover,a.focused=null);this!==P&&b.emit(A.Events.PIECES_CONNECTED),!m.getAll("piece").length&&m.getAll("group").length===1&&m.shuffled&&(m.shuffled=!1,b.emit(A.Events.JIGSAW_COMPLETE)),P.type==="group"&&(a.remove(P),a._shapes.unshift(P))}}).focus("*",function(a,u){a.remove(this),a._shapes.push(this)}),G.addEvent(m.cv,"contextmenu",function(a){C&&m.focused&&(m.focused.rotation=(m.focused.rotation+45)%360,m.redraw()),a.preventDefault()}),C&&(m.keydown("right",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation+45)%360),!1}).keydown("left",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation-45)%360),!1}),m.tap("*",function(a,u){mt.isTouchDevice&&m.focused&&(m.focused.rotation=(m.focused.rotation+45)%360,m.redraw())}))}function Z(m,b){function C(h){let l=h[0];if(!l.type.match(/image.*/)){G.getElement("image-error").style.display="block";return}let g=new FileReader;g.onloadend=function(P){b.emit(A.Events.JIGSAW_SET_IMAGE,this.result),a()},g.readAsDataURL(l)}$.FileReader&&new FileReader().onload===null&&(G.getElement("create-puzzle").classList.remove("hide"),G.$("image-input").change(function(){C(this.files)}),"ondragenter"in $&&"ondrop"in $&&(G.getElement("dnd").style.display="block",f.addEventListener("dragenter",function(h){return h.stopPropagation(),h.preventDefault(),!1},!1),f.addEventListener("dragover",function(h){return h.stopPropagation(),h.preventDefault(),!1},!1),f.addEventListener("drop",function(h){h.stopPropagation(),h.preventDefault();let l=h.dataTransfer;C(l.files)},!1)));function a(){return qt.Modal.close(),!1}function u(h){return h}Array.from(f.querySelectorAll(".app-slider-selector")).forEach(function(h){G.addEvent(h,"click",function(l){b.emit(A.Events.JIGSAW_SET_IMAGE,l.target.src),b.emit(A.Events.HIDE_SIDEBAR)})}),G.$("set-parts").change(function(){b.emit(A.Events.PARTS_NUMBER_CHANGED,this.value),b.emit(A.Events.RENDER_REQUEST)}),G.$("set-preview").change(function(){b.emit(A.Events.SHOW_PREVIEW)}),mt.addEventListener("game-options","mousedown",function(h){let l=h.target||h.srcElement;A.Events[l.id]&&(h.preventDefault(),b.emit(A.Events[l.id]))})}return rt.mixin(A.Jigsaw),A}(document,window),Lt=(()=>{const f="app-slider-panel__animation-init",$="app-slider-panel__expanded",S="app-slider-ov",k="expanded";let y=null,_=[],E=[];return{isReadyToUse(){return y!=null},init:function(x){if(x.on(Ot.Events.SHOW_SIDEBAR,function(){Lt.show(!0)}),x.on(Ot.Events.HIDE_SIDEBAR,function(){Lt.show(!1)}),_=Array.from(document.querySelectorAll(".js-sidebar-open")),y=document.querySelector(".app-slider-panel"),!Lt.isReadyToUse())throw new Error("SliderPanel: elements to init not found");setTimeout(()=>{y.classList.add(f)},0),_.forEach(L=>{L.addEventListener("click",()=>Lt.toggle())}),E=[..._,Array.from(document.querySelectorAll(".js-sidebar-skip--event"))],document.addEventListener("click",L=>{!y.contains(L.target)&&E.every(W=>!W.contains(L.target))&&y.classList.contains(k)&&Lt.toggle()})},toggle:function(){Lt.show(!y.classList.contains(k))},show:function(x){console.log({panel:y}),y.classList.toggle(k,x),_.forEach(L=>L.classList.toggle("active",x)),document.body.classList.toggle($,x),matchMedia&&matchMedia("(max-width: 767px)").matches&&document.documentElement.classList.toggle(S,x)}}})(),qt=function(){let f=0,$=window.Audio&&new Audio().canPlayType,S=0,k=function(m){return document.getElementById(m)},y,_,E,x,L;function W(m){y=new Ot.Jigsaw(m);const b=new Z("click",10);new Lt.init(y.eventBus),y.eventBus.on(Ot.Events.PIECES_CONNECTED,function(){b.play()}),Ot.GET.image&&y.set_image(Ot.GET.image)}function O(){_=k("modal-window"),E=k("modal-window-close"),x=k("modal-window-choice"),L=k("overlay");let m=mt.isTouchDevice?"touchstart":"click";mt.addEventListener(L,m,A),mt.addEventListener(E,m,A),mt.addEventListener(x,m,tt)}function N(){_||O(),_.className="modal",L.className=""}function A(m){return m&&m.preventDefault(),_.className="modal hide",L.className="hide",!1}function tt(m){return A(m),console.log(111),y.eventBus.emit(Ot.Events.SHOW_SIDEBAR),!1}function Z(m,b){if(!$)return;let C;for(this.file=m,S=b,this.audio=[],C=0;C<b;C++)this.audio[C]=new Audio;const a=(function(){document.removeEventListener("touchstart",a),document.removeEventListener("mousedown",a),this.load()}).bind(this);document.addEventListener("touchstart",a),document.addEventListener("mousedown",a)}return Z.prototype.load=function(){if(!$||this._loaded)return;this._loaded=!0;const m=this.audio[0].canPlayType("audio/mp3")?".mp3":".wav";for(let b=0;b<S;b++)this.audio[b].src=this.file+m,this.audio[b].volume=0,this.audio[b].load()},Z.prototype.play=function(){$&&(this.audio[f].volume=1,this.audio[f].play(),f=(f+1)%S)},{configure:W,Modal:{open:N,close:A}}}();window.addEventListener("DOMContentLoaded",function(){qt.configure({defaultImage:"./images/puzzle-01.jpg",piecesNumberTmpl:"%d Pieces",defaultPieces:3})});document.addEventListener("ontouchmove",function($){$.preventDefault()})});export default ae();
